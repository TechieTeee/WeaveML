var warp=(()=>{var Df=Object.create;var mn=Object.defineProperty;var Mf=Object.getOwnPropertyDescriptor;var $f=Object.getOwnPropertyNames;var Kf=Object.getPrototypeOf,Vf=Object.prototype.hasOwnProperty;var Gf=(n,t,e)=>t in n?mn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var qf=(n,t)=>()=>(n&&(t=n(n=0)),t);var J=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),jf=(n,t)=>{for(var e in t)mn(n,e,{get:t[e],enumerable:!0})},yc=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of $f(t))!Vf.call(n,i)&&i!==e&&mn(n,i,{get:()=>t[i],enumerable:!(r=Mf(t,i))||r.enumerable});return n};var Ot=(n,t,e)=>(e=n!=null?Df(Kf(n)):{},yc(t||!n||!n.__esModule?mn(e,"default",{value:n,enumerable:!0}):e,n)),Hf=n=>yc(mn({},"__esModule",{value:!0}),n);var Ve=(n,t,e)=>(Gf(n,typeof t!="symbol"?t+"":t,e),e);var Jo=J(Li=>{"use strict";m();Li.byteLength=zf;Li.toByteArray=Yf;Li.fromByteArray=th;var pe=[],Xt=[],Qf=typeof Uint8Array<"u"?Uint8Array:Array,zo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ur=0,wc=zo.length;ur<wc;++ur)pe[ur]=zo[ur],Xt[zo.charCodeAt(ur)]=ur;var ur,wc;Xt["-".charCodeAt(0)]=62;Xt["_".charCodeAt(0)]=63;function vc(n){var t=n.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=n.indexOf("=");e===-1&&(e=t);var r=e===t?0:4-e%4;return[e,r]}function zf(n){var t=vc(n),e=t[0],r=t[1];return(e+r)*3/4-r}function Jf(n,t,e){return(t+e)*3/4-e}function Yf(n){var t,e=vc(n),r=e[0],i=e[1],o=new Qf(Jf(n,r,i)),a=0,s=i>0?r-4:r,c;for(c=0;c<s;c+=4)t=Xt[n.charCodeAt(c)]<<18|Xt[n.charCodeAt(c+1)]<<12|Xt[n.charCodeAt(c+2)]<<6|Xt[n.charCodeAt(c+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=t&255;return i===2&&(t=Xt[n.charCodeAt(c)]<<2|Xt[n.charCodeAt(c+1)]>>4,o[a++]=t&255),i===1&&(t=Xt[n.charCodeAt(c)]<<10|Xt[n.charCodeAt(c+1)]<<4|Xt[n.charCodeAt(c+2)]>>2,o[a++]=t>>8&255,o[a++]=t&255),o}function Xf(n){return pe[n>>18&63]+pe[n>>12&63]+pe[n>>6&63]+pe[n&63]}function Zf(n,t,e){for(var r,i=[],o=t;o<e;o+=3)r=(n[o]<<16&16711680)+(n[o+1]<<8&65280)+(n[o+2]&255),i.push(Xf(r));return i.join("")}function th(n){for(var t,e=n.length,r=e%3,i=[],o=16383,a=0,s=e-r;a<s;a+=o)i.push(Zf(n,a,a+o>s?s:a+o));return r===1?(t=n[e-1],i.push(pe[t>>2]+pe[t<<4&63]+"==")):r===2&&(t=(n[e-2]<<8)+n[e-1],i.push(pe[t>>10]+pe[t>>4&63]+pe[t<<2&63]+"=")),i.join("")}});var _c=J(Yo=>{m();Yo.read=function(n,t,e,r,i){var o,a,s=i*8-r-1,c=(1<<s)-1,l=c>>1,p=-7,y=e?i-1:0,I=e?-1:1,f=n[t+y];for(y+=I,o=f&(1<<-p)-1,f>>=-p,p+=s;p>0;o=o*256+n[t+y],y+=I,p-=8);for(a=o&(1<<-p)-1,o>>=-p,p+=r;p>0;a=a*256+n[t+y],y+=I,p-=8);if(o===0)o=1-l;else{if(o===c)return a?NaN:(f?-1:1)*(1/0);a=a+Math.pow(2,r),o=o-l}return(f?-1:1)*a*Math.pow(2,o-r)};Yo.write=function(n,t,e,r,i,o){var a,s,c,l=o*8-i-1,p=(1<<l)-1,y=p>>1,I=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,v=r?1:-1,L=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=p):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+y>=1?t+=I/c:t+=I*Math.pow(2,1-y),t*c>=2&&(a++,c/=2),a+y>=p?(s=0,a=p):a+y>=1?(s=(t*c-1)*Math.pow(2,i),a=a+y):(s=t*Math.pow(2,y-1)*Math.pow(2,i),a=0));i>=8;n[e+f]=s&255,f+=v,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;n[e+f]=a&255,f+=v,a/=256,l-=8);n[e+f-v]|=L*128}});var Fr=J(Ur=>{"use strict";m();var Xo=Jo(),Wr=_c(),bc=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Ur.Buffer=N;Ur.SlowBuffer=ah;Ur.INSPECT_MAX_BYTES=50;var Oi=2147483647;Ur.kMaxLength=Oi;N.TYPED_ARRAY_SUPPORT=eh();!N.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function eh(){try{var n=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(n,t),n.foo()===42}catch{return!1}}Object.defineProperty(N.prototype,"parent",{enumerable:!0,get:function(){if(N.isBuffer(this))return this.buffer}});Object.defineProperty(N.prototype,"offset",{enumerable:!0,get:function(){if(N.isBuffer(this))return this.byteOffset}});function ke(n){if(n>Oi)throw new RangeError('The value "'+n+'" is invalid for option "size"');var t=new Uint8Array(n);return Object.setPrototypeOf(t,N.prototype),t}function N(n,t,e){if(typeof n=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return ra(n)}return Tc(n,t,e)}N.poolSize=8192;function Tc(n,t,e){if(typeof n=="string")return nh(n,t);if(ArrayBuffer.isView(n))return ih(n);if(n==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(me(n,ArrayBuffer)||n&&me(n.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(me(n,SharedArrayBuffer)||n&&me(n.buffer,SharedArrayBuffer)))return ta(n,t,e);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var r=n.valueOf&&n.valueOf();if(r!=null&&r!==n)return N.from(r,t,e);var i=oh(n);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return N.from(n[Symbol.toPrimitive]("string"),t,e);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}N.from=function(n,t,e){return Tc(n,t,e)};Object.setPrototypeOf(N.prototype,Uint8Array.prototype);Object.setPrototypeOf(N,Uint8Array);function xc(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(n<0)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function rh(n,t,e){return xc(n),n<=0?ke(n):t!==void 0?typeof e=="string"?ke(n).fill(t,e):ke(n).fill(t):ke(n)}N.alloc=function(n,t,e){return rh(n,t,e)};function ra(n){return xc(n),ke(n<0?0:na(n)|0)}N.allocUnsafe=function(n){return ra(n)};N.allocUnsafeSlow=function(n){return ra(n)};function nh(n,t){if((typeof t!="string"||t==="")&&(t="utf8"),!N.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var e=Cc(n,t)|0,r=ke(e),i=r.write(n,t);return i!==e&&(r=r.slice(0,i)),r}function Zo(n){for(var t=n.length<0?0:na(n.length)|0,e=ke(t),r=0;r<t;r+=1)e[r]=n[r]&255;return e}function ih(n){if(me(n,Uint8Array)){var t=new Uint8Array(n);return ta(t.buffer,t.byteOffset,t.byteLength)}return Zo(n)}function ta(n,t,e){if(t<0||n.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<t+(e||0))throw new RangeError('"length" is outside of buffer bounds');var r;return t===void 0&&e===void 0?r=new Uint8Array(n):e===void 0?r=new Uint8Array(n,t):r=new Uint8Array(n,t,e),Object.setPrototypeOf(r,N.prototype),r}function oh(n){if(N.isBuffer(n)){var t=na(n.length)|0,e=ke(t);return e.length===0||n.copy(e,0,0,t),e}if(n.length!==void 0)return typeof n.length!="number"||ia(n.length)?ke(0):Zo(n);if(n.type==="Buffer"&&Array.isArray(n.data))return Zo(n.data)}function na(n){if(n>=Oi)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Oi.toString(16)+" bytes");return n|0}function ah(n){return+n!=n&&(n=0),N.alloc(+n)}N.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==N.prototype};N.compare=function(t,e){if(me(t,Uint8Array)&&(t=N.from(t,t.offset,t.byteLength)),me(e,Uint8Array)&&(e=N.from(e,e.offset,e.byteLength)),!N.isBuffer(t)||!N.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,i=e.length,o=0,a=Math.min(r,i);o<a;++o)if(t[o]!==e[o]){r=t[o],i=e[o];break}return r<i?-1:i<r?1:0};N.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};N.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return N.alloc(0);var r;if(e===void 0)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=N.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var a=t[r];if(me(a,Uint8Array))o+a.length>i.length?N.from(a).copy(i,o):Uint8Array.prototype.set.call(i,a,o);else if(N.isBuffer(a))a.copy(i,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=a.length}return i};function Cc(n,t){if(N.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||me(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);var e=n.length,r=arguments.length>2&&arguments[2]===!0;if(!r&&e===0)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":return ea(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return e*2;case"hex":return e>>>1;case"base64":return Rc(n).length;default:if(i)return r?-1:ea(n).length;t=(""+t).toLowerCase(),i=!0}}N.byteLength=Cc;function sh(n,t,e){var r=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((e===void 0||e>this.length)&&(e=this.length),e<=0)||(e>>>=0,t>>>=0,e<=t))return"";for(n||(n="utf8");;)switch(n){case"hex":return yh(this,t,e);case"utf8":case"utf-8":return kc(this,t,e);case"ascii":return ph(this,t,e);case"latin1":case"binary":return mh(this,t,e);case"base64":return dh(this,t,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wh(this,t,e);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),r=!0}}N.prototype._isBuffer=!0;function lr(n,t,e){var r=n[t];n[t]=n[e],n[e]=r}N.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)lr(this,e,e+1);return this};N.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)lr(this,e,e+3),lr(this,e+1,e+2);return this};N.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)lr(this,e,e+7),lr(this,e+1,e+6),lr(this,e+2,e+5),lr(this,e+3,e+4);return this};N.prototype.toString=function(){var t=this.length;return t===0?"":arguments.length===0?kc(this,0,t):sh.apply(this,arguments)};N.prototype.toLocaleString=N.prototype.toString;N.prototype.equals=function(t){if(!N.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:N.compare(this,t)===0};N.prototype.inspect=function(){var t="",e=Ur.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"};bc&&(N.prototype[bc]=N.prototype.inspect);N.prototype.compare=function(t,e,r,i,o){if(me(t,Uint8Array)&&(t=N.from(t,t.offset,t.byteLength)),!N.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(e===void 0&&(e=0),r===void 0&&(r=t?t.length:0),i===void 0&&(i=0),o===void 0&&(o=this.length),e<0||r>t.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&e>=r)return 0;if(i>=o)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,i>>>=0,o>>>=0,this===t)return 0;for(var a=o-i,s=r-e,c=Math.min(a,s),l=this.slice(i,o),p=t.slice(e,r),y=0;y<c;++y)if(l[y]!==p[y]){a=l[y],s=p[y];break}return a<s?-1:s<a?1:0};function Ic(n,t,e,r,i){if(n.length===0)return-1;if(typeof e=="string"?(r=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,ia(e)&&(e=i?0:n.length-1),e<0&&(e=n.length+e),e>=n.length){if(i)return-1;e=n.length-1}else if(e<0)if(i)e=0;else return-1;if(typeof t=="string"&&(t=N.from(t,r)),N.isBuffer(t))return t.length===0?-1:Sc(n,t,e,r,i);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(n,t,e):Uint8Array.prototype.lastIndexOf.call(n,t,e):Sc(n,[t],e,r,i);throw new TypeError("val must be string, number or Buffer")}function Sc(n,t,e,r,i){var o=1,a=n.length,s=t.length;if(r!==void 0&&(r=String(r).toLowerCase(),r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le")){if(n.length<2||t.length<2)return-1;o=2,a/=2,s/=2,e/=2}function c(f,v){return o===1?f[v]:f.readUInt16BE(v*o)}var l;if(i){var p=-1;for(l=e;l<a;l++)if(c(n,l)===c(t,p===-1?0:l-p)){if(p===-1&&(p=l),l-p+1===s)return p*o}else p!==-1&&(l-=l-p),p=-1}else for(e+s>a&&(e=a-s),l=e;l>=0;l--){for(var y=!0,I=0;I<s;I++)if(c(n,l+I)!==c(t,I)){y=!1;break}if(y)return l}return-1}N.prototype.includes=function(t,e,r){return this.indexOf(t,e,r)!==-1};N.prototype.indexOf=function(t,e,r){return Ic(this,t,e,r,!0)};N.prototype.lastIndexOf=function(t,e,r){return Ic(this,t,e,r,!1)};function ch(n,t,e,r){e=Number(e)||0;var i=n.length-e;r?(r=Number(r),r>i&&(r=i)):r=i;var o=t.length;r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(a*2,2),16);if(ia(s))return a;n[e+a]=s}return a}function uh(n,t,e,r){return Ri(ea(t,n.length-e),n,e,r)}function lh(n,t,e,r){return Ri(bh(t),n,e,r)}function fh(n,t,e,r){return Ri(Rc(t),n,e,r)}function hh(n,t,e,r){return Ri(Sh(t,n.length-e),n,e,r)}N.prototype.write=function(t,e,r,i){if(e===void 0)i="utf8",r=this.length,e=0;else if(r===void 0&&typeof e=="string")i=e,r=this.length,e=0;else if(isFinite(e))e=e>>>0,isFinite(r)?(r=r>>>0,i===void 0&&(i="utf8")):(i=r,r=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o=this.length-e;if((r===void 0||r>o)&&(r=o),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return ch(this,t,e,r);case"utf8":case"utf-8":return uh(this,t,e,r);case"ascii":case"latin1":case"binary":return lh(this,t,e,r);case"base64":return fh(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return hh(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}};N.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function dh(n,t,e){return t===0&&e===n.length?Xo.fromByteArray(n):Xo.fromByteArray(n.slice(t,e))}function kc(n,t,e){e=Math.min(n.length,e);for(var r=[],i=t;i<e;){var o=n[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=e){var c,l,p,y;switch(s){case 1:o<128&&(a=o);break;case 2:c=n[i+1],(c&192)===128&&(y=(o&31)<<6|c&63,y>127&&(a=y));break;case 3:c=n[i+1],l=n[i+2],(c&192)===128&&(l&192)===128&&(y=(o&15)<<12|(c&63)<<6|l&63,y>2047&&(y<55296||y>57343)&&(a=y));break;case 4:c=n[i+1],l=n[i+2],p=n[i+3],(c&192)===128&&(l&192)===128&&(p&192)===128&&(y=(o&15)<<18|(c&63)<<12|(l&63)<<6|p&63,y>65535&&y<1114112&&(a=y))}}a===null?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|a&1023),r.push(a),i+=s}return gh(r)}var Ec=4096;function gh(n){var t=n.length;if(t<=Ec)return String.fromCharCode.apply(String,n);for(var e="",r=0;r<t;)e+=String.fromCharCode.apply(String,n.slice(r,r+=Ec));return e}function ph(n,t,e){var r="";e=Math.min(n.length,e);for(var i=t;i<e;++i)r+=String.fromCharCode(n[i]&127);return r}function mh(n,t,e){var r="";e=Math.min(n.length,e);for(var i=t;i<e;++i)r+=String.fromCharCode(n[i]);return r}function yh(n,t,e){var r=n.length;(!t||t<0)&&(t=0),(!e||e<0||e>r)&&(e=r);for(var i="",o=t;o<e;++o)i+=Eh[n[o]];return i}function wh(n,t,e){for(var r=n.slice(t,e),i="",o=0;o<r.length-1;o+=2)i+=String.fromCharCode(r[o]+r[o+1]*256);return i}N.prototype.slice=function(t,e){var r=this.length;t=~~t,e=e===void 0?r:~~e,t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),e<t&&(e=t);var i=this.subarray(t,e);return Object.setPrototypeOf(i,N.prototype),i};function xt(n,t,e){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+t>e)throw new RangeError("Trying to access beyond buffer length")}N.prototype.readUintLE=N.prototype.readUIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||xt(t,e,this.length);for(var i=this[t],o=1,a=0;++a<e&&(o*=256);)i+=this[t+a]*o;return i};N.prototype.readUintBE=N.prototype.readUIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||xt(t,e,this.length);for(var i=this[t+--e],o=1;e>0&&(o*=256);)i+=this[t+--e]*o;return i};N.prototype.readUint8=N.prototype.readUInt8=function(t,e){return t=t>>>0,e||xt(t,1,this.length),this[t]};N.prototype.readUint16LE=N.prototype.readUInt16LE=function(t,e){return t=t>>>0,e||xt(t,2,this.length),this[t]|this[t+1]<<8};N.prototype.readUint16BE=N.prototype.readUInt16BE=function(t,e){return t=t>>>0,e||xt(t,2,this.length),this[t]<<8|this[t+1]};N.prototype.readUint32LE=N.prototype.readUInt32LE=function(t,e){return t=t>>>0,e||xt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};N.prototype.readUint32BE=N.prototype.readUInt32BE=function(t,e){return t=t>>>0,e||xt(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};N.prototype.readIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||xt(t,e,this.length);for(var i=this[t],o=1,a=0;++a<e&&(o*=256);)i+=this[t+a]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i};N.prototype.readIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||xt(t,e,this.length);for(var i=e,o=1,a=this[t+--i];i>0&&(o*=256);)a+=this[t+--i]*o;return o*=128,a>=o&&(a-=Math.pow(2,8*e)),a};N.prototype.readInt8=function(t,e){return t=t>>>0,e||xt(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]};N.prototype.readInt16LE=function(t,e){t=t>>>0,e||xt(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};N.prototype.readInt16BE=function(t,e){t=t>>>0,e||xt(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};N.prototype.readInt32LE=function(t,e){return t=t>>>0,e||xt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};N.prototype.readInt32BE=function(t,e){return t=t>>>0,e||xt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};N.prototype.readFloatLE=function(t,e){return t=t>>>0,e||xt(t,4,this.length),Wr.read(this,t,!0,23,4)};N.prototype.readFloatBE=function(t,e){return t=t>>>0,e||xt(t,4,this.length),Wr.read(this,t,!1,23,4)};N.prototype.readDoubleLE=function(t,e){return t=t>>>0,e||xt(t,8,this.length),Wr.read(this,t,!0,52,8)};N.prototype.readDoubleBE=function(t,e){return t=t>>>0,e||xt(t,8,this.length),Wr.read(this,t,!1,52,8)};function Mt(n,t,e,r,i,o){if(!N.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(e+r>n.length)throw new RangeError("Index out of range")}N.prototype.writeUintLE=N.prototype.writeUIntLE=function(t,e,r,i){if(t=+t,e=e>>>0,r=r>>>0,!i){var o=Math.pow(2,8*r)-1;Mt(this,t,e,r,o,0)}var a=1,s=0;for(this[e]=t&255;++s<r&&(a*=256);)this[e+s]=t/a&255;return e+r};N.prototype.writeUintBE=N.prototype.writeUIntBE=function(t,e,r,i){if(t=+t,e=e>>>0,r=r>>>0,!i){var o=Math.pow(2,8*r)-1;Mt(this,t,e,r,o,0)}var a=r-1,s=1;for(this[e+a]=t&255;--a>=0&&(s*=256);)this[e+a]=t/s&255;return e+r};N.prototype.writeUint8=N.prototype.writeUInt8=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,1,255,0),this[e]=t&255,e+1};N.prototype.writeUint16LE=N.prototype.writeUInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,2,65535,0),this[e]=t&255,this[e+1]=t>>>8,e+2};N.prototype.writeUint16BE=N.prototype.writeUInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=t&255,e+2};N.prototype.writeUint32LE=N.prototype.writeUInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t&255,e+4};N.prototype.writeUint32BE=N.prototype.writeUInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};N.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e=e>>>0,!i){var o=Math.pow(2,8*r-1);Mt(this,t,e,r,o-1,-o)}var a=0,s=1,c=0;for(this[e]=t&255;++a<r&&(s*=256);)t<0&&c===0&&this[e+a-1]!==0&&(c=1),this[e+a]=(t/s>>0)-c&255;return e+r};N.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e=e>>>0,!i){var o=Math.pow(2,8*r-1);Mt(this,t,e,r,o-1,-o)}var a=r-1,s=1,c=0;for(this[e+a]=t&255;--a>=0&&(s*=256);)t<0&&c===0&&this[e+a+1]!==0&&(c=1),this[e+a]=(t/s>>0)-c&255;return e+r};N.prototype.writeInt8=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=t&255,e+1};N.prototype.writeInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,2,32767,-32768),this[e]=t&255,this[e+1]=t>>>8,e+2};N.prototype.writeInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=t&255,e+2};N.prototype.writeInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,4,2147483647,-2147483648),this[e]=t&255,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4};N.prototype.writeInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||Mt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};function Ac(n,t,e,r,i,o){if(e+r>n.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function Lc(n,t,e,r,i){return t=+t,e=e>>>0,i||Ac(n,t,e,4,34028234663852886e22,-34028234663852886e22),Wr.write(n,t,e,r,23,4),e+4}N.prototype.writeFloatLE=function(t,e,r){return Lc(this,t,e,!0,r)};N.prototype.writeFloatBE=function(t,e,r){return Lc(this,t,e,!1,r)};function Oc(n,t,e,r,i){return t=+t,e=e>>>0,i||Ac(n,t,e,8,17976931348623157e292,-17976931348623157e292),Wr.write(n,t,e,r,52,8),e+8}N.prototype.writeDoubleLE=function(t,e,r){return Oc(this,t,e,!0,r)};N.prototype.writeDoubleBE=function(t,e,r){return Oc(this,t,e,!1,r)};N.prototype.copy=function(t,e,r,i){if(!N.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),!i&&i!==0&&(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r||t.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var o=i-r;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(e,r,i):Uint8Array.prototype.set.call(t,this.subarray(r,i),e),o};N.prototype.fill=function(t,e,r,i){if(typeof t=="string"){if(typeof e=="string"?(i=e,e=0,r=this.length):typeof r=="string"&&(i=r,r=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!N.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(t.length===1){var o=t.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(t=o)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;e=e>>>0,r=r===void 0?this.length:r>>>0,t||(t=0);var a;if(typeof t=="number")for(a=e;a<r;++a)this[a]=t;else{var s=N.isBuffer(t)?t:N.from(t,i),c=s.length;if(c===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<r-e;++a)this[a+e]=s[a%c]}return this};var vh=/[^+/0-9A-Za-z-_]/g;function _h(n){if(n=n.split("=")[0],n=n.trim().replace(vh,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function ea(n,t){t=t||1/0;for(var e,r=n.length,i=null,o=[],a=0;a<r;++a){if(e=n.charCodeAt(a),e>55295&&e<57344){if(!i){if(e>56319){(t-=3)>-1&&o.push(239,191,189);continue}else if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=e;continue}if(e<56320){(t-=3)>-1&&o.push(239,191,189),i=e;continue}e=(i-55296<<10|e-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((t-=1)<0)break;o.push(e)}else if(e<2048){if((t-=2)<0)break;o.push(e>>6|192,e&63|128)}else if(e<65536){if((t-=3)<0)break;o.push(e>>12|224,e>>6&63|128,e&63|128)}else if(e<1114112){if((t-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,e&63|128)}else throw new Error("Invalid code point")}return o}function bh(n){for(var t=[],e=0;e<n.length;++e)t.push(n.charCodeAt(e)&255);return t}function Sh(n,t){for(var e,r,i,o=[],a=0;a<n.length&&!((t-=2)<0);++a)e=n.charCodeAt(a),r=e>>8,i=e%256,o.push(i),o.push(r);return o}function Rc(n){return Xo.toByteArray(_h(n))}function Ri(n,t,e,r){for(var i=0;i<r&&!(i+e>=t.length||i>=n.length);++i)t[i+e]=n[i];return i}function me(n,t){return n instanceof t||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===t.name}function ia(n){return n!==n}var Eh=function(){for(var n="0123456789abcdef",t=new Array(256),e=0;e<16;++e)for(var r=e*16,i=0;i<16;++i)t[r+i]=n[e]+n[i];return t}()});var Uc=J((dm,Wc)=>{m();var St=Wc.exports={},ye,we;function oa(){throw new Error("setTimeout has not been defined")}function aa(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?ye=setTimeout:ye=oa}catch{ye=oa}try{typeof clearTimeout=="function"?we=clearTimeout:we=aa}catch{we=aa}})();function Bc(n){if(ye===setTimeout)return setTimeout(n,0);if((ye===oa||!ye)&&setTimeout)return ye=setTimeout,setTimeout(n,0);try{return ye(n,0)}catch{try{return ye.call(null,n,0)}catch{return ye.call(this,n,0)}}}function Th(n){if(we===clearTimeout)return clearTimeout(n);if((we===aa||!we)&&clearTimeout)return we=clearTimeout,clearTimeout(n);try{return we(n)}catch{try{return we.call(null,n)}catch{return we.call(this,n)}}}var Ae=[],Dr=!1,fr,Bi=-1;function xh(){!Dr||!fr||(Dr=!1,fr.length?Ae=fr.concat(Ae):Bi=-1,Ae.length&&Pc())}function Pc(){if(!Dr){var n=Bc(xh);Dr=!0;for(var t=Ae.length;t;){for(fr=Ae,Ae=[];++Bi<t;)fr&&fr[Bi].run();Bi=-1,t=Ae.length}fr=null,Dr=!1,Th(n)}}St.nextTick=function(n){var t=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)t[e-1]=arguments[e];Ae.push(new Nc(n,t)),Ae.length===1&&!Dr&&Bc(Pc)};function Nc(n,t){this.fun=n,this.array=t}Nc.prototype.run=function(){this.fun.apply(null,this.array)};St.title="browser";St.browser=!0;St.env={};St.argv=[];St.version="";St.versions={};function Le(){}St.on=Le;St.addListener=Le;St.once=Le;St.off=Le;St.removeListener=Le;St.removeAllListeners=Le;St.emit=Le;St.prependListener=Le;St.prependOnceListener=Le;St.listeners=function(n){return[]};St.binding=function(n){throw new Error("process.binding is not supported")};St.cwd=function(){return"/"};St.chdir=function(n){throw new Error("process.chdir is not supported")};St.umask=function(){return 0}});var W,B,Ch,P,m=qf(()=>{W=Ot(Fr()),B=Ot(Uc()),Ch=function(n){function t(){var r=this||self;return delete n.prototype.__magic__,r}if(typeof globalThis=="object")return globalThis;if(this)return t();n.defineProperty(n.prototype,"__magic__",{configurable:!0,get:t});var e=__magic__;return e}(Object),P=Ch});var Mc=J(Dc=>{"use strict";m();Dc.supports=function(...t){let e=t.reduce((r,i)=>Object.assign(r,i),{});return Object.assign(e,{snapshots:e.snapshots||!1,permanence:e.permanence||!1,seek:e.seek||!1,clear:e.clear||!1,getMany:e.getMany||!1,keyIterator:e.keyIterator||!1,valueIterator:e.valueIterator||!1,iteratorNextv:e.iteratorNextv||!1,iteratorAll:e.iteratorAll||!1,status:e.status||!1,createIfMissing:e.createIfMissing||!1,errorIfExists:e.errorIfExists||!1,deferredOpen:e.deferredOpen||!1,promises:e.promises||!1,streams:e.streams||!1,encodings:Object.assign({},e.encodings),events:Object.assign({},e.events),additionalMethods:Object.assign({},e.additionalMethods)})}});var Zt=J((Um,$c)=>{"use strict";m();$c.exports=class extends Error{constructor(t,e){super(t||""),typeof e=="object"&&e!==null&&(e.code&&(this.code=String(e.code)),e.expected&&(this.expected=!0),e.transient&&(this.transient=!0),e.cause&&(this.cause=e.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}});var ca=J((Dm,Kc)=>{"use strict";m();var sa=null;Kc.exports=function(){return sa===null&&(sa={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),sa}});var fa=J(Vc=>{"use strict";m();var ua=Zt(),Ih=new Set(["buffer","view","utf8"]),la=class{constructor(t){if(this.encode=t.encode||this.encode,this.decode=t.decode||this.decode,this.name=t.name||this.name,this.format=t.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!Ih.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");t.createViewTranscoder&&(this.createViewTranscoder=t.createViewTranscoder),t.createBufferTranscoder&&(this.createBufferTranscoder=t.createBufferTranscoder),t.createUTF8Transcoder&&(this.createUTF8Transcoder=t.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new ua(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new ua(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new ua(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};Vc.Encoding=la});var pa=J(Ni=>{"use strict";m();var{Buffer:da}=Fr()||{},{Encoding:ga}=fa(),kh=ca(),vn=class extends ga{constructor(t){super({...t,format:"buffer"})}createViewTranscoder(){return new _n({encode:this.encode,decode:t=>this.decode(da.from(t.buffer,t.byteOffset,t.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},_n=class extends ga{constructor(t){super({...t,format:"view"})}createBufferTranscoder(){return new vn({encode:t=>{let e=this.encode(t);return da.from(e.buffer,e.byteOffset,e.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},ha=class extends ga{constructor(t){super({...t,format:"utf8"})}createBufferTranscoder(){return new vn({encode:t=>da.from(this.encode(t),"utf8"),decode:t=>this.decode(t.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:t,textDecoder:e}=kh();return new _n({encode:r=>t.encode(this.encode(r)),decode:r=>this.decode(e.decode(r)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};Ni.BufferFormat=vn;Ni.ViewFormat=_n;Ni.UTF8Format=ha});var Hc=J(dr=>{"use strict";m();var{Buffer:Bt}=Fr()||{Buffer:{isBuffer:()=>!1}},{textEncoder:qc,textDecoder:Gc}=ca()(),{BufferFormat:bn,ViewFormat:ma,UTF8Format:jc}=pa(),Wi=n=>n;dr.utf8=new jc({encode:function(n){return Bt.isBuffer(n)?n.toString("utf8"):ArrayBuffer.isView(n)?Gc.decode(n):String(n)},decode:Wi,name:"utf8",createViewTranscoder(){return new ma({encode:function(n){return ArrayBuffer.isView(n)?n:qc.encode(n)},decode:function(n){return Gc.decode(n)},name:`${this.name}+view`})},createBufferTranscoder(){return new bn({encode:function(n){return Bt.isBuffer(n)?n:ArrayBuffer.isView(n)?Bt.from(n.buffer,n.byteOffset,n.byteLength):Bt.from(String(n),"utf8")},decode:function(n){return n.toString("utf8")},name:`${this.name}+buffer`})}});dr.json=new jc({encode:JSON.stringify,decode:JSON.parse,name:"json"});dr.buffer=new bn({encode:function(n){return Bt.isBuffer(n)?n:ArrayBuffer.isView(n)?Bt.from(n.buffer,n.byteOffset,n.byteLength):Bt.from(String(n),"utf8")},decode:Wi,name:"buffer",createViewTranscoder(){return new ma({encode:function(n){return ArrayBuffer.isView(n)?n:Bt.from(String(n),"utf8")},decode:function(n){return Bt.from(n.buffer,n.byteOffset,n.byteLength)},name:`${this.name}+view`})}});dr.view=new ma({encode:function(n){return ArrayBuffer.isView(n)?n:qc.encode(n)},decode:Wi,name:"view",createBufferTranscoder(){return new bn({encode:function(n){return Bt.isBuffer(n)?n:ArrayBuffer.isView(n)?Bt.from(n.buffer,n.byteOffset,n.byteLength):Bt.from(String(n),"utf8")},decode:Wi,name:`${this.name}+buffer`})}});dr.hex=new bn({encode:function(n){return Bt.isBuffer(n)?n:Bt.from(String(n),"hex")},decode:function(n){return n.toString("hex")},name:"hex"});dr.base64=new bn({encode:function(n){return Bt.isBuffer(n)?n:Bt.from(String(n),"base64")},decode:function(n){return n.toString("base64")},name:"base64"})});var Jc=J(zc=>{"use strict";m();var Qc=Zt(),Fi=Hc(),{Encoding:Ah}=fa(),{BufferFormat:Lh,ViewFormat:Oh,UTF8Format:Rh}=pa(),Sn=Symbol("formats"),Ui=Symbol("encodings"),Bh=new Set(["buffer","view","utf8"]),ya=class{constructor(t){if(Array.isArray(t)){if(!t.every(e=>Bh.has(e)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[Ui]=new Map,this[Sn]=new Set(t);for(let e in Fi)try{this.encoding(e)}catch(r){if(r.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw r}}encodings(){return Array.from(new Set(this[Ui].values()))}encoding(t){let e=this[Ui].get(t);if(e===void 0){if(typeof t=="string"&&t!==""){if(e=Uh[t],!e)throw new Qc(`Encoding '${t}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof t!="object"||t===null)throw new TypeError("First argument 'encoding' must be a string or object");e=Ph(t)}let{name:r,format:i}=e;if(!this[Sn].has(i))if(this[Sn].has("view"))e=e.createViewTranscoder();else if(this[Sn].has("buffer"))e=e.createBufferTranscoder();else if(this[Sn].has("utf8"))e=e.createUTF8Transcoder();else throw new Qc(`Encoding '${r}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let o of[t,r,e.name,e.commonName])this[Ui].set(o,e)}return e}};zc.Transcoder=ya;function Ph(n){if(n instanceof Ah)return n;let t="type"in n&&typeof n.type=="string"?n.type:void 0,e=n.name||t||`anonymous-${Fh++}`;switch(Nh(n)){case"view":return new Oh({...n,name:e});case"utf8":return new Rh({...n,name:e});case"buffer":return new Lh({...n,name:e});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function Nh(n){return"format"in n&&n.format!==void 0?n.format:"buffer"in n&&typeof n.buffer=="boolean"?n.buffer?"buffer":"utf8":"code"in n&&Number.isInteger(n.code)?"view":"buffer"}var Wh={binary:Fi.buffer,"utf-8":Fi.utf8},Uh={...Fi,...Wh},Fh=0});var su=J((zm,wa)=>{"use strict";m();var Mr=typeof Reflect=="object"?Reflect:null,Yc=Mr&&typeof Mr.apply=="function"?Mr.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},Di;Mr&&typeof Mr.ownKeys=="function"?Di=Mr.ownKeys:Object.getOwnPropertySymbols?Di=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Di=function(t){return Object.getOwnPropertyNames(t)};function Dh(n){console&&console.warn&&console.warn(n)}var Zc=Number.isNaN||function(t){return t!==t};function gt(){gt.init.call(this)}wa.exports=gt;wa.exports.once=Vh;gt.EventEmitter=gt;gt.prototype._events=void 0;gt.prototype._eventsCount=0;gt.prototype._maxListeners=void 0;var Xc=10;function Mi(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(gt,"defaultMaxListeners",{enumerable:!0,get:function(){return Xc},set:function(n){if(typeof n!="number"||n<0||Zc(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Xc=n}});gt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};gt.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Zc(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function tu(n){return n._maxListeners===void 0?gt.defaultMaxListeners:n._maxListeners}gt.prototype.getMaxListeners=function(){return tu(this)};gt.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[t];if(c===void 0)return!1;if(typeof c=="function")Yc(c,this,e);else for(var l=c.length,p=ou(c,l),r=0;r<l;++r)Yc(p[r],this,e);return!0};function eu(n,t,e,r){var i,o,a;if(Mi(e),o=n._events,o===void 0?(o=n._events=Object.create(null),n._eventsCount=0):(o.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),o=n._events),a=o[t]),a===void 0)a=o[t]=e,++n._eventsCount;else if(typeof a=="function"?a=o[t]=r?[e,a]:[a,e]:r?a.unshift(e):a.push(e),i=tu(n),i>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=n,s.type=t,s.count=a.length,Dh(s)}return n}gt.prototype.addListener=function(t,e){return eu(this,t,e,!1)};gt.prototype.on=gt.prototype.addListener;gt.prototype.prependListener=function(t,e){return eu(this,t,e,!0)};function Mh(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ru(n,t,e){var r={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},i=Mh.bind(r);return i.listener=e,r.wrapFn=i,i}gt.prototype.once=function(t,e){return Mi(e),this.on(t,ru(this,t,e)),this};gt.prototype.prependOnceListener=function(t,e){return Mi(e),this.prependListener(t,ru(this,t,e)),this};gt.prototype.removeListener=function(t,e){var r,i,o,a,s;if(Mi(e),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===e||r[a].listener===e){s=r[a].listener,o=a;break}if(o<0)return this;o===0?r.shift():$h(r,o),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,s||e)}return this};gt.prototype.off=gt.prototype.removeListener;gt.prototype.removeAllListeners=function(t){var e,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var o=Object.keys(r),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function nu(n,t,e){var r=n._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?Kh(i):ou(i,i.length)}gt.prototype.listeners=function(t){return nu(this,t,!0)};gt.prototype.rawListeners=function(t){return nu(this,t,!1)};gt.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):iu.call(n,t)};gt.prototype.listenerCount=iu;function iu(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}gt.prototype.eventNames=function(){return this._eventsCount>0?Di(this._events):[]};function ou(n,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=n[r];return e}function $h(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Kh(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Vh(n,t){return new Promise(function(e,r){function i(a){n.removeListener(t,o),r(a)}function o(){typeof n.removeListener=="function"&&n.removeListener("error",i),e([].slice.call(arguments))}au(n,t,o,{once:!0}),t!=="error"&&Gh(n,i,{once:!0})})}function Gh(n,t,e){typeof n.on=="function"&&au(n,"error",t,e)}function au(n,t,e,r){if(typeof n.on=="function")r.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function i(o){r.once&&n.removeEventListener(t,i),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}});var uu=J((Ym,cu)=>{m();cu.exports=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n)});var En=J(va=>{"use strict";m();var lu=uu();va.fromCallback=function(n,t){if(n===void 0){var e=new Promise(function(r,i){n=function(o,a){o?i(o):r(a)}});n[t!==void 0?t:"promise"]=e}else if(typeof n!="function")throw new TypeError("Callback must be a function");return n};va.fromPromise=function(n,t){if(t===void 0)return n;n.then(function(e){lu(()=>t(null,e))}).catch(function(e){lu(()=>t(e))})}});var $i=J(_a=>{"use strict";m();_a.getCallback=function(n,t){return typeof n=="function"?n:t};_a.getOptions=function(n,t){return typeof n=="object"&&n!==null?n:t!==void 0?t:{}}});var ze=J(qi=>{"use strict";m();var{fromCallback:ba}=En(),Gt=Zt(),{getOptions:Sa,getCallback:fu}=$i(),gr=Symbol("promise"),$r=Symbol("callback"),ve=Symbol("working"),pr=Symbol("handleOne"),Oe=Symbol("handleMany"),Ea=Symbol("autoClose"),He=Symbol("finishWork"),_e=Symbol("returnMany"),Ge=Symbol("closing"),Tn=Symbol("handleClose"),Ki=Symbol("closed"),xn=Symbol("closeCallbacks"),je=Symbol("keyEncoding"),mr=Symbol("valueEncoding"),Ta=Symbol("abortOnClose"),Vi=Symbol("legacy"),xa=Symbol("keys"),Ca=Symbol("values"),qe=Symbol("limit"),te=Symbol("count"),Gi=Object.freeze({}),qh=()=>{},hu=!1,Cn=class{constructor(t,e,r){if(typeof t!="object"||t===null){let i=t===null?"null":typeof t;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof e!="object"||e===null)throw new TypeError("The second argument must be an options object");this[Ki]=!1,this[xn]=[],this[ve]=!1,this[Ge]=!1,this[Ea]=!1,this[$r]=null,this[pr]=this[pr].bind(this),this[Oe]=this[Oe].bind(this),this[Tn]=this[Tn].bind(this),this[je]=e[je],this[mr]=e[mr],this[Vi]=r,this[qe]=Number.isInteger(e.limit)&&e.limit>=0?e.limit:1/0,this[te]=0,this[Ta]=!!e.abortOnClose,this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get count(){return this[te]}get limit(){return this[qe]}next(t){let e;if(t===void 0)e=new Promise((r,i)=>{t=(o,a,s)=>{o?i(o):this[Vi]?a===void 0&&s===void 0?r():r([a,s]):r(a)}});else if(typeof t!="function")throw new TypeError("Callback must be a function");return this[Ge]?this.nextTick(t,new Gt("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ve]?this.nextTick(t,new Gt("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[ve]=!0,this[$r]=t,this[te]>=this[qe]?this.nextTick(this[pr],null):this._next(this[pr])),e}_next(t){this.nextTick(t)}nextv(t,e,r){return r=fu(e,r),r=ba(r,gr),e=Sa(e,Gi),Number.isInteger(t)?(this[Ge]?this.nextTick(r,new Gt("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ve]?this.nextTick(r,new Gt("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(t<1&&(t=1),this[qe]<1/0&&(t=Math.min(t,this[qe]-this[te])),this[ve]=!0,this[$r]=r,t<=0?this.nextTick(this[Oe],null,[]):this._nextv(t,e,this[Oe])),r[gr]):(this.nextTick(r,new TypeError("The first argument 'size' must be an integer")),r[gr])}_nextv(t,e,r){let i=[],o=(a,s,c)=>{if(a)return r(a);if(this[Vi]?s===void 0&&c===void 0:s===void 0)return r(null,i);i.push(this[Vi]?[s,c]:s),i.length===t?r(null,i):this._next(o)};this._next(o)}all(t,e){return e=fu(t,e),e=ba(e,gr),t=Sa(t,Gi),this[Ge]?this.nextTick(e,new Gt("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ve]?this.nextTick(e,new Gt("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[ve]=!0,this[$r]=e,this[Ea]=!0,this[te]>=this[qe]?this.nextTick(this[Oe],null,[]):this._all(t,this[Oe])),e[gr]}_all(t,e){let r=this[te],i=[],o=()=>{let s=this[qe]<1/0?Math.min(1e3,this[qe]-r):1e3;s<=0?this.nextTick(e,null,i):this._nextv(s,Gi,a)},a=(s,c)=>{s?e(s):c.length===0?e(null,i):(i.push.apply(i,c),r+=c.length,o())};o()}[He](){let t=this[$r];return this[Ta]&&t===null?qh:(this[ve]=!1,this[$r]=null,this[Ge]&&this._close(this[Tn]),t)}[_e](t,e,r){this[Ea]?this.close(t.bind(null,e,r)):t(e,r)}seek(t,e){if(e=Sa(e,Gi),!this[Ge]){if(this[ve])throw new Gt("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{let r=this.db.keyEncoding(e.keyEncoding||this[je]),i=r.format;e.keyEncoding!==i&&(e={...e,keyEncoding:i});let o=this.db.prefixKey(r.encode(t),i);this._seek(o,e)}}}_seek(t,e){throw new Gt("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(t){return t=ba(t,gr),this[Ki]?this.nextTick(t):this[Ge]?this[xn].push(t):(this[Ge]=!0,this[xn].push(t),this[ve]?this[Ta]&&this[He]()(new Gt("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[Tn])),t[gr]}_close(t){this.nextTick(t)}[Tn](){this[Ki]=!0,this.db.detachResource(this);let t=this[xn];this[xn]=[];for(let e of t)e()}async*[Symbol.asyncIterator](){try{let t;for(;(t=await this.next())!==void 0;)yield t}finally{this[Ki]||await this.close()}}},Kr=class extends Cn{constructor(t,e){super(t,e,!0),this[xa]=e.keys!==!1,this[Ca]=e.values!==!1}[pr](t,e,r){let i=this[He]();if(t)return i(t);try{e=this[xa]&&e!==void 0?this[je].decode(e):void 0,r=this[Ca]&&r!==void 0?this[mr].decode(r):void 0}catch(o){return i(new Qe("entry",o))}e===void 0&&r===void 0||this[te]++,i(null,e,r)}[Oe](t,e){let r=this[He]();if(t)return this[_e](r,t);try{for(let i of e){let o=i[0],a=i[1];i[0]=this[xa]&&o!==void 0?this[je].decode(o):void 0,i[1]=this[Ca]&&a!==void 0?this[mr].decode(a):void 0}}catch(i){return this[_e](r,new Qe("entries",i))}this[te]+=e.length,this[_e](r,null,e)}end(t){return!hu&&typeof console<"u"&&(hu=!0,console.warn(new Gt("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(t)}},Ia=class extends Cn{constructor(t,e){super(t,e,!1)}[pr](t,e){let r=this[He]();if(t)return r(t);try{e=e!==void 0?this[je].decode(e):void 0}catch(i){return r(new Qe("key",i))}e!==void 0&&this[te]++,r(null,e)}[Oe](t,e){let r=this[He]();if(t)return this[_e](r,t);try{for(let i=0;i<e.length;i++){let o=e[i];e[i]=o!==void 0?this[je].decode(o):void 0}}catch(i){return this[_e](r,new Qe("keys",i))}this[te]+=e.length,this[_e](r,null,e)}},ka=class extends Cn{constructor(t,e){super(t,e,!1)}[pr](t,e){let r=this[He]();if(t)return r(t);try{e=e!==void 0?this[mr].decode(e):void 0}catch(i){return r(new Qe("value",i))}e!==void 0&&this[te]++,r(null,e)}[Oe](t,e){let r=this[He]();if(t)return this[_e](r,t);try{for(let i=0;i<e.length;i++){let o=e[i];e[i]=o!==void 0?this[mr].decode(o):void 0}}catch(i){return this[_e](r,new Qe("values",i))}this[te]+=e.length,this[_e](r,null,e)}},Qe=class extends Gt{constructor(t,e){super(`Iterator could not decode ${t}`,{code:"LEVEL_DECODE_ERROR",cause:e})}};for(let n of["_ended property","_nexting property","_end method"])Object.defineProperty(Kr.prototype,n.split(" ")[0],{get(){throw new Gt(`The ${n} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new Gt(`The ${n} has been removed`,{code:"LEVEL_LEGACY"})}});Kr.keyEncoding=je;Kr.valueEncoding=mr;qi.AbstractIterator=Kr;qi.AbstractKeyIterator=Ia;qi.AbstractValueIterator=ka});var du=J(Aa=>{"use strict";m();var{AbstractKeyIterator:jh,AbstractValueIterator:Hh}=ze(),yr=Symbol("iterator"),In=Symbol("callback"),Vr=Symbol("handleOne"),wr=Symbol("handleMany"),kn=class extends jh{constructor(t,e){super(t,e),this[yr]=t.iterator({...e,keys:!0,values:!1}),this[Vr]=this[Vr].bind(this),this[wr]=this[wr].bind(this)}},ji=class extends Hh{constructor(t,e){super(t,e),this[yr]=t.iterator({...e,keys:!1,values:!0}),this[Vr]=this[Vr].bind(this),this[wr]=this[wr].bind(this)}};for(let n of[kn,ji]){let t=n===kn,e=t?r=>r[0]:r=>r[1];n.prototype._next=function(r){this[In]=r,this[yr].next(this[Vr])},n.prototype[Vr]=function(r,i,o){let a=this[In];r?a(r):a(null,t?i:o)},n.prototype._nextv=function(r,i,o){this[In]=o,this[yr].nextv(r,i,this[wr])},n.prototype._all=function(r,i){this[In]=i,this[yr].all(r,this[wr])},n.prototype[wr]=function(r,i){let o=this[In];r?o(r):o(null,i.map(e))},n.prototype._seek=function(r,i){this[yr].seek(r,i)},n.prototype._close=function(r){this[yr].close(r)}}Aa.DefaultKeyIterator=kn;Aa.DefaultValueIterator=ji});var gu=J(Xi=>{"use strict";m();var{AbstractIterator:Qh,AbstractKeyIterator:zh,AbstractValueIterator:Jh}=ze(),La=Zt(),$t=Symbol("nut"),Ji=Symbol("undefer"),Yi=Symbol("factory"),Hi=class extends Qh{constructor(t,e){super(t,e),this[$t]=null,this[Yi]=()=>t.iterator(e),this.db.defer(()=>this[Ji]())}},Qi=class extends zh{constructor(t,e){super(t,e),this[$t]=null,this[Yi]=()=>t.keys(e),this.db.defer(()=>this[Ji]())}},zi=class extends Jh{constructor(t,e){super(t,e),this[$t]=null,this[Yi]=()=>t.values(e),this.db.defer(()=>this[Ji]())}};for(let n of[Hi,Qi,zi])n.prototype[Ji]=function(){this.db.status==="open"&&(this[$t]=this[Yi]())},n.prototype._next=function(t){this[$t]!==null?this[$t].next(t):this.db.status==="opening"?this.db.defer(()=>this._next(t)):this.nextTick(t,new La("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._nextv=function(t,e,r){this[$t]!==null?this[$t].nextv(t,e,r):this.db.status==="opening"?this.db.defer(()=>this._nextv(t,e,r)):this.nextTick(r,new La("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._all=function(t,e){this[$t]!==null?this[$t].all(e):this.db.status==="opening"?this.db.defer(()=>this._all(t,e)):this.nextTick(e,new La("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._seek=function(t,e){this[$t]!==null?this[$t]._seek(t,e):this.db.status==="opening"&&this.db.defer(()=>this._seek(t,e))},n.prototype._close=function(t){this[$t]!==null?this[$t].close(t):this.db.status==="opening"?this.db.defer(()=>this._close(t)):this.nextTick(t)};Xi.DeferredIterator=Hi;Xi.DeferredKeyIterator=Qi;Xi.DeferredValueIterator=zi});var Ra=J(mu=>{"use strict";m();var{fromCallback:pu}=En(),Zi=Zt(),{getCallback:Yh,getOptions:Xh}=$i(),to=Symbol("promise"),ee=Symbol("status"),Gr=Symbol("operations"),An=Symbol("finishClose"),qr=Symbol("closeCallbacks"),Oa=class{constructor(t){if(typeof t!="object"||t===null){let e=t===null?"null":typeof t;throw new TypeError(`The first argument must be an abstract-level database, received ${e}`)}this[Gr]=[],this[qr]=[],this[ee]="open",this[An]=this[An].bind(this),this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get length(){return this[Gr].length}put(t,e,r){if(this[ee]!=="open")throw new Zi("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let i=this.db._checkKey(t)||this.db._checkValue(e);if(i)throw i;let o=r&&r.sublevel!=null?r.sublevel:this.db,a=r,s=o.keyEncoding(r&&r.keyEncoding),c=o.valueEncoding(r&&r.valueEncoding),l=s.format;r={...r,keyEncoding:l,valueEncoding:c.format},o!==this.db&&(r.sublevel=null);let p=o.prefixKey(s.encode(t),l),y=c.encode(e);return this._put(p,y,r),this[Gr].push({...a,type:"put",key:t,value:e}),this}_put(t,e,r){}del(t,e){if(this[ee]!=="open")throw new Zi("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let r=this.db._checkKey(t);if(r)throw r;let i=e&&e.sublevel!=null?e.sublevel:this.db,o=e,a=i.keyEncoding(e&&e.keyEncoding),s=a.format;return e={...e,keyEncoding:s},i!==this.db&&(e.sublevel=null),this._del(i.prefixKey(a.encode(t),s),e),this[Gr].push({...o,type:"del",key:t}),this}_del(t,e){}clear(){if(this[ee]!=="open")throw new Zi("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[Gr]=[],this}_clear(){}write(t,e){return e=Yh(t,e),e=pu(e,to),t=Xh(t),this[ee]!=="open"?this.nextTick(e,new Zi("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(e):(this[ee]="writing",this._write(t,r=>{this[ee]="closing",this[qr].push(()=>e(r)),r||this.db.emit("batch",this[Gr]),this._close(this[An])})),e[to]}_write(t,e){}close(t){return t=pu(t,to),this[ee]==="closing"?this[qr].push(t):this[ee]==="closed"?this.nextTick(t):(this[qr].push(t),this[ee]!=="writing"&&(this[ee]="closing",this._close(this[An]))),t[to]}_close(t){this.nextTick(t)}[An](){this[ee]="closed",this.db.detachResource(this);let t=this[qr];this[qr]=[];for(let e of t)e()}};mu.AbstractChainedBatch=Oa});var wu=J(yu=>{"use strict";m();var{AbstractChainedBatch:Zh}=Ra(),td=Zt(),jr=Symbol("encoded"),Ba=class extends Zh{constructor(t){super(t),this[jr]=[]}_put(t,e,r){this[jr].push({...r,type:"put",key:t,value:e})}_del(t,e){this[jr].push({...e,type:"del",key:t})}_clear(){this[jr]=[]}_write(t,e){this.db.status==="opening"?this.db.defer(()=>this._write(t,e)):this.db.status==="open"?this[jr].length===0?this.nextTick(e):this.db._batch(this[jr],t,e):this.nextTick(e,new td("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};yu.DefaultChainedBatch=Ba});var bu=J((dy,_u)=>{"use strict";m();var vu=Zt(),ed=Object.prototype.hasOwnProperty,rd=new Set(["lt","lte","gt","gte"]);_u.exports=function(n,t){let e={};for(let r in n)if(ed.call(n,r)&&!(r==="keyEncoding"||r==="valueEncoding")){if(r==="start"||r==="end")throw new vu(`The legacy range option '${r}' has been removed`,{code:"LEVEL_LEGACY"});if(r==="encoding")throw new vu("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});rd.has(r)?e[r]=t.encode(n[r]):e[r]=n[r]}return e.reverse=!!e.reverse,e.limit=Number.isInteger(e.limit)&&e.limit>=0?e.limit:-1,e}});var Pa=J((py,Eu)=>{m();var Su;Eu.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:P):n=>(Su||(Su=Promise.resolve())).then(n).catch(t=>setTimeout(()=>{throw t},0))});var Cu=J((yy,xu)=>{"use strict";m();var Tu=Pa();xu.exports=function(n,...t){t.length===0?Tu(n):Tu(()=>n(...t))}});var Iu=J(eo=>{"use strict";m();var{AbstractIterator:nd,AbstractKeyIterator:id,AbstractValueIterator:od}=ze(),Hr=Symbol("unfix"),ce=Symbol("iterator"),vr=Symbol("handleOne"),Je=Symbol("handleMany"),Re=Symbol("callback"),Ln=class extends nd{constructor(t,e,r,i){super(t,e),this[ce]=r,this[Hr]=i,this[vr]=this[vr].bind(this),this[Je]=this[Je].bind(this),this[Re]=null}[vr](t,e,r){let i=this[Re];if(t)return i(t);e!==void 0&&(e=this[Hr](e)),i(t,e,r)}[Je](t,e){let r=this[Re];if(t)return r(t);for(let i of e){let o=i[0];o!==void 0&&(i[0]=this[Hr](o))}r(t,e)}},On=class extends id{constructor(t,e,r,i){super(t,e),this[ce]=r,this[Hr]=i,this[vr]=this[vr].bind(this),this[Je]=this[Je].bind(this),this[Re]=null}[vr](t,e){let r=this[Re];if(t)return r(t);e!==void 0&&(e=this[Hr](e)),r(t,e)}[Je](t,e){let r=this[Re];if(t)return r(t);for(let i=0;i<e.length;i++){let o=e[i];o!==void 0&&(e[i]=this[Hr](o))}r(t,e)}},Rn=class extends od{constructor(t,e,r){super(t,e),this[ce]=r}};for(let n of[Ln,On])n.prototype._next=function(t){this[Re]=t,this[ce].next(this[vr])},n.prototype._nextv=function(t,e,r){this[Re]=r,this[ce].nextv(t,e,this[Je])},n.prototype._all=function(t,e){this[Re]=e,this[ce].all(t,this[Je])};for(let n of[Rn])n.prototype._next=function(t){this[ce].next(t)},n.prototype._nextv=function(t,e,r){this[ce].nextv(t,e,r)},n.prototype._all=function(t,e){this[ce].all(t,e)};for(let n of[Ln,On,Rn])n.prototype._seek=function(t,e){this[ce].seek(t,e)},n.prototype._close=function(t){this[ce].close(t)};eo.AbstractSublevelIterator=Ln;eo.AbstractSublevelKeyIterator=On;eo.AbstractSublevelValueIterator=Rn});var Ou=J((by,Lu)=>{"use strict";m();var Na=Zt(),{Buffer:Fa}=Fr()||{},{AbstractSublevelIterator:ad,AbstractSublevelKeyIterator:sd,AbstractSublevelValueIterator:cd}=Iu(),Be=Symbol("prefix"),ku=Symbol("upperBound"),Bn=Symbol("prefixRange"),qt=Symbol("parent"),Wa=Symbol("unfix"),Au=new TextEncoder,ud={separator:"!"};Lu.exports=function({AbstractLevel:n}){class t extends n{static defaults(r){if(typeof r=="string")throw new Na("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(r&&r.open)throw new Na("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return r==null?ud:r.separator?r:{...r,separator:"!"}}constructor(r,i,o){let{separator:a,manifest:s,...c}=t.defaults(o);i=fd(i,a);let l=a.charCodeAt(0)+1,p=r[qt]||r;if(!Au.encode(i).every(f=>f>l&&f<127))throw new Na(`Prefix must use bytes > ${l} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(ld(p,s),c);let y=(r.prefix||"")+a+i+a,I=y.slice(0,-1)+String.fromCharCode(l);this[qt]=p,this[Be]=new ro(y),this[ku]=new ro(I),this[Wa]=new Da,this.nextTick=p.nextTick}prefixKey(r,i){if(i==="utf8")return this[Be].utf8+r;if(r.byteLength===0)return this[Be][i];if(i==="view"){let o=this[Be].view,a=new Uint8Array(o.byteLength+r.byteLength);return a.set(o,0),a.set(r,o.byteLength),a}else{let o=this[Be].buffer;return Fa.concat([o,r],o.byteLength+r.byteLength)}}[Bn](r,i){r.gte!==void 0?r.gte=this.prefixKey(r.gte,i):r.gt!==void 0?r.gt=this.prefixKey(r.gt,i):r.gte=this[Be][i],r.lte!==void 0?r.lte=this.prefixKey(r.lte,i):r.lt!==void 0?r.lt=this.prefixKey(r.lt,i):r.lte=this[ku][i]}get prefix(){return this[Be].utf8}get db(){return this[qt]}_open(r,i){this[qt].open({passive:!0},i)}_put(r,i,o,a){this[qt].put(r,i,o,a)}_get(r,i,o){this[qt].get(r,i,o)}_getMany(r,i,o){this[qt].getMany(r,i,o)}_del(r,i,o){this[qt].del(r,i,o)}_batch(r,i,o){this[qt].batch(r,i,o)}_clear(r,i){this[Bn](r,r.keyEncoding),this[qt].clear(r,i)}_iterator(r){this[Bn](r,r.keyEncoding);let i=this[qt].iterator(r),o=this[Wa].get(this[Be].utf8.length,r.keyEncoding);return new ad(this,r,i,o)}_keys(r){this[Bn](r,r.keyEncoding);let i=this[qt].keys(r),o=this[Wa].get(this[Be].utf8.length,r.keyEncoding);return new sd(this,r,i,o)}_values(r){this[Bn](r,r.keyEncoding);let i=this[qt].values(r);return new cd(this,r,i)}}return{AbstractSublevel:t}};var ld=function(n,t){return{...n.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:Ua(n,"utf8"),buffer:Ua(n,"buffer"),view:Ua(n,"view")}}},Ua=function(n,t){return n.supports.encodings[t]?n.keyEncoding(t).name===t:!1},ro=class{constructor(t){this.utf8=t,this.view=Au.encode(t),this.buffer=Fa?Fa.from(this.view.buffer,0,this.view.byteLength):{}}},Da=class{constructor(){this.cache=new Map}get(t,e){let r=this.cache.get(e);return r===void 0&&(e==="view"?r=function(i,o){return o.subarray(i)}.bind(null,t):r=function(i,o){return o.slice(i)}.bind(null,t),this.cache.set(e,r)),r}},fd=function(n,t){let e=0,r=n.length;for(;e<r&&n[e]===t;)e++;for(;r>e&&n[r-1]===t;)r--;return n.slice(e,r)}});var Ga=J(Va=>{"use strict";m();var{supports:hd}=Mc(),{Transcoder:dd}=Jc(),{EventEmitter:gd}=su(),{fromCallback:Ye}=En(),ue=Zt(),{AbstractIterator:_r}=ze(),{DefaultKeyIterator:pd,DefaultValueIterator:md}=du(),{DeferredIterator:yd,DeferredKeyIterator:wd,DeferredValueIterator:vd}=gu(),{DefaultChainedBatch:Ru}=wu(),{getCallback:br,getOptions:Xe}=$i(),no=bu(),ot=Symbol("promise"),Pe=Symbol("landed"),Sr=Symbol("resources"),Ma=Symbol("closeResources"),Pn=Symbol("operations"),Nn=Symbol("undefer"),io=Symbol("deferOpen"),Bu=Symbol("options"),ct=Symbol("status"),Er=Symbol("defaultOptions"),Qr=Symbol("transcoder"),oo=Symbol("keyEncoding"),$a=Symbol("valueEncoding"),_d=()=>{},Wn=class extends gd{constructor(t,e){if(super(),typeof t!="object"||t===null)throw new TypeError("The first argument 'manifest' must be an object");e=Xe(e);let{keyEncoding:r,valueEncoding:i,passive:o,...a}=e;this[Sr]=new Set,this[Pn]=[],this[io]=!0,this[Bu]=a,this[ct]="opening",this.supports=hd(t,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:t.snapshots!==!1,permanence:t.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:t.encodings||{},events:Object.assign({},t.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[Qr]=new dd(bd(this)),this[oo]=this[Qr].encoding(r||"utf8"),this[$a]=this[Qr].encoding(i||"utf8");for(let s of this[Qr].encodings())this.supports.encodings[s.commonName]||(this.supports.encodings[s.commonName]=!0);this[Er]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[oo].commonName,valueEncoding:this[$a].commonName}),key:Object.freeze({keyEncoding:this[oo].commonName})},this.nextTick(()=>{this[io]&&this.open({passive:!1},_d)})}get status(){return this[ct]}keyEncoding(t){return this[Qr].encoding(t??this[oo])}valueEncoding(t){return this[Qr].encoding(t??this[$a])}open(t,e){e=br(t,e),e=Ye(e,ot),t={...this[Bu],...Xe(t)},t.createIfMissing=t.createIfMissing!==!1,t.errorIfExists=!!t.errorIfExists;let r=i=>{this[ct]==="closing"||this[ct]==="opening"?this.once(Pe,i?()=>r(i):r):this[ct]!=="open"?e(new ue("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):e()};return t.passive?this[ct]==="opening"?this.once(Pe,r):this.nextTick(r):this[ct]==="closed"||this[io]?(this[io]=!1,this[ct]="opening",this.emit("opening"),this._open(t,i=>{if(i){this[ct]="closed",this[Ma](()=>{this.emit(Pe),r(i)}),this[Nn]();return}this[ct]="open",this[Nn](),this.emit(Pe),this[ct]==="open"&&this.emit("open"),this[ct]==="open"&&this.emit("ready"),r()})):this[ct]==="open"?this.nextTick(r):this.once(Pe,()=>this.open(t,e)),e[ot]}_open(t,e){this.nextTick(e)}close(t){t=Ye(t,ot);let e=r=>{this[ct]==="opening"||this[ct]==="closing"?this.once(Pe,r?e(r):e):this[ct]!=="closed"?t(new ue("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):t()};if(this[ct]==="open"){this[ct]="closing",this.emit("closing");let r=i=>{this[ct]="open",this[Nn](),this.emit(Pe),e(i)};this[Ma](()=>{this._close(i=>{if(i)return r(i);this[ct]="closed",this[Nn](),this.emit(Pe),this[ct]==="closed"&&this.emit("closed"),e()})})}else this[ct]==="closed"?this.nextTick(e):this.once(Pe,()=>this.close(t));return t[ot]}[Ma](t){if(this[Sr].size===0)return this.nextTick(t);let e=this[Sr].size,r=!0,i=()=>{--e===0&&(r?this.nextTick(t):t())};for(let o of this[Sr])o.close(i);r=!1,this[Sr].clear()}_close(t){this.nextTick(t)}get(t,e,r){if(r=br(e,r),r=Ye(r,ot),e=Xe(e,this[Er].entry),this[ct]==="opening")return this.defer(()=>this.get(t,e,r)),r[ot];if(zr(this,r))return r[ot];let i=this._checkKey(t);if(i)return this.nextTick(r,i),r[ot];let o=this.keyEncoding(e.keyEncoding),a=this.valueEncoding(e.valueEncoding),s=o.format,c=a.format;return(e.keyEncoding!==s||e.valueEncoding!==c)&&(e=Object.assign({},e,{keyEncoding:s,valueEncoding:c})),this._get(this.prefixKey(o.encode(t),s),e,(l,p)=>{if(l)return(l.code==="LEVEL_NOT_FOUND"||l.notFound||/NotFound/i.test(l))&&(l.code||(l.code="LEVEL_NOT_FOUND"),l.notFound||(l.notFound=!0),l.status||(l.status=404)),r(l);try{p=a.decode(p)}catch(y){return r(new ue("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:y}))}r(null,p)}),r[ot]}_get(t,e,r){this.nextTick(r,new Error("NotFound"))}getMany(t,e,r){if(r=br(e,r),r=Ye(r,ot),e=Xe(e,this[Er].entry),this[ct]==="opening")return this.defer(()=>this.getMany(t,e,r)),r[ot];if(zr(this,r))return r[ot];if(!Array.isArray(t))return this.nextTick(r,new TypeError("The first argument 'keys' must be an array")),r[ot];if(t.length===0)return this.nextTick(r,null,[]),r[ot];let i=this.keyEncoding(e.keyEncoding),o=this.valueEncoding(e.valueEncoding),a=i.format,s=o.format;(e.keyEncoding!==a||e.valueEncoding!==s)&&(e=Object.assign({},e,{keyEncoding:a,valueEncoding:s}));let c=new Array(t.length);for(let l=0;l<t.length;l++){let p=t[l],y=this._checkKey(p);if(y)return this.nextTick(r,y),r[ot];c[l]=this.prefixKey(i.encode(p),a)}return this._getMany(c,e,(l,p)=>{if(l)return r(l);try{for(let y=0;y<p.length;y++)p[y]!==void 0&&(p[y]=o.decode(p[y]))}catch(y){return r(new ue(`Could not decode one or more of ${p.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:y}))}r(null,p)}),r[ot]}_getMany(t,e,r){this.nextTick(r,null,new Array(t.length).fill(void 0))}put(t,e,r,i){if(i=br(r,i),i=Ye(i,ot),r=Xe(r,this[Er].entry),this[ct]==="opening")return this.defer(()=>this.put(t,e,r,i)),i[ot];if(zr(this,i))return i[ot];let o=this._checkKey(t)||this._checkValue(e);if(o)return this.nextTick(i,o),i[ot];let a=this.keyEncoding(r.keyEncoding),s=this.valueEncoding(r.valueEncoding),c=a.format,l=s.format;(r.keyEncoding!==c||r.valueEncoding!==l)&&(r=Object.assign({},r,{keyEncoding:c,valueEncoding:l}));let p=this.prefixKey(a.encode(t),c),y=s.encode(e);return this._put(p,y,r,I=>{if(I)return i(I);this.emit("put",t,e),i()}),i[ot]}_put(t,e,r,i){this.nextTick(i)}del(t,e,r){if(r=br(e,r),r=Ye(r,ot),e=Xe(e,this[Er].key),this[ct]==="opening")return this.defer(()=>this.del(t,e,r)),r[ot];if(zr(this,r))return r[ot];let i=this._checkKey(t);if(i)return this.nextTick(r,i),r[ot];let o=this.keyEncoding(e.keyEncoding),a=o.format;return e.keyEncoding!==a&&(e=Object.assign({},e,{keyEncoding:a})),this._del(this.prefixKey(o.encode(t),a),e,s=>{if(s)return r(s);this.emit("del",t),r()}),r[ot]}_del(t,e,r){this.nextTick(r)}batch(t,e,r){if(!arguments.length){if(this[ct]==="opening")return new Ru(this);if(this[ct]!=="open")throw new ue("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof t=="function"?r=t:r=br(e,r),r=Ye(r,ot),e=Xe(e,this[Er].empty),this[ct]==="opening")return this.defer(()=>this.batch(t,e,r)),r[ot];if(zr(this,r))return r[ot];if(!Array.isArray(t))return this.nextTick(r,new TypeError("The first argument 'operations' must be an array")),r[ot];if(t.length===0)return this.nextTick(r),r[ot];let i=new Array(t.length),{keyEncoding:o,valueEncoding:a,...s}=e;for(let c=0;c<t.length;c++){if(typeof t[c]!="object"||t[c]===null)return this.nextTick(r,new TypeError("A batch operation must be an object")),r[ot];let l=Object.assign({},t[c]);if(l.type!=="put"&&l.type!=="del")return this.nextTick(r,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[ot];let p=this._checkKey(l.key);if(p)return this.nextTick(r,p),r[ot];let y=l.sublevel!=null?l.sublevel:this,I=y.keyEncoding(l.keyEncoding||o),f=I.format;if(l.key=y.prefixKey(I.encode(l.key),f),l.keyEncoding=f,l.type==="put"){let v=this._checkValue(l.value);if(v)return this.nextTick(r,v),r[ot];let L=y.valueEncoding(l.valueEncoding||a);l.value=L.encode(l.value),l.valueEncoding=L.format}y!==this&&(l.sublevel=null),i[c]=l}return this._batch(i,s,c=>{if(c)return r(c);this.emit("batch",t),r()}),r[ot]}_batch(t,e,r){this.nextTick(r)}sublevel(t,e){return this._sublevel(t,Ka.defaults(e))}_sublevel(t,e){return new Ka(this,t,e)}prefixKey(t,e){return t}clear(t,e){if(e=br(t,e),e=Ye(e,ot),t=Xe(t,this[Er].empty),this[ct]==="opening")return this.defer(()=>this.clear(t,e)),e[ot];if(zr(this,e))return e[ot];let r=t,i=this.keyEncoding(t.keyEncoding);return t=no(t,i),t.keyEncoding=i.format,t.limit===0?this.nextTick(e):this._clear(t,o=>{if(o)return e(o);this.emit("clear",r),e()}),e[ot]}_clear(t,e){this.nextTick(e)}iterator(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=no(t,e),t.keys=t.keys!==!1,t.values=t.values!==!1,t[_r.keyEncoding]=e,t[_r.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[ct]==="opening")return new yd(this,t);if(this[ct]!=="open")throw new ue("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(t)}_iterator(t){return new _r(this,t)}keys(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=no(t,e),t[_r.keyEncoding]=e,t[_r.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[ct]==="opening")return new wd(this,t);if(this[ct]!=="open")throw new ue("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(t)}_keys(t){return new pd(this,t)}values(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=no(t,e),t[_r.keyEncoding]=e,t[_r.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[ct]==="opening")return new vd(this,t);if(this[ct]!=="open")throw new ue("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(t)}_values(t){return new md(this,t)}defer(t){if(typeof t!="function")throw new TypeError("The first argument must be a function");this[Pn].push(t)}[Nn](){if(this[Pn].length===0)return;let t=this[Pn];this[Pn]=[];for(let e of t)e()}attachResource(t){if(typeof t!="object"||t===null||typeof t.close!="function")throw new TypeError("The first argument must be a resource object");this[Sr].add(t)}detachResource(t){this[Sr].delete(t)}_chainedBatch(){return new Ru(this)}_checkKey(t){if(t==null)return new ue("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(t){if(t==null)return new ue("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};Wn.prototype.nextTick=Cu();var{AbstractSublevel:Ka}=Ou()({AbstractLevel:Wn});Va.AbstractLevel=Wn;Va.AbstractSublevel=Ka;var zr=function(n,t){return n[ct]!=="open"?(n.nextTick(t,new ue("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},bd=function(n){return Object.keys(n.supports.encodings).filter(t=>!!n.supports.encodings[t])}});var ao=J(Tr=>{"use strict";m();Tr.AbstractLevel=Ga().AbstractLevel;Tr.AbstractSublevel=Ga().AbstractSublevel;Tr.AbstractIterator=ze().AbstractIterator;Tr.AbstractKeyIterator=ze().AbstractKeyIterator;Tr.AbstractValueIterator=ze().AbstractValueIterator;Tr.AbstractChainedBatch=Ra().AbstractChainedBatch});var Nu=J((Iy,Pu)=>{m();Pu.exports=Ed;var Sd=Pa();function Ed(n,t,e){if(typeof t!="number")throw new Error("second argument must be a Number");let r,i,o,a,s,c=!0,l;Array.isArray(n)?(r=[],o=i=n.length):(a=Object.keys(n),r={},o=i=a.length);function p(I){function f(){e&&e(I,r),e=null}c?Sd(f):f()}function y(I,f,v){if(r[I]=v,f&&(s=!0),--o===0||f)p(f);else if(!s&&l<i){let L;a?(L=a[l],l+=1,n[L](function(U,$){y(L,U,$)})):(L=l,l+=1,n[L](function(U,$){y(L,U,$)}))}}l=t,o?a?a.some(function(I,f){return n[I](function(v,L){y(I,v,L)}),f===t-1}):n.some(function(I,f){return I(function(v,L){y(f,v,L)}),f===t-1}):p(null),c=!1}});var qa=J((Ay,Wu)=>{"use strict";m();Wu.exports=function(t){let e=t.gte!==void 0?t.gte:t.gt!==void 0?t.gt:void 0,r=t.lte!==void 0?t.lte:t.lt!==void 0?t.lt:void 0,i=t.gte===void 0,o=t.lte===void 0;return e!==void 0&&r!==void 0?IDBKeyRange.bound(e,r,i,o):e!==void 0?IDBKeyRange.lowerBound(e,i):r!==void 0?IDBKeyRange.upperBound(r,o):null}});var ja=J((Oy,Uu)=>{"use strict";m();var Td=new TextEncoder;Uu.exports=function(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):Td.encode(n)}});var Ku=J($u=>{"use strict";m();var{AbstractIterator:xd}=ao(),Fu=qa(),so=ja(),be=Symbol("cache"),Ne=Symbol("finished"),jt=Symbol("options"),We=Symbol("currentOptions"),xr=Symbol("position"),Ha=Symbol("location"),Jr=Symbol("first"),Du={},Qa=class extends xd{constructor(t,e,r){super(t,r),this[be]=[],this[Ne]=this.limit===0,this[jt]=r,this[We]={...r},this[xr]=void 0,this[Ha]=e,this[Jr]=!0}_nextv(t,e,r){if(this[Jr]=!1,this[Ne])return this.nextTick(r,null,[]);if(this[be].length>0)return t=Math.min(t,this[be].length),this.nextTick(r,null,this[be].splice(0,t));this[xr]!==void 0&&(this[jt].reverse?(this[We].lt=this[xr],this[We].lte=void 0):(this[We].gt=this[xr],this[We].gte=void 0));let i;try{i=Fu(this[We])}catch{return this[Ne]=!0,this.nextTick(r,null,[])}let o=this.db.db.transaction([this[Ha]],"readonly"),a=o.objectStore(this[Ha]),s=[];if(this[jt].reverse){let c=!this[jt].values&&a.openKeyCursor?"openKeyCursor":"openCursor";a[c](i,"prev").onsuccess=l=>{let p=l.target.result;if(p){let{key:y,value:I}=p;this[xr]=y,s.push([this[jt].keys&&y!==void 0?so(y):void 0,this[jt].values&&I!==void 0?so(I):void 0]),s.length<t?p.continue():Mu(o)}else this[Ne]=!0}}else{let c,l,p=()=>{if(c===void 0||l===void 0)return;let y=Math.max(c.length,l.length);y===0||t===1/0?this[Ne]=!0:this[xr]=c[y-1],s.length=y;for(let I=0;I<y;I++){let f=c[I],v=l[I];s[I]=[this[jt].keys&&f!==void 0?so(f):void 0,this[jt].values&&v!==void 0?so(v):void 0]}Mu(o)};this[jt].keys||t<1/0?a.getAllKeys(i,t<1/0?t:void 0).onsuccess=y=>{c=y.target.result,p()}:(c=[],this.nextTick(p)),this[jt].values?a.getAll(i,t<1/0?t:void 0).onsuccess=y=>{l=y.target.result,p()}:(l=[],this.nextTick(p))}o.onabort=()=>{r(o.error||new Error("aborted by user")),r=null},o.oncomplete=()=>{r(null,s),r=null}}_next(t){if(this[be].length>0){let[e,r]=this[be].shift();this.nextTick(t,null,e,r)}else if(this[Ne])this.nextTick(t);else{let e=Math.min(100,this.limit-this.count);this[Jr]&&(this[Jr]=!1,e=1),this._nextv(e,Du,(r,i)=>{if(r)return t(r);this[be]=i,this._next(t)})}}_all(t,e){this[Jr]=!1;let r=this[be].splice(0,this[be].length),i=this.limit-this.count-r.length;if(i<=0)return this.nextTick(e,null,r);this._nextv(i,Du,(o,a)=>{if(o)return e(o);r.length>0&&(a=r.concat(a)),e(null,a)})}_seek(t,e){this[Jr]=!0,this[be]=[],this[Ne]=!1,this[xr]=void 0,this[We]={...this[jt]};let r;try{r=Fu(this[jt])}catch{this[Ne]=!0;return}r!==null&&!r.includes(t)?this[Ne]=!0:this[jt].reverse?this[We].lte=t:this[We].gte=t}};$u.Iterator=Qa;function Mu(n){typeof n.commit=="function"&&n.commit()}});var Gu=J((Ny,Vu)=>{"use strict";m();Vu.exports=function(t,e,r,i,o){if(i.limit===0)return t.nextTick(o);let a=t.db.transaction([e],"readwrite"),s=a.objectStore(e),c=0;a.oncomplete=function(){o()},a.onabort=function(){o(a.error||new Error("aborted by user"))};let l=s.openKeyCursor?"openKeyCursor":"openCursor",p=i.reverse?"prev":"next";s[l](r,p).onsuccess=function(y){let I=y.target.result;I&&(s.delete(I.key).onsuccess=function(){(i.limit<=0||++c<i.limit)&&I.continue()})}}});var Ju=J(zu=>{"use strict";m();var{AbstractLevel:Cd}=ao(),qu=Zt(),Id=Nu(),{fromCallback:kd}=En(),{Iterator:Ad}=Ku(),ju=ja(),Ld=Gu(),Od=qa(),Qu="level-js-",Un=Symbol("idb"),za=Symbol("namePrefix"),Ue=Symbol("location"),Ja=Symbol("version"),Cr=Symbol("store"),Fn=Symbol("onComplete"),Hu=Symbol("promise"),co=class extends Cd{constructor(t,e,r){if(typeof e=="function"||typeof r=="function")throw new qu("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:i,version:o,...a}=e||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},a),typeof t!="string")throw new Error("constructor requires a location string argument");this[Ue]=t,this[za]=i??Qu,this[Ja]=parseInt(o||1,10),this[Un]=null}get location(){return this[Ue]}get namePrefix(){return this[za]}get version(){return this[Ja]}get db(){return this[Un]}get type(){return"browser-level"}_open(t,e){let r=indexedDB.open(this[za]+this[Ue],this[Ja]);r.onerror=function(){e(r.error||new Error("unknown error"))},r.onsuccess=()=>{this[Un]=r.result,e()},r.onupgradeneeded=i=>{let o=i.target.result;o.objectStoreNames.contains(this[Ue])||o.createObjectStore(this[Ue])}}[Cr](t){return this[Un].transaction([this[Ue]],t).objectStore(this[Ue])}[Fn](t,e){let r=t.transaction;r.onabort=function(){e(r.error||new Error("aborted by user"))},r.oncomplete=function(){e(null,t.result)}}_get(t,e,r){let i=this[Cr]("readonly"),o;try{o=i.get(t)}catch(a){return this.nextTick(r,a)}this[Fn](o,function(a,s){if(a)return r(a);if(s===void 0)return r(new qu("Entry not found",{code:"LEVEL_NOT_FOUND"}));r(null,ju(s))})}_getMany(t,e,r){let i=this[Cr]("readonly"),o=t.map(a=>s=>{let c;try{c=i.get(a)}catch(l){return s(l)}c.onsuccess=()=>{let l=c.result;s(null,l===void 0?l:ju(l))},c.onerror=l=>{l.stopPropagation(),s(c.error)}});Id(o,16,r)}_del(t,e,r){let i=this[Cr]("readwrite"),o;try{o=i.delete(t)}catch(a){return this.nextTick(r,a)}this[Fn](o,r)}_put(t,e,r,i){let o=this[Cr]("readwrite"),a;try{a=o.put(e,t)}catch(s){return this.nextTick(i,s)}this[Fn](a,i)}_iterator(t){return new Ad(this,this[Ue],t)}_batch(t,e,r){let i=this[Cr]("readwrite"),o=i.transaction,a=0,s;o.onabort=function(){r(s||o.error||new Error("aborted by user"))},o.oncomplete=function(){r()};function c(){let l=t[a++],p=l.key,y;try{y=l.type==="del"?i.delete(p):i.put(l.value,p)}catch(I){s=I,o.abort();return}a<t.length?y.onsuccess=c:typeof o.commit=="function"&&o.commit()}c()}_clear(t,e){let r,i;try{r=Od(t)}catch{return this.nextTick(e)}if(t.limit>=0)return Ld(this,this[Ue],r,t,e);try{let o=this[Cr]("readwrite");i=r?o.delete(r):o.clear()}catch(o){return this.nextTick(e,o)}this[Fn](i,e)}_close(t){this[Un].close(),this.nextTick(t)}};co.destroy=function(n,t,e){typeof t=="function"&&(e=t,t=Qu),e=kd(e,Hu);let r=indexedDB.deleteDatabase(t+n);return r.onsuccess=function(){e()},r.onerror=function(i){e(i)},e[Hu]};zu.BrowserLevel=co});var Xu=J(Yu=>{m();Yu.Level=Ju().BrowserLevel});var el=J(($y,tl)=>{"use strict";m();tl.exports=Pd;var yt=0,ht=1;function Ht(n,t,e,r,i,o){this._color=n,this.key=t,this.value=e,this.left=r,this.right=i,this._count=o}function Se(n){return new Ht(n._color,n.key,n.value,n.left,n.right,n._count)}function Ze(n,t){return new Ht(n,t.key,t.value,t.left,t.right,t._count)}function wt(n){n._count=1+(n.left?n.left._count:0)+(n.right?n.right._count:0)}function tr(n,t){this._compare=n,this.root=t}var Nt=tr.prototype;Object.defineProperty(Nt,"keys",{get:function(){var n=[];return this.forEach(function(t,e){n.push(t)}),n}});Object.defineProperty(Nt,"values",{get:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n}});Object.defineProperty(Nt,"length",{get:function(){return this.root?this.root._count:0}});Nt.insert=function(n,t){for(var e=this._compare,r=this.root,i=[],o=[];r;){var a=e(n,r.key);i.push(r),o.push(a),a<=0?r=r.left:r=r.right}i.push(new Ht(yt,n,t,null,null,1));for(var s=i.length-2;s>=0;--s){var r=i[s];o[s]<=0?i[s]=new Ht(r._color,r.key,r.value,i[s+1],r.right,r._count+1):i[s]=new Ht(r._color,r.key,r.value,r.left,i[s+1],r._count+1)}for(var s=i.length-1;s>1;--s){var c=i[s-1],r=i[s];if(c._color===ht||r._color===ht)break;var l=i[s-2];if(l.left===c)if(c.left===r){var p=l.right;if(p&&p._color===yt)c._color=ht,l.right=Ze(ht,p),l._color=yt,s-=1;else{if(l._color=yt,l.left=c.right,c._color=ht,c.right=l,i[s-2]=c,i[s-1]=r,wt(l),wt(c),s>=3){var y=i[s-3];y.left===l?y.left=c:y.right=c}break}}else{var p=l.right;if(p&&p._color===yt)c._color=ht,l.right=Ze(ht,p),l._color=yt,s-=1;else{if(c.right=r.left,l._color=yt,l.left=r.right,r._color=ht,r.left=c,r.right=l,i[s-2]=r,i[s-1]=c,wt(l),wt(c),wt(r),s>=3){var y=i[s-3];y.left===l?y.left=r:y.right=r}break}}else if(c.right===r){var p=l.left;if(p&&p._color===yt)c._color=ht,l.left=Ze(ht,p),l._color=yt,s-=1;else{if(l._color=yt,l.right=c.left,c._color=ht,c.left=l,i[s-2]=c,i[s-1]=r,wt(l),wt(c),s>=3){var y=i[s-3];y.right===l?y.right=c:y.left=c}break}}else{var p=l.left;if(p&&p._color===yt)c._color=ht,l.left=Ze(ht,p),l._color=yt,s-=1;else{if(c.left=r.right,l._color=yt,l.right=r.left,r._color=ht,r.right=c,r.left=l,i[s-2]=r,i[s-1]=c,wt(l),wt(c),wt(r),s>=3){var y=i[s-3];y.right===l?y.right=r:y.left=r}break}}}return i[0]._color=ht,new tr(e,i[0])};function Ya(n,t){if(t.left){var e=Ya(n,t.left);if(e)return e}var e=n(t.key,t.value);if(e)return e;if(t.right)return Ya(n,t.right)}function Xa(n,t,e,r){var i=t(n,r.key);if(i<=0){if(r.left){var o=Xa(n,t,e,r.left);if(o)return o}var o=e(r.key,r.value);if(o)return o}if(r.right)return Xa(n,t,e,r.right)}function Za(n,t,e,r,i){var o=e(n,i.key),a=e(t,i.key),s;if(o<=0&&(i.left&&(s=Za(n,t,e,r,i.left),s)||a>0&&(s=r(i.key,i.value),s)))return s;if(a>0&&i.right)return Za(n,t,e,r,i.right)}Nt.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return Ya(t,this.root);case 2:return Xa(e,this._compare,t,this.root);case 3:return this._compare(e,r)>=0?void 0:Za(e,r,this._compare,t,this.root)}};Object.defineProperty(Nt,"begin",{get:function(){for(var n=[],t=this.root;t;)n.push(t),t=t.left;return new Qt(this,n)}});Object.defineProperty(Nt,"end",{get:function(){for(var n=[],t=this.root;t;)n.push(t),t=t.right;return new Qt(this,n)}});Nt.at=function(n){if(n<0)return new Qt(this,[]);for(var t=this.root,e=[];;){if(e.push(t),t.left){if(n<t.left._count){t=t.left;continue}n-=t.left._count}if(!n)return new Qt(this,e);if(n-=1,t.right){if(n>=t.right._count)break;t=t.right}else break}return new Qt(this,[])};Nt.ge=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o<=0&&(i=r.length),o<=0?e=e.left:e=e.right}return r.length=i,new Qt(this,r)};Nt.gt=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o<0&&(i=r.length),o<0?e=e.left:e=e.right}return r.length=i,new Qt(this,r)};Nt.lt=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o>0&&(i=r.length),o<=0?e=e.left:e=e.right}return r.length=i,new Qt(this,r)};Nt.le=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o>=0&&(i=r.length),o<0?e=e.left:e=e.right}return r.length=i,new Qt(this,r)};Nt.find=function(n){for(var t=this._compare,e=this.root,r=[];e;){var i=t(n,e.key);if(r.push(e),i===0)return new Qt(this,r);i<=0?e=e.left:e=e.right}return new Qt(this,[])};Nt.remove=function(n){var t=this.find(n);return t?t.remove():this};Nt.get=function(n){for(var t=this._compare,e=this.root;e;){var r=t(n,e.key);if(r===0)return e.value;r<=0?e=e.left:e=e.right}};function Qt(n,t){this.tree=n,this._stack=t}var re=Qt.prototype;Object.defineProperty(re,"valid",{get:function(){return this._stack.length>0}});Object.defineProperty(re,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0});re.clone=function(){return new Qt(this.tree,this._stack.slice())};function Zu(n,t){n.key=t.key,n.value=t.value,n.left=t.left,n.right=t.right,n._color=t._color,n._count=t._count}function Rd(n){for(var t,e,r,i,o=n.length-1;o>=0;--o){if(t=n[o],o===0){t._color=ht;return}if(e=n[o-1],e.left===t){if(r=e.right,r.right&&r.right._color===yt){if(r=e.right=Se(r),i=r.right=Se(r.right),e.right=r.left,r.left=e,r.right=i,r._color=e._color,t._color=ht,e._color=ht,i._color=ht,wt(e),wt(r),o>1){var a=n[o-2];a.left===e?a.left=r:a.right=r}n[o-1]=r;return}else if(r.left&&r.left._color===yt){if(r=e.right=Se(r),i=r.left=Se(r.left),e.right=i.left,r.left=i.right,i.left=e,i.right=r,i._color=e._color,e._color=ht,r._color=ht,t._color=ht,wt(e),wt(r),wt(i),o>1){var a=n[o-2];a.left===e?a.left=i:a.right=i}n[o-1]=i;return}if(r._color===ht)if(e._color===yt){e._color=ht,e.right=Ze(yt,r);return}else{e.right=Ze(yt,r);continue}else{if(r=Se(r),e.right=r.left,r.left=e,r._color=e._color,e._color=yt,wt(e),wt(r),o>1){var a=n[o-2];a.left===e?a.left=r:a.right=r}n[o-1]=r,n[o]=e,o+1<n.length?n[o+1]=t:n.push(t),o=o+2}}else{if(r=e.left,r.left&&r.left._color===yt){if(r=e.left=Se(r),i=r.left=Se(r.left),e.left=r.right,r.right=e,r.left=i,r._color=e._color,t._color=ht,e._color=ht,i._color=ht,wt(e),wt(r),o>1){var a=n[o-2];a.right===e?a.right=r:a.left=r}n[o-1]=r;return}else if(r.right&&r.right._color===yt){if(r=e.left=Se(r),i=r.right=Se(r.right),e.left=i.right,r.right=i.left,i.right=e,i.left=r,i._color=e._color,e._color=ht,r._color=ht,t._color=ht,wt(e),wt(r),wt(i),o>1){var a=n[o-2];a.right===e?a.right=i:a.left=i}n[o-1]=i;return}if(r._color===ht)if(e._color===yt){e._color=ht,e.left=Ze(yt,r);return}else{e.left=Ze(yt,r);continue}else{if(r=Se(r),e.left=r.right,r.right=e,r._color=e._color,e._color=yt,wt(e),wt(r),o>1){var a=n[o-2];a.right===e?a.right=r:a.left=r}n[o-1]=r,n[o]=e,o+1<n.length?n[o+1]=t:n.push(t),o=o+2}}}}re.remove=function(){var n=this._stack;if(n.length===0)return this.tree;var t=new Array(n.length),e=n[n.length-1];t[t.length-1]=new Ht(e._color,e.key,e.value,e.left,e.right,e._count);for(var r=n.length-2;r>=0;--r){var e=n[r];e.left===n[r+1]?t[r]=new Ht(e._color,e.key,e.value,t[r+1],e.right,e._count):t[r]=new Ht(e._color,e.key,e.value,e.left,t[r+1],e._count)}if(e=t[t.length-1],e.left&&e.right){var i=t.length;for(e=e.left;e.right;)t.push(e),e=e.right;var o=t[i-1];t.push(new Ht(e._color,o.key,o.value,e.left,e.right,e._count)),t[i-1].key=e.key,t[i-1].value=e.value;for(var r=t.length-2;r>=i;--r)e=t[r],t[r]=new Ht(e._color,e.key,e.value,e.left,t[r+1],e._count);t[i-1].left=t[i]}if(e=t[t.length-1],e._color===yt){var a=t[t.length-2];a.left===e?a.left=null:a.right===e&&(a.right=null),t.pop();for(var r=0;r<t.length;++r)t[r]._count--;return new tr(this.tree._compare,t[0])}else if(e.left||e.right){e.left?Zu(e,e.left):e.right&&Zu(e,e.right),e._color=ht;for(var r=0;r<t.length-1;++r)t[r]._count--;return new tr(this.tree._compare,t[0])}else{if(t.length===1)return new tr(this.tree._compare,null);for(var r=0;r<t.length;++r)t[r]._count--;var s=t[t.length-2];Rd(t),s.left===e?s.left=null:s.right=null}return new tr(this.tree._compare,t[0])};Object.defineProperty(re,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0});Object.defineProperty(re,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0});Object.defineProperty(re,"index",{get:function(){var n=0,t=this._stack;if(t.length===0){var e=this.tree.root;return e?e._count:0}else t[t.length-1].left&&(n=t[t.length-1].left._count);for(var r=t.length-2;r>=0;--r)t[r+1]===t[r].right&&(++n,t[r].left&&(n+=t[r].left._count));return n},enumerable:!0});re.next=function(){var n=this._stack;if(n.length!==0){var t=n[n.length-1];if(t.right)for(t=t.right;t;)n.push(t),t=t.left;else for(n.pop();n.length>0&&n[n.length-1].right===t;)t=n[n.length-1],n.pop()}};Object.defineProperty(re,"hasNext",{get:function(){var n=this._stack;if(n.length===0)return!1;if(n[n.length-1].right)return!0;for(var t=n.length-1;t>0;--t)if(n[t-1].left===n[t])return!0;return!1}});re.update=function(n){var t=this._stack;if(t.length===0)throw new Error("Can't update empty node!");var e=new Array(t.length),r=t[t.length-1];e[e.length-1]=new Ht(r._color,r.key,n,r.left,r.right,r._count);for(var i=t.length-2;i>=0;--i)r=t[i],r.left===t[i+1]?e[i]=new Ht(r._color,r.key,r.value,e[i+1],r.right,r._count):e[i]=new Ht(r._color,r.key,r.value,r.left,e[i+1],r._count);return new tr(this.tree._compare,e[0])};re.prev=function(){var n=this._stack;if(n.length!==0){var t=n[n.length-1];if(t.left)for(t=t.left;t;)n.push(t),t=t.right;else for(n.pop();n.length>0&&n[n.length-1].left===t;)t=n[n.length-1],n.pop()}};Object.defineProperty(re,"hasPrev",{get:function(){var n=this._stack;if(n.length===0)return!1;if(n[n.length-1].left)return!0;for(var t=n.length-1;t>0;--t)if(n[t-1].right===n[t])return!0;return!1}});function Bd(n,t){return n<t?-1:n>t?1:0}function Pd(n){return new tr(n||Bd,null)}});var al=J(ol=>{"use strict";m();var{AbstractLevel:Nd,AbstractIterator:Wd,AbstractKeyIterator:Ud,AbstractValueIterator:Fd}=ao(),rl=Zt(),nl=el(),Dd=new Set(["gt","gte","lt","lte"]),Fe=Symbol("none"),kt=Symbol("tree"),lt=Symbol("iterator"),zt=Symbol("lowerBound"),er=Symbol("upperBound"),il=Symbol("outOfRange"),uo=Symbol("reverse"),ts=Symbol("options"),Kt=Symbol("test"),ne=Symbol("advance"),po=Symbol("init");function Ee(n,t){if(typeof n=="string")return n<t?-1:n>t?1:0;let e=Math.min(n.byteLength,t.byteLength);for(let r=0;r<e;r++){let i=n[r]-t[r];if(i!==0)return i}return n.byteLength-t.byteLength}function Md(n){return Ee(n,this[er])>0}function $d(n){return Ee(n,this[er])>=0}function Kd(n){return Ee(n,this[er])<0}function Vd(n){return Ee(n,this[er])<=0}var lo=class extends Wd{constructor(t,e){super(t,e),this[po](t[kt],e)}_next(t){if(!this[lt].valid)return this.nextTick(t);let e=this[lt].key,r=this[lt].value;if(!this[Kt](e))return this.nextTick(t);this[lt][this[ne]](),this.nextTick(t,null,e,r)}_nextv(t,e,r){let i=this[lt],o=[];for(;i.valid&&o.length<t&&this[Kt](i.key);)o.push([i.key,i.value]),i[this[ne]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[lt],o=[];for(;i.valid&&o.length<r&&this[Kt](i.key);)o.push([i.key,i.value]),i[this[ne]]();this.nextTick(e,null,o)}},fo=class extends Ud{constructor(t,e){super(t,e),this[po](t[kt],e)}_next(t){if(!this[lt].valid)return this.nextTick(t);let e=this[lt].key;if(!this[Kt](e))return this.nextTick(t);this[lt][this[ne]](),this.nextTick(t,null,e)}_nextv(t,e,r){let i=this[lt],o=[];for(;i.valid&&o.length<t&&this[Kt](i.key);)o.push(i.key),i[this[ne]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[lt],o=[];for(;i.valid&&o.length<r&&this[Kt](i.key);)o.push(i.key),i[this[ne]]();this.nextTick(e,null,o)}},ho=class extends Fd{constructor(t,e){super(t,e),this[po](t[kt],e)}_next(t){if(!this[lt].valid)return this.nextTick(t);let e=this[lt].key,r=this[lt].value;if(!this[Kt](e))return this.nextTick(t);this[lt][this[ne]](),this.nextTick(t,null,r)}_nextv(t,e,r){let i=this[lt],o=[];for(;i.valid&&o.length<t&&this[Kt](i.key);)o.push(i.value),i[this[ne]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[lt],o=[];for(;i.valid&&o.length<r&&this[Kt](i.key);)o.push(i.value),i[this[ne]]();this.nextTick(e,null,o)}};for(let n of[lo,fo,ho])n.prototype[po]=function(t,e){this[uo]=e.reverse,this[ts]=e,this[uo]?(this[ne]="prev",this[zt]="lte"in e?e.lte:"lt"in e?e.lt:Fe,this[er]="gte"in e?e.gte:"gt"in e?e.gt:Fe,this[zt]===Fe?this[lt]=t.end:"lte"in e?this[lt]=t.le(this[zt]):this[lt]=t.lt(this[zt]),this[er]!==Fe&&(this[Kt]="gte"in e?$d:Md)):(this[ne]="next",this[zt]="gte"in e?e.gte:"gt"in e?e.gt:Fe,this[er]="lte"in e?e.lte:"lt"in e?e.lt:Fe,this[zt]===Fe?this[lt]=t.begin:"gte"in e?this[lt]=t.ge(this[zt]):this[lt]=t.gt(this[zt]),this[er]!==Fe&&(this[Kt]="lte"in e?Vd:Kd))},n.prototype[Kt]=function(){return!0},n.prototype[il]=function(t){return this[Kt](t)?this[zt]===Fe?!1:this[uo]?"lte"in this[ts]?Ee(t,this[zt])>0:Ee(t,this[zt])>=0:"gte"in this[ts]?Ee(t,this[zt])<0:Ee(t,this[zt])<=0:!0},n.prototype._seek=function(t,e){this[il](t)?(this[lt]=this[lt].tree.end,this[lt].next()):this[uo]?this[lt]=this[lt].tree.le(t):this[lt]=this[lt].tree.ge(t)};var go=class extends Nd{constructor(t,e,r){if(typeof t=="object"&&t!==null&&(e=t),typeof t=="function"||typeof e=="function"||typeof r=="function")throw new rl("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{storeEncoding:i,...o}=e||{};if(i=i||"buffer",!["buffer","view","utf8"].includes(i))throw new rl("The storeEncoding option must be 'buffer', 'view' or 'utf8'",{code:"LEVEL_ENCODING_NOT_SUPPORTED"});super({seek:!0,permanence:!1,createIfMissing:!1,errorIfExists:!1,encodings:{[i]:!0}},o),this[kt]=nl(Ee)}_put(t,e,r,i){let o=this[kt].find(t);o.valid?this[kt]=o.update(e):this[kt]=this[kt].insert(t,e),this.nextTick(i)}_get(t,e,r){let i=this[kt].get(t);if(typeof i>"u")return this.nextTick(r,new Error("NotFound"));this.nextTick(r,null,i)}_getMany(t,e,r){this.nextTick(r,null,t.map(i=>this[kt].get(i)))}_del(t,e,r){this[kt]=this[kt].remove(t),this.nextTick(r)}_batch(t,e,r){let i=this[kt];for(let o of t){let a=o.key,s=i.find(a);o.type==="put"?i=s.valid?s.update(o.value):i.insert(a,o.value):i=s.remove()}this[kt]=i,this.nextTick(r)}_clear(t,e){if(t.limit===-1&&!Object.keys(t).some(Gd))return this[kt]=nl(Ee),this.nextTick(e);let r=this._keys({...t}),i=r.limit,o=0,a=()=>{for(let s=0;s<500;s++){if(++o>i||!r[lt].valid||!r[Kt](r[lt].key))return e();this[kt]=this[kt].remove(r[lt].key),r[lt][r[ne]]()}this.nextTick(a)};this.nextTick(a)}_iterator(t){return new lo(this,t)}_keys(t){return new fo(this,t)}_values(t){return new ho(this,t)}};ol.MemoryLevel=go;if(typeof B.default<"u"&&!B.default.browser&&typeof P<"u"&&typeof P.setImmediate=="function"){let n=P.setImmediate;go.prototype.nextTick=function(t,...e){e.length===0?n(t):n(()=>t(...e))}}function Gd(n){return Dd.has(n)}});var rr=J((tw,ul)=>{m();window.global=window;P.fetch=window.fetch;ul.exports={Buffer:Fr().Buffer,Crypto:window.crypto}});var us=J((Sl,vo)=>{m();(function(n){"use strict";var t,e=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,i=Math.floor,o="[BigNumber Error] ",a=o+"Number primitive has more than 15 significant digits: ",s=1e14,c=14,l=9007199254740991,p=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],y=1e7,I=1e9;function f(R){var M,tt,z,x=K.prototype={constructor:K,toString:null,valueOf:null},it=new K(1),Q=20,Y=4,ut=-7,dt=21,bt=-1e7,mt=1e7,q=!1,he=1,de=0,hn={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Vt="0123456789abcdefghijklmnopqrstuvwxyz",cr=!0;function K(h,g){var w,A,S,T,O,b,E,C,k=this;if(!(k instanceof K))return new K(h,g);if(g==null){if(h&&h._isBigNumber===!0){k.s=h.s,!h.c||h.e>mt?k.c=k.e=null:h.e<bt?k.c=[k.e=0]:(k.e=h.e,k.c=h.c.slice());return}if((b=typeof h=="number")&&h*0==0){if(k.s=1/h<0?(h=-h,-1):1,h===~~h){for(T=0,O=h;O>=10;O/=10,T++);T>mt?k.c=k.e=null:(k.e=T,k.c=[h]);return}C=String(h)}else{if(!e.test(C=String(h)))return z(k,C,b);k.s=C.charCodeAt(0)==45?(C=C.slice(1),-1):1}(T=C.indexOf("."))>-1&&(C=C.replace(".","")),(O=C.search(/e/i))>0?(T<0&&(T=O),T+=+C.slice(O+1),C=C.substring(0,O)):T<0&&(T=C.length)}else{if($(g,2,Vt.length,"Base"),g==10&&cr)return k=new K(h),Dt(k,Q+k.e+1,Y);if(C=String(h),b=typeof h=="number"){if(h*0!=0)return z(k,C,b,g);if(k.s=1/h<0?(C=C.slice(1),-1):1,K.DEBUG&&C.replace(/^0\.0*|\./,"").length>15)throw Error(a+h)}else k.s=C.charCodeAt(0)===45?(C=C.slice(1),-1):1;for(w=Vt.slice(0,g),T=O=0,E=C.length;O<E;O++)if(w.indexOf(A=C.charAt(O))<0){if(A=="."){if(O>T){T=E;continue}}else if(!S&&(C==C.toUpperCase()&&(C=C.toLowerCase())||C==C.toLowerCase()&&(C=C.toUpperCase()))){S=!0,O=-1,T=0;continue}return z(k,String(h),b,g)}b=!1,C=tt(C,g,10,k.s),(T=C.indexOf("."))>-1?C=C.replace(".",""):T=C.length}for(O=0;C.charCodeAt(O)===48;O++);for(E=C.length;C.charCodeAt(--E)===48;);if(C=C.slice(O,++E)){if(E-=O,b&&K.DEBUG&&E>15&&(h>l||h!==i(h)))throw Error(a+k.s*h);if((T=T-O-1)>mt)k.c=k.e=null;else if(T<bt)k.c=[k.e=0];else{if(k.e=T,k.c=[],O=(T+1)%c,T<0&&(O+=c),O<E){for(O&&k.c.push(+C.slice(0,O)),E-=c;O<E;)k.c.push(+C.slice(O,O+=c));O=c-(C=C.slice(O)).length}else O-=E;for(;O--;C+="0");k.c.push(+C)}}else k.c=[k.e=0]}K.clone=f,K.ROUND_UP=0,K.ROUND_DOWN=1,K.ROUND_CEIL=2,K.ROUND_FLOOR=3,K.ROUND_HALF_UP=4,K.ROUND_HALF_DOWN=5,K.ROUND_HALF_EVEN=6,K.ROUND_HALF_CEIL=7,K.ROUND_HALF_FLOOR=8,K.EUCLID=9,K.config=K.set=function(h){var g,w;if(h!=null)if(typeof h=="object"){if(h.hasOwnProperty(g="DECIMAL_PLACES")&&(w=h[g],$(w,0,I,g),Q=w),h.hasOwnProperty(g="ROUNDING_MODE")&&(w=h[g],$(w,0,8,g),Y=w),h.hasOwnProperty(g="EXPONENTIAL_AT")&&(w=h[g],w&&w.pop?($(w[0],-I,0,g),$(w[1],0,I,g),ut=w[0],dt=w[1]):($(w,-I,I,g),ut=-(dt=w<0?-w:w))),h.hasOwnProperty(g="RANGE"))if(w=h[g],w&&w.pop)$(w[0],-I,-1,g),$(w[1],1,I,g),bt=w[0],mt=w[1];else if($(w,-I,I,g),w)bt=-(mt=w<0?-w:w);else throw Error(o+g+" cannot be zero: "+w);if(h.hasOwnProperty(g="CRYPTO"))if(w=h[g],w===!!w)if(w)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))q=w;else throw q=!w,Error(o+"crypto unavailable");else q=w;else throw Error(o+g+" not true or false: "+w);if(h.hasOwnProperty(g="MODULO_MODE")&&(w=h[g],$(w,0,9,g),he=w),h.hasOwnProperty(g="POW_PRECISION")&&(w=h[g],$(w,0,I,g),de=w),h.hasOwnProperty(g="FORMAT"))if(w=h[g],typeof w=="object")hn=w;else throw Error(o+g+" not an object: "+w);if(h.hasOwnProperty(g="ALPHABET"))if(w=h[g],typeof w=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(w))cr=w.slice(0,10)=="0123456789",Vt=w;else throw Error(o+g+" invalid: "+w)}else throw Error(o+"Object expected: "+h);return{DECIMAL_PLACES:Q,ROUNDING_MODE:Y,EXPONENTIAL_AT:[ut,dt],RANGE:[bt,mt],CRYPTO:q,MODULO_MODE:he,POW_PRECISION:de,FORMAT:hn,ALPHABET:Vt}},K.isBigNumber=function(h){if(!h||h._isBigNumber!==!0)return!1;if(!K.DEBUG)return!0;var g,w,A=h.c,S=h.e,T=h.s;t:if({}.toString.call(A)=="[object Array]"){if((T===1||T===-1)&&S>=-I&&S<=I&&S===i(S)){if(A[0]===0){if(S===0&&A.length===1)return!0;break t}if(g=(S+1)%c,g<1&&(g+=c),String(A[0]).length==g){for(g=0;g<A.length;g++)if(w=A[g],w<0||w>=s||w!==i(w))break t;if(w!==0)return!0}}}else if(A===null&&S===null&&(T===null||T===1||T===-1))return!0;throw Error(o+"Invalid BigNumber: "+h)},K.maximum=K.max=function(){return Ai(arguments,x.lt)},K.minimum=K.min=function(){return Ai(arguments,x.gt)},K.random=function(){var h=9007199254740992,g=Math.random()*h&2097151?function(){return i(Math.random()*h)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(w){var A,S,T,O,b,E=0,C=[],k=new K(it);if(w==null?w=Q:$(w,0,I),O=r(w/c),q)if(crypto.getRandomValues){for(A=crypto.getRandomValues(new Uint32Array(O*=2));E<O;)b=A[E]*131072+(A[E+1]>>>11),b>=9e15?(S=crypto.getRandomValues(new Uint32Array(2)),A[E]=S[0],A[E+1]=S[1]):(C.push(b%1e14),E+=2);E=O/2}else if(crypto.randomBytes){for(A=crypto.randomBytes(O*=7);E<O;)b=(A[E]&31)*281474976710656+A[E+1]*1099511627776+A[E+2]*4294967296+A[E+3]*16777216+(A[E+4]<<16)+(A[E+5]<<8)+A[E+6],b>=9e15?crypto.randomBytes(7).copy(A,E):(C.push(b%1e14),E+=7);E=O/7}else throw q=!1,Error(o+"crypto unavailable");if(!q)for(;E<O;)b=g(),b<9e15&&(C[E++]=b%1e14);for(O=C[--E],w%=c,O&&w&&(b=p[c-w],C[E]=i(O/b)*b);C[E]===0;C.pop(),E--);if(E<0)C=[T=0];else{for(T=-1;C[0]===0;C.splice(0,1),T-=c);for(E=1,b=C[0];b>=10;b/=10,E++);E<c&&(T-=c-E)}return k.e=T,k.c=C,k}}(),K.sum=function(){for(var h=1,g=arguments,w=new K(g[0]);h<g.length;)w=w.plus(g[h++]);return w},tt=function(){var h="0123456789";function g(w,A,S,T){for(var O,b=[0],E,C=0,k=w.length;C<k;){for(E=b.length;E--;b[E]*=A);for(b[0]+=T.indexOf(w.charAt(C++)),O=0;O<b.length;O++)b[O]>S-1&&(b[O+1]==null&&(b[O+1]=0),b[O+1]+=b[O]/S|0,b[O]%=S)}return b.reverse()}return function(w,A,S,T,O){var b,E,C,k,D,u,d,_,F=w.indexOf("."),j=Q,X=Y;for(F>=0&&(k=de,de=0,w=w.replace(".",""),_=new K(A),u=_.pow(w.length-F),de=k,_.c=g(H(L(u.c),u.e,"0"),10,S,h),_.e=_.c.length),d=g(w,A,S,O?(b=Vt,h):(b=h,Vt)),C=k=d.length;d[--k]==0;d.pop());if(!d[0])return b.charAt(0);if(F<0?--C:(u.c=d,u.e=C,u.s=T,u=M(u,_,j,X,S),d=u.c,D=u.r,C=u.e),E=C+j+1,F=d[E],k=S/2,D=D||E<0||d[E+1]!=null,D=X<4?(F!=null||D)&&(X==0||X==(u.s<0?3:2)):F>k||F==k&&(X==4||D||X==6&&d[E-1]&1||X==(u.s<0?8:7)),E<1||!d[0])w=D?H(b.charAt(1),-j,b.charAt(0)):b.charAt(0);else{if(d.length=E,D)for(--S;++d[--E]>S;)d[E]=0,E||(++C,d=[1].concat(d));for(k=d.length;!d[--k];);for(F=0,w="";F<=k;w+=b.charAt(d[F++]));w=H(w,C,b.charAt(0))}return w}}(),M=function(){function h(A,S,T){var O,b,E,C,k=0,D=A.length,u=S%y,d=S/y|0;for(A=A.slice();D--;)E=A[D]%y,C=A[D]/y|0,O=d*E+C*u,b=u*E+O%y*y+k,k=(b/T|0)+(O/y|0)+d*C,A[D]=b%T;return k&&(A=[k].concat(A)),A}function g(A,S,T,O){var b,E;if(T!=O)E=T>O?1:-1;else for(b=E=0;b<T;b++)if(A[b]!=S[b]){E=A[b]>S[b]?1:-1;break}return E}function w(A,S,T,O){for(var b=0;T--;)A[T]-=b,b=A[T]<S[T]?1:0,A[T]=b*O+A[T]-S[T];for(;!A[0]&&A.length>1;A.splice(0,1));}return function(A,S,T,O,b){var E,C,k,D,u,d,_,F,j,X,Z,at,se,Ho,Qo,ge,pn,Yt=A.s==S.s?1:-1,Pt=A.c,vt=S.c;if(!Pt||!Pt[0]||!vt||!vt[0])return new K(!A.s||!S.s||(Pt?vt&&Pt[0]==vt[0]:!vt)?NaN:Pt&&Pt[0]==0||!vt?Yt*0:Yt/0);for(F=new K(Yt),j=F.c=[],C=A.e-S.e,Yt=T+C+1,b||(b=s,C=v(A.e/c)-v(S.e/c),Yt=Yt/c|0),k=0;vt[k]==(Pt[k]||0);k++);if(vt[k]>(Pt[k]||0)&&C--,Yt<0)j.push(1),D=!0;else{for(Ho=Pt.length,ge=vt.length,k=0,Yt+=2,u=i(b/(vt[0]+1)),u>1&&(vt=h(vt,u,b),Pt=h(Pt,u,b),ge=vt.length,Ho=Pt.length),se=ge,X=Pt.slice(0,ge),Z=X.length;Z<ge;X[Z++]=0);pn=vt.slice(),pn=[0].concat(pn),Qo=vt[0],vt[1]>=b/2&&Qo++;do{if(u=0,E=g(vt,X,ge,Z),E<0){if(at=X[0],ge!=Z&&(at=at*b+(X[1]||0)),u=i(at/Qo),u>1)for(u>=b&&(u=b-1),d=h(vt,u,b),_=d.length,Z=X.length;g(d,X,_,Z)==1;)u--,w(d,ge<_?pn:vt,_,b),_=d.length,E=1;else u==0&&(E=u=1),d=vt.slice(),_=d.length;if(_<Z&&(d=[0].concat(d)),w(X,d,Z,b),Z=X.length,E==-1)for(;g(vt,X,ge,Z)<1;)u++,w(X,ge<Z?pn:vt,Z,b),Z=X.length}else E===0&&(u++,X=[0]);j[k++]=u,X[0]?X[Z++]=Pt[se]||0:(X=[Pt[se]],Z=1)}while((se++<Ho||X[0]!=null)&&Yt--);D=X[0]!=null,j[0]||j.splice(0,1)}if(b==s){for(k=1,Yt=j[0];Yt>=10;Yt/=10,k++);Dt(F,T+(F.e=k+C*c-1)+1,O,D)}else F.e=C,F.r=+D;return F}}();function dn(h,g,w,A){var S,T,O,b,E;if(w==null?w=Y:$(w,0,8),!h.c)return h.toString();if(S=h.c[0],O=h.e,g==null)E=L(h.c),E=A==1||A==2&&(O<=ut||O>=dt)?G(E,O):H(E,O,"0");else if(h=Dt(new K(h),g,w),T=h.e,E=L(h.c),b=E.length,A==1||A==2&&(g<=T||T<=ut)){for(;b<g;E+="0",b++);E=G(E,T)}else if(g-=O,E=H(E,T,"0"),T+1>b){if(--g>0)for(E+=".";g--;E+="0");}else if(g+=T-b,g>0)for(T+1==b&&(E+=".");g--;E+="0");return h.s<0&&S?"-"+E:E}function Ai(h,g){for(var w,A=1,S=new K(h[0]);A<h.length;A++)if(w=new K(h[A]),w.s)g.call(S,w)&&(S=w);else{S=w;break}return S}function gn(h,g,w){for(var A=1,S=g.length;!g[--S];g.pop());for(S=g[0];S>=10;S/=10,A++);return(w=A+w*c-1)>mt?h.c=h.e=null:w<bt?h.c=[h.e=0]:(h.e=w,h.c=g),h}z=function(){var h=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,w=/^\.([^.]+)$/,A=/^-?(Infinity|NaN)$/,S=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(T,O,b,E){var C,k=b?O:O.replace(S,"");if(A.test(k))T.s=isNaN(k)?null:k<0?-1:1;else{if(!b&&(k=k.replace(h,function(D,u,d){return C=(d=d.toLowerCase())=="x"?16:d=="b"?2:8,!E||E==C?u:D}),E&&(C=E,k=k.replace(g,"$1").replace(w,"0.$1")),O!=k))return new K(k,C);if(K.DEBUG)throw Error(o+"Not a"+(E?" base "+E:"")+" number: "+O);T.s=null}T.c=T.e=null}}();function Dt(h,g,w,A){var S,T,O,b,E,C,k,D=h.c,u=p;if(D){t:{for(S=1,b=D[0];b>=10;b/=10,S++);if(T=g-S,T<0)T+=c,O=g,E=D[C=0],k=E/u[S-O-1]%10|0;else if(C=r((T+1)/c),C>=D.length)if(A){for(;D.length<=C;D.push(0));E=k=0,S=1,T%=c,O=T-c+1}else break t;else{for(E=b=D[C],S=1;b>=10;b/=10,S++);T%=c,O=T-c+S,k=O<0?0:E/u[S-O-1]%10|0}if(A=A||g<0||D[C+1]!=null||(O<0?E:E%u[S-O-1]),A=w<4?(k||A)&&(w==0||w==(h.s<0?3:2)):k>5||k==5&&(w==4||A||w==6&&(T>0?O>0?E/u[S-O]:0:D[C-1])%10&1||w==(h.s<0?8:7)),g<1||!D[0])return D.length=0,A?(g-=h.e+1,D[0]=u[(c-g%c)%c],h.e=-g||0):D[0]=h.e=0,h;if(T==0?(D.length=C,b=1,C--):(D.length=C+1,b=u[c-T],D[C]=O>0?i(E/u[S-O]%u[O])*b:0),A)for(;;)if(C==0){for(T=1,O=D[0];O>=10;O/=10,T++);for(O=D[0]+=b,b=1;O>=10;O/=10,b++);T!=b&&(h.e++,D[0]==s&&(D[0]=1));break}else{if(D[C]+=b,D[C]!=s)break;D[C--]=0,b=1}for(T=D.length;D[--T]===0;D.pop());}h.e>mt?h.c=h.e=null:h.e<bt&&(h.c=[h.e=0])}return h}function ae(h){var g,w=h.e;return w===null?h.toString():(g=L(h.c),g=w<=ut||w>=dt?G(g,w):H(g,w,"0"),h.s<0?"-"+g:g)}return x.absoluteValue=x.abs=function(){var h=new K(this);return h.s<0&&(h.s=1),h},x.comparedTo=function(h,g){return U(this,new K(h,g))},x.decimalPlaces=x.dp=function(h,g){var w,A,S,T=this;if(h!=null)return $(h,0,I),g==null?g=Y:$(g,0,8),Dt(new K(T),h+T.e+1,g);if(!(w=T.c))return null;if(A=((S=w.length-1)-v(this.e/c))*c,S=w[S])for(;S%10==0;S/=10,A--);return A<0&&(A=0),A},x.dividedBy=x.div=function(h,g){return M(this,new K(h,g),Q,Y)},x.dividedToIntegerBy=x.idiv=function(h,g){return M(this,new K(h,g),0,1)},x.exponentiatedBy=x.pow=function(h,g){var w,A,S,T,O,b,E,C,k,D=this;if(h=new K(h),h.c&&!h.isInteger())throw Error(o+"Exponent not an integer: "+ae(h));if(g!=null&&(g=new K(g)),b=h.e>14,!D.c||!D.c[0]||D.c[0]==1&&!D.e&&D.c.length==1||!h.c||!h.c[0])return k=new K(Math.pow(+ae(D),b?h.s*(2-V(h)):+ae(h))),g?k.mod(g):k;if(E=h.s<0,g){if(g.c?!g.c[0]:!g.s)return new K(NaN);A=!E&&D.isInteger()&&g.isInteger(),A&&(D=D.mod(g))}else{if(h.e>9&&(D.e>0||D.e<-1||(D.e==0?D.c[0]>1||b&&D.c[1]>=24e7:D.c[0]<8e13||b&&D.c[0]<=9999975e7)))return T=D.s<0&&V(h)?-0:0,D.e>-1&&(T=1/T),new K(E?1/T:T);de&&(T=r(de/c+2))}for(b?(w=new K(.5),E&&(h.s=1),C=V(h)):(S=Math.abs(+ae(h)),C=S%2),k=new K(it);;){if(C){if(k=k.times(D),!k.c)break;T?k.c.length>T&&(k.c.length=T):A&&(k=k.mod(g))}if(S){if(S=i(S/2),S===0)break;C=S%2}else if(h=h.times(w),Dt(h,h.e+1,1),h.e>14)C=V(h);else{if(S=+ae(h),S===0)break;C=S%2}D=D.times(D),T?D.c&&D.c.length>T&&(D.c.length=T):A&&(D=D.mod(g))}return A?k:(E&&(k=it.div(k)),g?k.mod(g):T?Dt(k,de,Y,O):k)},x.integerValue=function(h){var g=new K(this);return h==null?h=Y:$(h,0,8),Dt(g,g.e+1,h)},x.isEqualTo=x.eq=function(h,g){return U(this,new K(h,g))===0},x.isFinite=function(){return!!this.c},x.isGreaterThan=x.gt=function(h,g){return U(this,new K(h,g))>0},x.isGreaterThanOrEqualTo=x.gte=function(h,g){return(g=U(this,new K(h,g)))===1||g===0},x.isInteger=function(){return!!this.c&&v(this.e/c)>this.c.length-2},x.isLessThan=x.lt=function(h,g){return U(this,new K(h,g))<0},x.isLessThanOrEqualTo=x.lte=function(h,g){return(g=U(this,new K(h,g)))===-1||g===0},x.isNaN=function(){return!this.s},x.isNegative=function(){return this.s<0},x.isPositive=function(){return this.s>0},x.isZero=function(){return!!this.c&&this.c[0]==0},x.minus=function(h,g){var w,A,S,T,O=this,b=O.s;if(h=new K(h,g),g=h.s,!b||!g)return new K(NaN);if(b!=g)return h.s=-g,O.plus(h);var E=O.e/c,C=h.e/c,k=O.c,D=h.c;if(!E||!C){if(!k||!D)return k?(h.s=-g,h):new K(D?O:NaN);if(!k[0]||!D[0])return D[0]?(h.s=-g,h):new K(k[0]?O:Y==3?-0:0)}if(E=v(E),C=v(C),k=k.slice(),b=E-C){for((T=b<0)?(b=-b,S=k):(C=E,S=D),S.reverse(),g=b;g--;S.push(0));S.reverse()}else for(A=(T=(b=k.length)<(g=D.length))?b:g,b=g=0;g<A;g++)if(k[g]!=D[g]){T=k[g]<D[g];break}if(T&&(S=k,k=D,D=S,h.s=-h.s),g=(A=D.length)-(w=k.length),g>0)for(;g--;k[w++]=0);for(g=s-1;A>b;){if(k[--A]<D[A]){for(w=A;w&&!k[--w];k[w]=g);--k[w],k[A]+=s}k[A]-=D[A]}for(;k[0]==0;k.splice(0,1),--C);return k[0]?gn(h,k,C):(h.s=Y==3?-1:1,h.c=[h.e=0],h)},x.modulo=x.mod=function(h,g){var w,A,S=this;return h=new K(h,g),!S.c||!h.s||h.c&&!h.c[0]?new K(NaN):!h.c||S.c&&!S.c[0]?new K(S):(he==9?(A=h.s,h.s=1,w=M(S,h,0,3),h.s=A,w.s*=A):w=M(S,h,0,he),h=S.minus(w.times(h)),!h.c[0]&&he==1&&(h.s=S.s),h)},x.multipliedBy=x.times=function(h,g){var w,A,S,T,O,b,E,C,k,D,u,d,_,F,j,X=this,Z=X.c,at=(h=new K(h,g)).c;if(!Z||!at||!Z[0]||!at[0])return!X.s||!h.s||Z&&!Z[0]&&!at||at&&!at[0]&&!Z?h.c=h.e=h.s=null:(h.s*=X.s,!Z||!at?h.c=h.e=null:(h.c=[0],h.e=0)),h;for(A=v(X.e/c)+v(h.e/c),h.s*=X.s,E=Z.length,D=at.length,E<D&&(_=Z,Z=at,at=_,S=E,E=D,D=S),S=E+D,_=[];S--;_.push(0));for(F=s,j=y,S=D;--S>=0;){for(w=0,u=at[S]%j,d=at[S]/j|0,O=E,T=S+O;T>S;)C=Z[--O]%j,k=Z[O]/j|0,b=d*C+k*u,C=u*C+b%j*j+_[T]+w,w=(C/F|0)+(b/j|0)+d*k,_[T--]=C%F;_[T]=w}return w?++A:_.splice(0,1),gn(h,_,A)},x.negated=function(){var h=new K(this);return h.s=-h.s||null,h},x.plus=function(h,g){var w,A=this,S=A.s;if(h=new K(h,g),g=h.s,!S||!g)return new K(NaN);if(S!=g)return h.s=-g,A.minus(h);var T=A.e/c,O=h.e/c,b=A.c,E=h.c;if(!T||!O){if(!b||!E)return new K(S/0);if(!b[0]||!E[0])return E[0]?h:new K(b[0]?A:S*0)}if(T=v(T),O=v(O),b=b.slice(),S=T-O){for(S>0?(O=T,w=E):(S=-S,w=b),w.reverse();S--;w.push(0));w.reverse()}for(S=b.length,g=E.length,S-g<0&&(w=E,E=b,b=w,g=S),S=0;g;)S=(b[--g]=b[g]+E[g]+S)/s|0,b[g]=s===b[g]?0:b[g]%s;return S&&(b=[S].concat(b),++O),gn(h,b,O)},x.precision=x.sd=function(h,g){var w,A,S,T=this;if(h!=null&&h!==!!h)return $(h,1,I),g==null?g=Y:$(g,0,8),Dt(new K(T),h,g);if(!(w=T.c))return null;if(S=w.length-1,A=S*c+1,S=w[S]){for(;S%10==0;S/=10,A--);for(S=w[0];S>=10;S/=10,A++);}return h&&T.e+1>A&&(A=T.e+1),A},x.shiftedBy=function(h){return $(h,-l,l),this.times("1e"+h)},x.squareRoot=x.sqrt=function(){var h,g,w,A,S,T=this,O=T.c,b=T.s,E=T.e,C=Q+4,k=new K("0.5");if(b!==1||!O||!O[0])return new K(!b||b<0&&(!O||O[0])?NaN:O?T:1/0);if(b=Math.sqrt(+ae(T)),b==0||b==1/0?(g=L(O),(g.length+E)%2==0&&(g+="0"),b=Math.sqrt(+g),E=v((E+1)/2)-(E<0||E%2),b==1/0?g="5e"+E:(g=b.toExponential(),g=g.slice(0,g.indexOf("e")+1)+E),w=new K(g)):w=new K(b+""),w.c[0]){for(E=w.e,b=E+C,b<3&&(b=0);;)if(S=w,w=k.times(S.plus(M(T,S,C,1))),L(S.c).slice(0,b)===(g=L(w.c)).slice(0,b))if(w.e<E&&--b,g=g.slice(b-3,b+1),g=="9999"||!A&&g=="4999"){if(!A&&(Dt(S,S.e+Q+2,0),S.times(S).eq(T))){w=S;break}C+=4,b+=4,A=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(Dt(w,w.e+Q+2,1),h=!w.times(w).eq(T));break}}return Dt(w,w.e+Q+1,Y,h)},x.toExponential=function(h,g){return h!=null&&($(h,0,I),h++),dn(this,h,g,1)},x.toFixed=function(h,g){return h!=null&&($(h,0,I),h=h+this.e+1),dn(this,h,g)},x.toFormat=function(h,g,w){var A,S=this;if(w==null)h!=null&&g&&typeof g=="object"?(w=g,g=null):h&&typeof h=="object"?(w=h,h=g=null):w=hn;else if(typeof w!="object")throw Error(o+"Argument not an object: "+w);if(A=S.toFixed(h,g),S.c){var T,O=A.split("."),b=+w.groupSize,E=+w.secondaryGroupSize,C=w.groupSeparator||"",k=O[0],D=O[1],u=S.s<0,d=u?k.slice(1):k,_=d.length;if(E&&(T=b,b=E,E=T,_-=T),b>0&&_>0){for(T=_%b||b,k=d.substr(0,T);T<_;T+=b)k+=C+d.substr(T,b);E>0&&(k+=C+d.slice(T)),u&&(k="-"+k)}A=D?k+(w.decimalSeparator||"")+((E=+w.fractionGroupSize)?D.replace(new RegExp("\\d{"+E+"}\\B","g"),"$&"+(w.fractionGroupSeparator||"")):D):k}return(w.prefix||"")+A+(w.suffix||"")},x.toFraction=function(h){var g,w,A,S,T,O,b,E,C,k,D,u,d=this,_=d.c;if(h!=null&&(b=new K(h),!b.isInteger()&&(b.c||b.s!==1)||b.lt(it)))throw Error(o+"Argument "+(b.isInteger()?"out of range: ":"not an integer: ")+ae(b));if(!_)return new K(d);for(g=new K(it),C=w=new K(it),A=E=new K(it),u=L(_),T=g.e=u.length-d.e-1,g.c[0]=p[(O=T%c)<0?c+O:O],h=!h||b.comparedTo(g)>0?T>0?g:C:b,O=mt,mt=1/0,b=new K(u),E.c[0]=0;k=M(b,g,0,1),S=w.plus(k.times(A)),S.comparedTo(h)!=1;)w=A,A=S,C=E.plus(k.times(S=C)),E=S,g=b.minus(k.times(S=g)),b=S;return S=M(h.minus(w),A,0,1),E=E.plus(S.times(C)),w=w.plus(S.times(A)),E.s=C.s=d.s,T=T*2,D=M(C,A,T,Y).minus(d).abs().comparedTo(M(E,w,T,Y).minus(d).abs())<1?[C,A]:[E,w],mt=O,D},x.toNumber=function(){return+ae(this)},x.toPrecision=function(h,g){return h!=null&&$(h,1,I),dn(this,h,g,2)},x.toString=function(h){var g,w=this,A=w.s,S=w.e;return S===null?A?(g="Infinity",A<0&&(g="-"+g)):g="NaN":(h==null?g=S<=ut||S>=dt?G(L(w.c),S):H(L(w.c),S,"0"):h===10&&cr?(w=Dt(new K(w),Q+S+1,Y),g=H(L(w.c),w.e,"0")):($(h,2,Vt.length,"Base"),g=tt(H(L(w.c),S,"0"),10,h,A,!0)),A<0&&w.c[0]&&(g="-"+g)),g},x.valueOf=x.toJSON=function(){return ae(this)},x._isBigNumber=!0,R!=null&&K.set(R),K}function v(R){var M=R|0;return R>0||R===M?M:M-1}function L(R){for(var M,tt,z=1,x=R.length,it=R[0]+"";z<x;){for(M=R[z++]+"",tt=c-M.length;tt--;M="0"+M);it+=M}for(x=it.length;it.charCodeAt(--x)===48;);return it.slice(0,x+1||1)}function U(R,M){var tt,z,x=R.c,it=M.c,Q=R.s,Y=M.s,ut=R.e,dt=M.e;if(!Q||!Y)return null;if(tt=x&&!x[0],z=it&&!it[0],tt||z)return tt?z?0:-Y:Q;if(Q!=Y)return Q;if(tt=Q<0,z=ut==dt,!x||!it)return z?0:!x^tt?1:-1;if(!z)return ut>dt^tt?1:-1;for(Y=(ut=x.length)<(dt=it.length)?ut:dt,Q=0;Q<Y;Q++)if(x[Q]!=it[Q])return x[Q]>it[Q]^tt?1:-1;return ut==dt?0:ut>dt^tt?1:-1}function $(R,M,tt,z){if(R<M||R>tt||R!==i(R))throw Error(o+(z||"Argument")+(typeof R=="number"?R<M||R>tt?" out of range: ":" not an integer: ":" not a primitive number: ")+String(R))}function V(R){var M=R.c.length-1;return v(R.e/c)==M&&R.c[M]%2!=0}function G(R,M){return(R.length>1?R.charAt(0)+"."+R.slice(1):R)+(M<0?"e":"e+")+M}function H(R,M,tt){var z,x;if(M<0){for(x=tt+".";++M;x+=tt);R=x+R}else if(z=R.length,++M>z){for(x=tt,M-=z;--M;x+=tt);R+=x}else M<z&&(R=R.slice(0,M)+"."+R.slice(M));return R}t=f(),t.default=t.BigNumber=t,typeof define=="function"&&define.amd?define(function(){return t}):typeof vo<"u"&&vo.exports?vo.exports=t:(n||(n=typeof self<"u"&&self?self:window),n.BigNumber=t)})(Sl)});var El=J(fs=>{"use strict";m();Object.defineProperty(fs,"__esModule",{value:!0});var Og=us(),ls=class{BigNum;constructor(){this.BigNum=(t,e)=>{let r=Og.BigNumber.clone({DECIMAL_PLACES:e});return new r(t)}}winstonToAr(t,{formatted:e=!1,decimals:r=12,trim:i=!0}={}){let o=this.stringToBigNum(t,r).shiftedBy(-12);return e?o.toFormat(r):o.toFixed(r)}arToWinston(t,{formatted:e=!1}={}){let r=this.stringToBigNum(t).shiftedBy(12);return e?r.toFormat():r.toFixed(0)}compare(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.comparedTo(i)}isEqual(t,e){return this.compare(t,e)===0}isLessThan(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.isLessThan(i)}isGreaterThan(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.isGreaterThan(i)}add(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.plus(e).toFixed(0)}sub(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.minus(e).toFixed(0)}stringToBigNum(t,e=12){return this.BigNum(t,e)}};fs.default=ls});var Tl=J(ds=>{"use strict";m();Object.defineProperty(ds,"__esModule",{value:!0});var hs=class{METHOD_GET="GET";METHOD_POST="POST";config;constructor(t){this.applyConfig(t)}applyConfig(t){this.config=this.mergeDefaults(t)}getConfig(){return this.config}mergeDefaults(t){let e=t.protocol||"http",r=t.port||(e==="https"?443:80);return{host:t.host||"127.0.0.1",protocol:e,port:r,timeout:t.timeout||2e4,logging:t.logging||!1,logger:t.logger||console.log,network:t.network}}async get(t,e){return await this.request(t,{...e,method:this.METHOD_GET})}async post(t,e,r){let i=new Headers(r?.headers||{});return i.get("content-type")?.includes("application/json")||i.append("content-type","application/json"),i.append("accept","application/json, text/plain, */*"),await this.request(t,{...r,method:this.METHOD_POST,body:typeof e!="string"?JSON.stringify(e):e,headers:i})}async request(t,e){let r=new Headers(e?.headers||{}),i=`${this.config.protocol}://${this.config.host}:${this.config.port}`,o=e?.responseType;delete e?.responseType,t.startsWith("/")&&(t=t.slice(1)),this.config.network&&r.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${i}/${t}`);let a=await fetch(`${i}/${t}`,{...e||{},headers:r});this.config.logging&&this.config.logger(`Response:   ${a.url} - ${a.status}`);let c=a.headers.get("content-type")?.match(/charset=([^()<>@,;:\"/[\]?.=\s]*)/i)?.[1],l=a,p=async()=>{if(c)try{l.data=new TextDecoder(c).decode(await a.arrayBuffer())}catch{l.data=await a.text()}else l.data=await a.text()};if(o==="arraybuffer")l.data=await a.arrayBuffer();else if(o==="text")await p();else if(o==="webstream")l.data=Rg(a.body);else try{let y=await a.clone().json();typeof y!="object"?await p():l.data=await a.json(),y=null}catch{await p()}return l}};ds.default=hs;var Rg=n=>{let t=n;return typeof t[Symbol.asyncIterator]>"u"?(t[Symbol.asyncIterator]=Bg(n),t):n},Bg=function(n){return async function*(){let e=n.getReader();try{for(;;){let{done:r,value:i}=await e.read();if(r)return;yield i}}finally{e.releaseLock()}}}});var fe=J(_t=>{"use strict";m();Object.defineProperty(_t,"__esModule",{value:!0});_t.b64UrlDecode=_t.b64UrlEncode=_t.bufferTob64Url=_t.bufferTob64=_t.b64UrlToBuffer=_t.stringToB64Url=_t.stringToBuffer=_t.bufferToString=_t.b64UrlToString=_t.concatBuffers=void 0;var xl=Jo();function Pg(n){let t=0;for(let i=0;i<n.length;i++)t+=n[i].byteLength;let e=new Uint8Array(t),r=0;e.set(new Uint8Array(n[0]),r),r+=n[0].byteLength;for(let i=1;i<n.length;i++)e.set(new Uint8Array(n[i]),r),r+=n[i].byteLength;return e}_t.concatBuffers=Pg;function Ng(n){let t=kl(n);return Cl(t)}_t.b64UrlToString=Ng;function Cl(n){return new TextDecoder("utf-8",{fatal:!0}).decode(n)}_t.bufferToString=Cl;function Il(n){return new TextEncoder().encode(n)}_t.stringToBuffer=Il;function Wg(n){return Ll(Il(n))}_t.stringToB64Url=Wg;function kl(n){return new Uint8Array(xl.toByteArray(Rl(n)))}_t.b64UrlToBuffer=kl;function Al(n){return xl.fromByteArray(new Uint8Array(n))}_t.bufferTob64=Al;function Ll(n){return Ol(Al(n))}_t.bufferTob64Url=Ll;function Ol(n){return n.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}_t.b64UrlEncode=Ol;function Rl(n){n=n.replace(/\-/g,"+").replace(/\_/g,"/");let t;return n.length%4==0?t=0:t=4-n.length%4,n.concat("=".repeat(t))}_t.b64UrlDecode=Rl});var Bl=J(ps=>{"use strict";m();Object.defineProperty(ps,"__esModule",{value:!0});var ir=fe(),gs=class{keyLength=4096;publicExponent=65537;hashAlgorithm="sha256";driver;constructor(){if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:r}={}){let i=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(i)}async hash(t,e="SHA-256"){let r=await this.driver.digest(e,t);return new Uint8Array(r)}async verify(t,e,r){let i={kty:"RSA",e:"AQAB",n:t},o=await this.jwkToPublicCryptoKey(i),a=await this.driver.digest("SHA-256",e),s=await this.driver.verify({name:"RSA-PSS",saltLength:0},o,r,e),c=await this.driver.verify({name:"RSA-PSS",saltLength:32},o,r,e),l=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((o.algorithm.modulusLength-1)/8)-a.byteLength-2},o,r,e);return s||c||l}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let t=crypto?.subtle;return t===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(r=>typeof t[r]=="function")}async encrypt(t,e,r){let i=await this.driver.importKey("raw",typeof e=="string"?ir.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),o=await this.driver.deriveKey({name:"PBKDF2",salt:r?ir.stringToBuffer(r):ir.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),a=new Uint8Array(16);crypto.getRandomValues(a);let s=await this.driver.encrypt({name:"AES-CBC",iv:a},o,t);return ir.concatBuffers([a,s])}async decrypt(t,e,r){let i=await this.driver.importKey("raw",typeof e=="string"?ir.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),o=await this.driver.deriveKey({name:"PBKDF2",salt:r?ir.stringToBuffer(r):ir.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),a=t.slice(0,16),s=await this.driver.decrypt({name:"AES-CBC",iv:a},o,t.slice(16));return ir.concatBuffers([s])}};ps.default=gs});var Pl=J(ys=>{"use strict";m();Object.defineProperty(ys,"__esModule",{value:!0});var ms=class{api;constructor(t){this.api=t}getInfo(){return this.api.get("info").then(t=>t.data)}getPeers(){return this.api.get("peers").then(t=>t.data)}};ys.default=ms});var Qn=J(Hn=>{"use strict";m();Object.defineProperty(Hn,"__esModule",{value:!0});Hn.getError=void 0;var ws=class extends Error{type;response;constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.response=e.response}getType(){return this.type}};Hn.default=ws;function Ug(n){let t=n.data;if(typeof n.data=="string")try{t=JSON.parse(n.data)}catch{}if(n.data instanceof ArrayBuffer||n.data instanceof Uint8Array)try{t=JSON.parse(t.toString())}catch{}return t?t.error||t:n.statusText||"unknown"}Hn.getError=Ug});var Ul=J(vs=>{"use strict";m();Object.defineProperty(vs,"__esModule",{value:!0});var Jt=zn();async function Nl(n){if(Array.isArray(n)){let r=Jt.default.utils.concatBuffers([Jt.default.utils.stringToBuffer("list"),Jt.default.utils.stringToBuffer(n.length.toString())]);return await Wl(n,await Jt.default.crypto.hash(r,"SHA-384"))}let t=Jt.default.utils.concatBuffers([Jt.default.utils.stringToBuffer("blob"),Jt.default.utils.stringToBuffer(n.byteLength.toString())]),e=Jt.default.utils.concatBuffers([await Jt.default.crypto.hash(t,"SHA-384"),await Jt.default.crypto.hash(n,"SHA-384")]);return await Jt.default.crypto.hash(e,"SHA-384")}vs.default=Nl;async function Wl(n,t){if(n.length<1)return t;let e=Jt.default.utils.concatBuffers([t,await Nl(n[0])]),r=await Jt.default.crypto.hash(e,"SHA-384");return await Wl(n.slice(1),r)}});var xs=J(st=>{"use strict";m();Object.defineProperty(st,"__esModule",{value:!0});st.debug=st.validatePath=st.arrayCompare=st.bufferToInt=st.intToBuffer=st.arrayFlatten=st.generateProofs=st.buildLayers=st.generateTransactionChunks=st.generateTree=st.computeRootHash=st.generateLeaves=st.chunkData=st.MIN_CHUNK_SIZE=st.MAX_CHUNK_SIZE=void 0;var _o=zn(),Fl=fe();st.MAX_CHUNK_SIZE=256*1024;st.MIN_CHUNK_SIZE=32*1024;var Yn=32,Yr=32;async function bs(n){let t=[],e=n,r=0;for(;e.byteLength>=st.MAX_CHUNK_SIZE;){let i=st.MAX_CHUNK_SIZE,o=e.byteLength-st.MAX_CHUNK_SIZE;o>0&&o<st.MIN_CHUNK_SIZE&&(i=Math.ceil(e.byteLength/2));let a=e.slice(0,i),s=await _o.default.crypto.hash(a);r+=a.byteLength,t.push({dataHash:s,minByteRange:r-a.byteLength,maxByteRange:r}),e=e.slice(i)}return t.push({dataHash:await _o.default.crypto.hash(e),minByteRange:r,maxByteRange:r+e.byteLength}),t}st.chunkData=bs;async function Ss(n){return Promise.all(n.map(async({dataHash:t,minByteRange:e,maxByteRange:r})=>({type:"leaf",id:await It(await Promise.all([It(t),It(Xn(r))])),dataHash:t,minByteRange:e,maxByteRange:r})))}st.generateLeaves=Ss;async function Fg(n){return(await Dl(n)).id}st.computeRootHash=Fg;async function Dl(n){return await bo(await Ss(await bs(n)))}st.generateTree=Dl;async function Dg(n){let t=await bs(n),e=await Ss(t),r=await bo(e),i=await Ml(r),o=t.slice(-1)[0];return o.maxByteRange-o.minByteRange===0&&(t.splice(t.length-1,1),i.splice(i.length-1,1)),{data_root:r.id,chunks:t,proofs:i}}st.generateTransactionChunks=Dg;async function bo(n,t=0){if(n.length<2)return n[0];let e=[];for(let r=0;r<n.length;r+=2)e.push(await Mg(n[r],n[r+1]));return bo(e,t+1)}st.buildLayers=bo;function Ml(n){let t=_s(n);return Array.isArray(t)?Es(t):[t]}st.generateProofs=Ml;function _s(n,t=new Uint8Array,e=0){if(n.type=="leaf")return{offset:n.maxByteRange-1,proof:(0,Fl.concatBuffers)([t,n.dataHash,Xn(n.maxByteRange)])};if(n.type=="branch"){let r=(0,Fl.concatBuffers)([t,n.leftChild.id,n.rightChild.id,Xn(n.byteRange)]);return[_s(n.leftChild,r,e+1),_s(n.rightChild,r,e+1)]}throw new Error("Unexpected node type")}function Es(n){let t=[];return n.forEach(e=>{Array.isArray(e)?t.push(...Es(e)):t.push(e)}),t}st.arrayFlatten=Es;async function Mg(n,t){return t?{type:"branch",id:await It([await It(n.id),await It(t.id),await It(Xn(n.maxByteRange))]),byteRange:n.maxByteRange,maxByteRange:t.maxByteRange,leftChild:n,rightChild:t}:n}async function It(n){return Array.isArray(n)&&(n=_o.default.utils.concatBuffers(n)),new Uint8Array(await _o.default.crypto.hash(n))}function Xn(n){let t=new Uint8Array(Yn);for(var e=t.length-1;e>=0;e--){var r=n%256;t[e]=r,n=(n-r)/256}return t}st.intToBuffer=Xn;function Ts(n){let t=0;for(var e=0;e<n.length;e++)t*=256,t+=n[e];return t}st.bufferToInt=Ts;var $g=(n,t)=>n.every((e,r)=>t[r]===e);st.arrayCompare=$g;async function Jn(n,t,e,r,i){if(r<=0)return!1;if(t>=r)return Jn(n,0,r-1,r,i);if(t<0)return Jn(n,0,0,r,i);if(i.length==Yr+Yn){let y=i.slice(0,Yr),I=i.slice(y.length,y.length+Yn),f=await It([await It(y),await It(I)]);return(0,st.arrayCompare)(n,f)?{offset:r-1,leftBound:e,rightBound:r,chunkSize:r-e}:!1}let o=i.slice(0,Yr),a=i.slice(o.length,o.length+Yr),s=i.slice(o.length+a.length,o.length+a.length+Yn),c=Ts(s),l=i.slice(o.length+a.length+s.length),p=await It([await It(o),await It(a),await It(s)]);return(0,st.arrayCompare)(n,p)?t<c?await Jn(o,t,e,Math.min(r,c),l):await Jn(a,t,Math.max(e,c),r,l):!1}st.validatePath=Jn;async function $l(n,t=""){if(n.byteLength<1)return t;let e=n.slice(0,Yr),r=n.slice(e.length,e.length+Yr),i=n.slice(e.length+r.length,e.length+r.length+Yn),o=Ts(i),a=n.slice(e.length+r.length+i.length),s=await It([await It(e),await It(r),await It(i)]),c=`${t}
${JSON.stringify(W.Buffer.from(e))},${JSON.stringify(W.Buffer.from(r))},${o} => ${JSON.stringify(s)}`;return $l(a,c)}st.debug=$l});var Eo=J(ti=>{"use strict";m();Object.defineProperty(ti,"__esModule",{value:!0});ti.Tag=void 0;var Tt=fe(),Kg=Ul(),Vg=xs(),So=class{get(t,e){if(!Object.getOwnPropertyNames(this).includes(t))throw new Error(`Field "${t}" is not a property of the Arweave Transaction class.`);if(this[t]instanceof Uint8Array)return e&&e.decode&&e.string?Tt.bufferToString(this[t]):e&&e.decode&&!e.string?this[t]:Tt.bufferTob64Url(this[t]);if(this[t]instanceof Array){if(e?.decode!==void 0||e?.string!==void 0)throw t==="tags"&&console.warn(`Did you mean to use 'transaction["tags"]' ?`),new Error("Cannot decode or stringify an array.");return this[t]}return e&&e.decode==!0?e&&e.string?Tt.b64UrlToString(this[t]):Tt.b64UrlToBuffer(this[t]):this[t]}},Zn=class extends So{name;value;constructor(t,e,r=!1){super(),this.name=t,this.value=e}};ti.Tag=Zn;var Cs=class extends So{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(t={}){super(),Object.assign(this,t),typeof this.data=="string"&&(this.data=Tt.b64UrlToBuffer(this.data)),t.tags&&(this.tags=t.tags.map(e=>new Zn(e.name,e.value)))}addTag(t,e){this.tags.push(new Zn(Tt.stringToB64Url(t),Tt.stringToB64Url(e)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:Tt.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(t){this.owner=t}setSignature({id:t,owner:e,reward:r,tags:i,signature:o}){this.id=t,this.owner=e,r&&(this.reward=r),i&&(this.tags=i),this.signature=o}async prepareChunks(t){!this.chunks&&t.byteLength>0&&(this.chunks=await(0,Vg.generateTransactionChunks)(t),this.data_root=Tt.bufferTob64Url(this.chunks.data_root)),!this.chunks&&t.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(t,e){if(!this.chunks)throw new Error("Chunks have not been prepared");let r=this.chunks.proofs[t],i=this.chunks.chunks[t];return{data_root:this.data_root,data_size:this.data_size,data_path:Tt.bufferTob64Url(r.proof),offset:r.offset.toString(),chunk:Tt.bufferTob64Url(e.slice(i.minByteRange,i.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let t=this.tags.reduce((r,i)=>Tt.concatBuffers([r,i.get("name",{decode:!0,string:!1}),i.get("value",{decode:!0,string:!1})]),new Uint8Array);return Tt.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),Tt.stringToBuffer(this.quantity),Tt.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),t]);case 2:this.data_root||await this.prepareChunks(this.data);let e=this.tags.map(r=>[r.get("name",{decode:!0,string:!1}),r.get("value",{decode:!0,string:!1})]);return await(0,Kg.default)([Tt.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),Tt.stringToBuffer(this.quantity),Tt.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),e,Tt.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}};ti.default=Cs});var ql=J(To=>{"use strict";m();Object.defineProperty(To,"__esModule",{value:!0});To.TransactionUploader=void 0;var Kl=Eo(),Gg=fe(),Is=Qn(),qg=xs(),Vl=1,jg=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],Gl=1e3*40,ei=class{api;chunkIndex=0;txPosted=!1;transaction;lastRequestTimeEnd=0;totalErrors=0;data;lastResponseStatus=0;lastResponseError="";get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}constructor(t,e){if(this.api=t,!e.id)throw new Error("Transaction is not signed");if(!e.chunks)throw new Error("Transaction chunks not prepared");this.data=e.data,this.transaction=new Kl.default(Object.assign({},e,{data:new Uint8Array(0)}))}async uploadChunk(t){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let e=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+Gl-Date.now(),Gl);if(e>0&&(e=e-e*Math.random()*.3,await new Promise(a=>setTimeout(a,e))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}t&&(this.chunkIndex=t);let r=this.transaction.getChunk(t||this.chunkIndex,this.data);if(!await(0,qg.validatePath)(this.transaction.chunks.data_root,parseInt(r.offset),0,parseInt(r.data_size),Gg.b64UrlToBuffer(r.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);let o=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(a=>(console.error(a.message),{status:-1,data:{error:a.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=o.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,Is.getError)(o),jg.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(t,e,r){if(!e||typeof e.chunkIndex!="number"||typeof e.transaction!="object")throw new Error("Serialized object does not match expected format.");var i=new Kl.default(e.transaction);i.chunks||await i.prepareChunks(r);let o=new ei(t,i);if(o.chunkIndex=e.chunkIndex,o.lastRequestTimeEnd=e.lastRequestTimeEnd,o.lastResponseError=e.lastResponseError,o.lastResponseStatus=e.lastResponseStatus,o.txPosted=e.txPosted,o.data=r,o.transaction.data_root!==e.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return o}static async fromTransactionId(t,e){let r=await t.get(`tx/${e}`);if(r.status!==200)throw new Error(`Tx ${e} not found: ${r.status}`);let i=r.data;return i.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:i}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=Vl){this.transaction.data=this.data;let r=await this.api.post("tx",this.transaction).catch(i=>(console.error(i),{status:-1,data:{error:i.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=r.status,this.transaction.data=new Uint8Array(0),r.status>=200&&r.status<300){this.txPosted=!0,this.chunkIndex=Vl;return}throw this.lastResponseError=(0,Is.getError)(r),new Error(`Unable to upload transaction: ${r.status}, ${this.lastResponseError}`)}let e=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=e.status,!(e.status>=200&&e.status<300))throw this.lastResponseError=(0,Is.getError)(e),new Error(`Unable to upload transaction: ${e.status}, ${this.lastResponseError}`);this.txPosted=!0}};To.TransactionUploader=ei});var xo=J(($w,jl)=>{m();jl.exports={}});var Hl=J(Os=>{"use strict";m();Object.defineProperty(Os,"__esModule",{value:!0});var ks=Qn(),De=Eo(),ri=fe(),As=ql();xo();var Ls=class{api;crypto;chunks;constructor(t,e,r){this.api=t,this.crypto=e,this.chunks=r}async getTransactionAnchor(){let t=await this.api.get("tx_anchor");if(!t.data.match(/^[a-z0-9_-]{43,}/i)||!t.ok)throw new Error(`Could not getTransactionAnchor. Received: ${t.data}. Status: ${t.status}, ${t.statusText}`);return t.data}async getPrice(t,e){let r=e?`price/${t}/${e}`:`price/${t}`,i=await this.api.get(r);if(!/^\d+$/.test(i.data)||!i.ok)throw new Error(`Could not getPrice. Received: ${i.data}. Status: ${i.status}, ${i.statusText}`);return i.data}async get(t){let e=await this.api.get(`tx/${t}`);if(e.status==200){let r=parseInt(e.data.data_size);if(e.data.format>=2&&r>0&&r<=1024*1024*12){let i=await this.getData(t);return new De.default({...e.data,data:i})}return new De.default({...e.data,format:e.data.format||1})}throw e.status==404?new ks.default("TX_NOT_FOUND"):e.status==410?new ks.default("TX_FAILED"):new ks.default("TX_INVALID")}fromRaw(t){return new De.default(t)}async search(t,e){return this.api.post("arql",{op:"equals",expr1:t,expr2:e}).then(r=>r.data?r.data:[])}getStatus(t){return this.api.get(`tx/${t}/status`).then(e=>e.status==200?{status:200,confirmed:e.data}:{status:e.status,confirmed:null})}async getData(t,e){let r;try{r=await this.chunks.downloadChunkedData(t)}catch(i){console.error(`Error while trying to download chunked data for ${t}`),console.error(i)}if(!r){console.warn(`Falling back to gateway cache for ${t}`);try{let{data:i,ok:o,status:a,statusText:s}=await this.api.get(`/${t}`,{responseType:"arraybuffer"});if(!o)throw new Error("Bad http status code",{cause:{status:a,statusText:s}});r=i}catch(i){console.error(`Error while trying to download contiguous data from gateway cache for ${t}`),console.error(i)}}if(!r)throw new Error(`${t} data was not found!`);return e&&e.decode&&!e.string?r:e&&e.decode&&e.string?ri.bufferToString(r):ri.bufferTob64Url(r)}async sign(t,e,r){let o=typeof e=="object"&&(s=>{let c=!0;return["n","e","d","p","q","dp","dq","qi"].map(l=>!(l in s)&&(c=!1)),c})(e),a=typeof arweaveWallet=="object";if(!o&&!a)throw new Error("No valid JWK or external wallet found to sign transaction.");if(a){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}let s=await arweaveWallet.sign(t,r);t.setSignature({id:s.id,owner:s.owner,reward:s.reward,tags:s.tags,signature:s.signature})}else if(o){t.setOwner(e.n);let s=await t.getSignatureData(),c=await this.crypto.sign(e,s,r),l=await this.crypto.hash(c);t.setSignature({id:ri.bufferTob64Url(l),owner:e.n,signature:ri.bufferTob64Url(c)})}else throw new Error("An error occurred while signing. Check wallet is valid")}async verify(t){let e=await t.getSignatureData(),r=t.get("signature",{decode:!0,string:!1}),i=ri.bufferTob64Url(await this.crypto.hash(r));if(t.id!==i)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(t.owner,e,r)}async post(t){if(typeof t=="string"?t=new De.default(JSON.parse(t)):typeof t.readInt32BE=="function"?t=new De.default(JSON.parse(t.toString())):typeof t=="object"&&!(t instanceof De.default)&&(t=new De.default(t)),!(t instanceof De.default))throw new Error("Must be Transaction object");t.chunks||await t.prepareChunks(t.data);let e=await this.getUploader(t,t.data);try{for(;!e.isComplete;)await e.uploadChunk()}catch(r){if(e.lastResponseStatus>0)return{status:e.lastResponseStatus,statusText:e.lastResponseError,data:{error:e.lastResponseError}};throw r}return{status:200,statusText:"OK",data:{}}}async getUploader(t,e){let r;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t instanceof De.default){if(e||(e=t.data),!(e instanceof Uint8Array))throw new Error("Data format is invalid");t.chunks||await t.prepareChunks(e),r=new As.TransactionUploader(this.api,t),(!r.data||r.data.length===0)&&(r.data=e)}else{if(typeof t=="string"&&(t=await As.TransactionUploader.fromTransactionId(this.api,t)),!e||!(e instanceof Uint8Array))throw new Error("Must provide data when resuming upload");r=await As.TransactionUploader.fromSerialized(this.api,t,e)}return r}async*upload(t,e){let r=await this.getUploader(t,e);for(;!r.isComplete;)await r.uploadChunk(),yield r;return r}};Os.default=Ls});var zl=J(Bs=>{"use strict";m();Object.defineProperty(Bs,"__esModule",{value:!0});var Ql=fe();xo();var Rs=class{api;crypto;constructor(t,e){this.api=t,this.crypto=e}getBalance(t){return this.api.get(`wallet/${t}/balance`).then(e=>e.data)}getLastTransactionID(t){return this.api.get(`wallet/${t}/last_tx`).then(e=>e.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(t){return!t||t==="use_wallet"?this.getAddress():this.getAddress(t)}async getAddress(t){if(!t||t==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(t.n)}async ownerToAddress(t){return Ql.bufferTob64Url(await this.crypto.hash(Ql.b64UrlToBuffer(t)))}};Bs.default=Rs});var Yl=J(ni=>{"use strict";m();Object.defineProperty(ni,"__esModule",{value:!0});ni.SiloResource=void 0;var Jl=fe(),Ps=class{api;crypto;transactions;constructor(t,e,r){this.api=t,this.crypto=e,this.transactions=r}async get(t){if(!t)throw new Error("No Silo URI specified");let e=await this.parseUri(t),r=await this.transactions.search("Silo-Name",e.getAccessKey());if(r.length==0)throw new Error(`No data could be found for the Silo URI: ${t}`);let i=await this.transactions.get(r[0]);if(!i)throw new Error(`No data could be found for the Silo URI: ${t}`);let o=i.get("data",{decode:!0,string:!1});return this.crypto.decrypt(o,e.getEncryptionKey())}async readTransactionData(t,e){if(!e)throw new Error("No Silo URI specified");let r=await this.parseUri(e),i=t.get("data",{decode:!0,string:!1});return this.crypto.decrypt(i,r.getEncryptionKey())}async parseUri(t){let e=t.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!e)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");let r=e[1],i=Math.pow(2,parseInt(e[2])),o=await this.hash(Jl.stringToBuffer(r),i),a=Jl.bufferTob64(o.slice(0,15)),s=await this.hash(o.slice(16,31),1);return new Co(t,a,s)}async hash(t,e){let r=await this.crypto.hash(t);for(let i=0;i<e-1;i++)r=await this.crypto.hash(r);return r}};ni.default=Ps;var Co=class{uri;accessKey;encryptionKey;constructor(t,e,r){this.uri=t,this.accessKey=e,this.encryptionKey=r}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}};ni.SiloResource=Co});var Zl=J(Ws=>{"use strict";m();Object.defineProperty(Ws,"__esModule",{value:!0});var Xl=Qn(),Hg=fe(),Ns=class{api;constructor(t){this.api=t}async getTransactionOffset(t){let e=await this.api.get(`tx/${t}/offset`);if(e.status===200)return e.data;throw new Error(`Unable to get transaction offset: ${(0,Xl.getError)(e)}`)}async getChunk(t){let e=await this.api.get(`chunk/${t}`);if(e.status===200)return e.data;throw new Error(`Unable to get chunk: ${(0,Xl.getError)(e)}`)}async getChunkData(t){let e=await this.getChunk(t);return Hg.b64UrlToBuffer(e.chunk)}firstChunkOffset(t){return parseInt(t.offset)-parseInt(t.size)+1}async downloadChunkedData(t){let e=await this.getTransactionOffset(t),r=parseInt(e.size),o=parseInt(e.offset)-r+1,a=new Uint8Array(r),s=0;for(;s<r;){this.api.config.logging&&console.log(`[chunk] ${s}/${r}`);let c;try{c=await this.getChunkData(o+s)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${o+s}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(c)a.set(c,s),s+=c.length;else throw new Error(`Couldn't complete data download at ${s}/${r}`)}return a}};Ws.default=Ns});var tf=J(Us=>{"use strict";m();Object.defineProperty(Us,"__esModule",{value:!0});var Qg=Qn();xo();var Fs=class{api;network;constructor(t,e){this.api=t,this.network=e}async get(t){let e=await this.api.get(`${Fs.ENDPOINT}${t}`);if(e.status===200)return e.data;throw e.status===404?new Qg.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${e}`)}async getCurrent(){let{current:t}=await this.network.getInfo();return await this.get(t)}},Io=Fs;Ve(Io,"ENDPOINT","block/hash/");Us.default=Io});var zn=J(Ds=>{"use strict";m();Object.defineProperty(Ds,"__esModule",{value:!0});var zg=El(),Jg=Tl(),Yg=Bl(),Xg=Pl(),Zg=Hl(),tp=zl(),ef=Eo(),ii=fe(),ep=Yl(),rp=Zl(),np=tf(),Zr=class{api;wallets;transactions;network;blocks;ar;silo;chunks;constructor(t){this.api=new Jg.default(t),this.wallets=new tp.default(this.api,Zr.crypto),this.chunks=new rp.default(this.api),this.transactions=new Zg.default(this.api,Zr.crypto,this.chunks),this.silo=new ep.default(this.api,this.crypto,this.transactions),this.network=new Xg.default(this.api),this.blocks=new np.default(this.api,this.network),this.ar=new zg.default}get crypto(){return Zr.crypto}get utils(){return Zr.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(t,e){let r={};if(Object.assign(r,t),!t.data&&!(t.target&&t.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(t.owner==null&&e&&e!=="use_wallet"&&(r.owner=e.n),t.last_tx==null&&(r.last_tx=await this.transactions.getTransactionAnchor()),typeof t.data=="string"&&(t.data=ii.stringToBuffer(t.data)),t.data instanceof ArrayBuffer&&(t.data=new Uint8Array(t.data)),t.data&&!(t.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(t.reward==null){let o=t.data?t.data.byteLength:0;r.reward=await this.transactions.getPrice(o,r.target)}r.data_root="",r.data_size=t.data?t.data.byteLength.toString():"0",r.data=t.data||new Uint8Array(0);let i=new ef.default(r);return await i.getSignatureData(),i}async createSiloTransaction(t,e,r){let i={};if(Object.assign(i,t),!t.data)throw new Error("Silo transactions must have a 'data' value");if(!r)throw new Error("No Silo URI specified.");if(t.target||t.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(t.owner==null){if(!e||!e.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");i.owner=e.n}t.last_tx==null&&(i.last_tx=await this.transactions.getTransactionAnchor());let o=await this.silo.parseUri(r);if(typeof t.data=="string"){let s=await this.crypto.encrypt(ii.stringToBuffer(t.data),o.getEncryptionKey());i.reward=await this.transactions.getPrice(s.byteLength),i.data=ii.bufferTob64Url(s)}if(t.data instanceof Uint8Array){let s=await this.crypto.encrypt(t.data,o.getEncryptionKey());i.reward=await this.transactions.getPrice(s.byteLength),i.data=ii.bufferTob64Url(s)}let a=new ef.default(i);return a.addTag("Silo-Name",o.getAccessKey()),a.addTag("Silo-Version","0.1.0"),a}arql(t){return this.api.post("/arql",t).then(e=>e.data||[])}},Xr=Zr;Ve(Xr,"init"),Ve(Xr,"crypto",new Yg.default),Ve(Xr,"utils",ii);Ds.default=Xr});var rf=J(ko=>{"use strict";m();Object.defineProperty(ko,"__esModule",{value:!0});ko.getDefaultConfig=void 0;var ip=(n,t)=>{let e=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,r=t.split("."),i=r[r.length-1],o=["localhost","[::1]"];return o.includes(t)||n=="file"||o.includes(i)||!!t.match(e)||!!i.match(e)},op=n=>{let t=n.charAt(0)==="[",e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return!!n.match(e)||t},ap=(n,t)=>{if(ip(n,t))return{protocol:"https",host:"arweave.net",port:443};if(!op(t)){let e=t.split(".");if(e.length>=3){e.shift();let r=e.join(".");return{protocol:n,host:r}}}return{protocol:n,host:t}};ko.getDefaultConfig=ap});var Ao=J(or=>{"use strict";m();var sp=or&&or.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,i)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),cp=or&&or.__exportStar||function(n,t){for(var e in n)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&sp(t,n,e)};Object.defineProperty(or,"__esModule",{value:!0});var tn=zn(),up=rf();tn.default.init=function(n={}){let t={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return new tn.default({...n,...t});let e=location.protocol.replace(":",""),r=location.hostname,i=location.port?parseInt(location.port):e=="https"?443:80,o=(0,up.getDefaultConfig)(e,r),a=n.protocol||o.protocol,s=n.host||o.host,c=n.port||o.port||i;return new tn.default({...n,host:s,protocol:a,port:c})};typeof globalThis=="object"?globalThis.Arweave=tn.default:typeof self=="object"&&(self.Arweave=tn.default);cp(zn(),or);or.default=tn.default});var Bf=J((cc,Rf)=>{"use strict";m();var{hasOwnProperty:Do}=Object.prototype,Br=sc();Br.configure=sc;Br.stringify=Br;Br.default=Br;cc.stringify=Br;cc.configure=sc;Rf.exports=Br;var Of=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/,jp=new RegExp(Of,"g"),ac=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000b","\\f","\\r","\\u000e","\\u000f","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001a","\\u001b","\\u001c","\\u001d","\\u001e","\\u001f","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\"];function Hp(n){if(n.length===2){let e=n.charCodeAt(1);return`${n[0]}\\u${e.toString(16)}`}let t=n.charCodeAt(0);return ac.length>t?ac[t]:`\\u${t.toString(16)}`}function ar(n){if(n.length<5e3&&!Of.test(n))return n;if(n.length>100)return n.replace(jp,Hp);let t="",e=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(i===34||i===92||i<32)t+=`${n.slice(e,r)}${ac[i]}`,e=r+1;else if(i>=55296&&i<=57343){if(i<=56319&&r+1<n.length){let o=n.charCodeAt(r+1);if(o>=56320&&o<=57343){r++;continue}}t+=`${n.slice(e,r)}\\u${i.toString(16)}`,e=r+1}}return t+=n.slice(e),t}function nc(n){if(n.length>200)return n.sort();for(let t=1;t<n.length;t++){let e=n[t],r=t;for(;r!==0&&n[r-1]>e;)n[r]=n[r-1],r--;n[r]=e}return n}var Qp=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function ic(n){return Qp.call(n)!==void 0&&n.length!==0}function oc(n,t,e){n.length<e&&(e=n.length);let r=t===","?"":" ",i=`"0":${r}${n[0]}`;for(let o=1;o<e;o++)i+=`${t}"${o}":${r}${n[o]}`;return i}function zp(n){if(Do.call(n,"circularValue")){let t=n.circularValue;if(typeof t=="string")return`"${t}"`;if(t==null)return t;if(t===Error||t===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function Af(n,t){let e;if(Do.call(n,t)&&(e=n[t],typeof e!="boolean"))throw new TypeError(`The "${t}" argument must be of type boolean`);return e===void 0?!0:e}function Lf(n,t){let e;if(Do.call(n,t)){if(e=n[t],typeof e!="number")throw new TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(e))throw new TypeError(`The "${t}" argument must be an integer`);if(e<1)throw new RangeError(`The "${t}" argument must be >= 1`)}return e===void 0?1/0:e}function Rr(n){return n===1?"1 item":`${n} items`}function Jp(n){let t=new Set;for(let e of n)(typeof e=="string"||typeof e=="number")&&t.add(String(e));return t}function Yp(n){if(Do.call(n,"strict")){let t=n.strict;if(typeof t!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(t)return e=>{let r=`Object can not safely be stringified. Received type ${typeof e}`;throw typeof e!="function"&&(r+=` (${e.toString()})`),new Error(r)}}}function sc(n){n={...n};let t=Yp(n);t&&(n.bigint===void 0&&(n.bigint=!1),"circularValue"in n||(n.circularValue=Error));let e=zp(n),r=Af(n,"bigint"),i=Af(n,"deterministic"),o=Lf(n,"maximumDepth"),a=Lf(n,"maximumBreadth");function s(I,f,v,L,U,$){let V=f[I];switch(typeof V=="object"&&V!==null&&typeof V.toJSON=="function"&&(V=V.toJSON(I)),V=L.call(f,I,V),typeof V){case"string":return`"${ar(V)}"`;case"object":{if(V===null)return"null";if(v.indexOf(V)!==-1)return e;let G="",H=",",R=$;if(Array.isArray(V)){if(V.length===0)return"[]";if(o<v.length+1)return'"[Array]"';v.push(V),U!==""&&($+=U,G+=`
${$}`,H=`,
${$}`);let Q=Math.min(V.length,a),Y=0;for(;Y<Q-1;Y++){let dt=s(Y,V,v,L,U,$);G+=dt!==void 0?dt:"null",G+=H}let ut=s(Y,V,v,L,U,$);if(G+=ut!==void 0?ut:"null",V.length-1>a){let dt=V.length-a-1;G+=`${H}"... ${Rr(dt)} not stringified"`}return U!==""&&(G+=`
${R}`),v.pop(),`[${G}]`}let M=Object.keys(V),tt=M.length;if(tt===0)return"{}";if(o<v.length+1)return'"[Object]"';let z="",x="";U!==""&&($+=U,H=`,
${$}`,z=" ");let it=Math.min(tt,a);ic(V)&&(G+=oc(V,H,a),M=M.slice(V.length),it-=V.length,x=H),i&&(M=nc(M)),v.push(V);for(let Q=0;Q<it;Q++){let Y=M[Q],ut=s(Y,V,v,L,U,$);ut!==void 0&&(G+=`${x}"${ar(Y)}":${z}${ut}`,x=H)}if(tt>a){let Q=tt-a;G+=`${x}"...":${z}"${Rr(Q)} not stringified"`,x=H}return U!==""&&x.length>1&&(G=`
${$}${G}
${R}`),v.pop(),`{${G}}`}case"number":return isFinite(V)?String(V):t?t(V):"null";case"boolean":return V===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(V);default:return t?t(V):void 0}}function c(I,f,v,L,U,$){switch(typeof f=="object"&&f!==null&&typeof f.toJSON=="function"&&(f=f.toJSON(I)),typeof f){case"string":return`"${ar(f)}"`;case"object":{if(f===null)return"null";if(v.indexOf(f)!==-1)return e;let V=$,G="",H=",";if(Array.isArray(f)){if(f.length===0)return"[]";if(o<v.length+1)return'"[Array]"';v.push(f),U!==""&&($+=U,G+=`
${$}`,H=`,
${$}`);let tt=Math.min(f.length,a),z=0;for(;z<tt-1;z++){let it=c(z,f[z],v,L,U,$);G+=it!==void 0?it:"null",G+=H}let x=c(z,f[z],v,L,U,$);if(G+=x!==void 0?x:"null",f.length-1>a){let it=f.length-a-1;G+=`${H}"... ${Rr(it)} not stringified"`}return U!==""&&(G+=`
${V}`),v.pop(),`[${G}]`}if(L.size===0)return"{}";v.push(f);let R="";U!==""&&($+=U,H=`,
${$}`,R=" ");let M="";for(let tt of L){let z=c(tt,f[tt],v,L,U,$);z!==void 0&&(G+=`${M}"${ar(tt)}":${R}${z}`,M=H)}return U!==""&&M.length>1&&(G=`
${$}${G}
${V}`),v.pop(),`{${G}}`}case"number":return isFinite(f)?String(f):t?t(f):"null";case"boolean":return f===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(f);default:return t?t(f):void 0}}function l(I,f,v,L,U){switch(typeof f){case"string":return`"${ar(f)}"`;case"object":{if(f===null)return"null";if(typeof f.toJSON=="function"){if(f=f.toJSON(I),typeof f!="object")return l(I,f,v,L,U);if(f===null)return"null"}if(v.indexOf(f)!==-1)return e;let $=U;if(Array.isArray(f)){if(f.length===0)return"[]";if(o<v.length+1)return'"[Array]"';v.push(f),U+=L;let z=`
${U}`,x=`,
${U}`,it=Math.min(f.length,a),Q=0;for(;Q<it-1;Q++){let ut=l(Q,f[Q],v,L,U);z+=ut!==void 0?ut:"null",z+=x}let Y=l(Q,f[Q],v,L,U);if(z+=Y!==void 0?Y:"null",f.length-1>a){let ut=f.length-a-1;z+=`${x}"... ${Rr(ut)} not stringified"`}return z+=`
${$}`,v.pop(),`[${z}]`}let V=Object.keys(f),G=V.length;if(G===0)return"{}";if(o<v.length+1)return'"[Object]"';U+=L;let H=`,
${U}`,R="",M="",tt=Math.min(G,a);ic(f)&&(R+=oc(f,H,a),V=V.slice(f.length),tt-=f.length,M=H),i&&(V=nc(V)),v.push(f);for(let z=0;z<tt;z++){let x=V[z],it=l(x,f[x],v,L,U);it!==void 0&&(R+=`${M}"${ar(x)}": ${it}`,M=H)}if(G>a){let z=G-a;R+=`${M}"...": "${Rr(z)} not stringified"`,M=H}return M!==""&&(R=`
${U}${R}
${$}`),v.pop(),`{${R}}`}case"number":return isFinite(f)?String(f):t?t(f):"null";case"boolean":return f===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(f);default:return t?t(f):void 0}}function p(I,f,v){switch(typeof f){case"string":return`"${ar(f)}"`;case"object":{if(f===null)return"null";if(typeof f.toJSON=="function"){if(f=f.toJSON(I),typeof f!="object")return p(I,f,v);if(f===null)return"null"}if(v.indexOf(f)!==-1)return e;let L="";if(Array.isArray(f)){if(f.length===0)return"[]";if(o<v.length+1)return'"[Array]"';v.push(f);let H=Math.min(f.length,a),R=0;for(;R<H-1;R++){let tt=p(R,f[R],v);L+=tt!==void 0?tt:"null",L+=","}let M=p(R,f[R],v);if(L+=M!==void 0?M:"null",f.length-1>a){let tt=f.length-a-1;L+=`,"... ${Rr(tt)} not stringified"`}return v.pop(),`[${L}]`}let U=Object.keys(f),$=U.length;if($===0)return"{}";if(o<v.length+1)return'"[Object]"';let V="",G=Math.min($,a);ic(f)&&(L+=oc(f,",",a),U=U.slice(f.length),G-=f.length,V=","),i&&(U=nc(U)),v.push(f);for(let H=0;H<G;H++){let R=U[H],M=p(R,f[R],v);M!==void 0&&(L+=`${V}"${ar(R)}":${M}`,V=",")}if($>a){let H=$-a;L+=`${V}"...":"${Rr(H)} not stringified"`}return v.pop(),`{${L}}`}case"number":return isFinite(f)?String(f):t?t(f):"null";case"boolean":return f===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(f);default:return t?t(f):void 0}}function y(I,f,v){if(arguments.length>1){let L="";if(typeof v=="number"?L=" ".repeat(Math.min(v,10)):typeof v=="string"&&(L=v.slice(0,10)),f!=null){if(typeof f=="function")return s("",{"":I},[],f,L,"");if(Array.isArray(f))return c("",I,[],Jp(f),L,"")}if(L.length!==0)return l("",I,[],L,"")}return p("",I,[])}return y}});var om={};jf(om,{AbstractContractHandler:()=>Lr,ArweaveGatewayBundledContractDefinitionLoader:()=>ki,ArweaveGatewayBundledInteractionLoader:()=>fn,ArweaveGatewayInteractionsLoader:()=>hi,ArweaveWrapper:()=>Ut,BUNDLR_NODES:()=>Xp,Benchmark:()=>ft,CacheKey:()=>Rt,CacheableInteractionsLoader:()=>on,CacheableStateEvaluator:()=>gi,ConsoleLogger:()=>yn,ConsoleLoggerFactory:()=>wn,ContractCache:()=>qn,ContractCallRecord:()=>Or,ContractDefinitionLoader:()=>Ar,ContractError:()=>ie,ContractMetadata:()=>cs,DEFAULT_LEVEL_DB_LOCATION:()=>Go,DataItem:()=>mc,DefaultEvaluationOptions:()=>Vn,DefaultStateEvaluator:()=>di,EvalStateResult:()=>Et,EvaluationOptionsEvaluator:()=>Ei,HandlerBasedContract:()=>Pr,HandlerExecutorFactory:()=>vi,InnerWritesEvaluator:()=>bi,InteractionCall:()=>un,InteractionInput:()=>Fo,InteractionOutput:()=>ec,JsHandlerApi:()=>yi,KV:()=>Wo,LevelDbCache:()=>Te,LexicographicalInteractionsSorter:()=>$e,LogLevelOrder:()=>Fc,LoggerFactory:()=>rt,MemCache:()=>es,PstContractImpl:()=>Ci,SMART_WEAVE_TAGS:()=>pt,SUPPORTED_SRC_CONTENT_TYPES:()=>jn,SWBlock:()=>sn,SWTransaction:()=>an,SWVrf:()=>cn,Signature:()=>Si,SmartWeaveError:()=>_i,SmartWeaveErrorType:()=>rc,SmartWeaveGlobal:()=>pi,SortKeyCacheResult:()=>Ct,SourceType:()=>bl,SrcCache:()=>Gn,Tag:()=>oi,TagsParser:()=>At,Transaction:()=>Ir,WARP_GW_URL:()=>gc,WARP_TAGS:()=>nt,Warp:()=>Nr,WarpBuilder:()=>Ii,WarpFactory:()=>pc,WarpFetchWrapper:()=>Ti,WarpGatewayContractDefinitionLoader:()=>fi,WarpGatewayInteractionsLoader:()=>Kn,WasmHandlerApi:()=>wi,WasmSrc:()=>Me,arrayToHex:()=>Qs,asc:()=>Cg,ascS:()=>Ig,bufToBn:()=>Lg,bundledTxsFilter:()=>Ys,checkJsSrc:()=>Mp,createDummyTx:()=>lc,createInteractionTx:()=>Mo,deepCopy:()=>nr,defaultArweaveMs:()=>No,defaultCacheOptions:()=>ln,defaultWarpGwOptions:()=>jo,desc:()=>kg,descS:()=>Ag,emptyTransfer:()=>sr,genesisSortKey:()=>nn,getJsonResponse:()=>Ce,indent:()=>le,isBrowser:()=>$n,knownWarpPlugins:()=>dc,knownWarpPluginsPartial:()=>hc,lastPossibleSortKey:()=>Up,lvlToOrder:()=>Pi,mapReplacer:()=>Tg,mapReviver:()=>xg,matchMutClosureDtor:()=>nm,normalizeContractSource:()=>Uo,rustWasmImports:()=>Zs,safeParseInt:()=>Mn,sleep:()=>Dn,sortingFirst:()=>bf,sortingLast:()=>Js,stripTrailingSlash:()=>xe,timeout:()=>ss});m();m();m();var Fc={silly:0,trace:1,debug:2,info:3,warn:4,error:5,fatal:6,none:7};function Pi(n){return Fc[n]}var yn=class{constructor(t,e){this.moduleName=t;this.settings=e}trace(t,...e){this.shouldLog("trace")&&console.debug(this.message("trace",t),e)}error(t,...e){this.shouldLog("error")&&console.error(this.message("error",t),e)}info(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}silly(t,...e){this.shouldLog("silly")&&console.debug(this.message("silly",t),e)}debug(t,...e){this.shouldLog("debug")&&console.debug(this.message("debug",t),e)}warn(t,...e){this.shouldLog("warn")&&console.warn(this.message("warn",t),e)}log(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}fatal(t,...e){this.shouldLog("fatal")&&console.error(this.message("fatal",t),e)}shouldLog(t){return Pi(t)>=Pi(this.settings.minLevel)}setSettings(t){this.settings=t}message(t,e){return`${new Date().toISOString()} ${t.toUpperCase()} [${this.moduleName}] ${e}`}};m();var wn=class{registeredLoggers={};registeredOptions={};defOptions={minLevel:"info"};constructor(){this.setOptions=this.setOptions.bind(this),this.getOptions=this.getOptions.bind(this),this.create=this.create.bind(this),this.logLevel=this.logLevel.bind(this)}setOptions(t,e){e?this.registeredLoggers[e]?this.registeredLoggers[e].setSettings({...this.registeredLoggers[e].settings,...t}):this.registeredOptions[e]={...this.defOptions,...t}:(this.defOptions=t,Object.keys(this.registeredLoggers).forEach(r=>{this.registeredLoggers[r].setSettings({...this.registeredLoggers[r].settings,...t})}))}getOptions(t){return t?this.registeredLoggers[t]?this.registeredLoggers[t].settings:this.registeredOptions[t]?this.registeredOptions[t]:this.defOptions:this.defOptions}logLevel(t,e){this.setOptions({minLevel:t},e)}create(t="SWC"){return Object.prototype.hasOwnProperty.call(this.registeredLoggers,t)||(this.registeredLoggers[t]=new yn(t,this.getOptions(t))),this.registeredLoggers[t]}};m();var hr=class{constructor(){}setOptions(t,e){hr.INST.setOptions(t,e)}getOptions(t){return hr.INST.getOptions(t)}logLevel(t,e){hr.INST.logLevel(t,e)}create(t){return hr.INST.create(t)}static use(t){hr.INST=t}},rt=hr;Ve(rt,"INST",new wn);m();var ft=class{static measure(){return new ft}constructor(){}start=Date.now();end=null;reset(){this.start=Date.now(),this.end=null}stop(){this.end=Date.now()}elapsed(t=!1){this.end===null&&(this.end=Date.now());let e=this.end-this.start;return t?e:`${(this.end-this.start).toFixed(0)}ms`}};m();var Rt=class{constructor(t,e){this.key=t;this.sortKey=e}},Ct=class{constructor(t,e){this.sortKey=t;this.cachedValue=e}};m();var sl=Ot(Xu()),cl=Ot(al());var mo=class{constructor(t,e=!1){this.value=t;this.tomb=e}},Te=class{constructor(t){this.cacheOptions=t;this.subLevelSeparator=t.subLevelSeparator||"!",this.subLevelOptions={valueEncoding:"json",separator:this.subLevelSeparator}}ongoingTransactionMark="$$warp-internal-transaction$$";logger=rt.INST.create("LevelDbCache");subLevelSeparator;subLevelOptions;_db;_rollbackBatch;get db(){if(!this._db)if(this.cacheOptions.inMemory)this._db=new cl.MemoryLevel(this.subLevelOptions);else{if(!this.cacheOptions.dbLocation)throw new Error("LevelDb cache configuration error - no db location specified");let t=this.cacheOptions.dbLocation;this.logger.info(`Using location ${t}`),this._db=new sl.Level(t,this.subLevelOptions)}return this._db}async get(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open();let i=await this.getValueFromLevel(t.sortKey,r);return i?new Ct(t.sortKey,i):null}async getLast(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open();let r=await e.keys({reverse:!0,limit:1}).all();if(r.length){let i=await this.getValueFromLevel(r[0],e);if(i)return new Ct(r[0],i)}return null}async getLessOrEqual(t,e){let r=this.db.sublevel(t,this.subLevelOptions);await r.open();let i=await r.keys({reverse:!0,lte:e,limit:1}).all();if(i.length){let o=await this.getValueFromLevel(i[0],r);if(o)return new Ct(i[0],o)}return null}async getValueFromLevel(t,e){try{let r=await e.get(t);if(r&&r.tomb===void 0&&r.value===void 0)return r;if(r&&r.tomb===!1&&r.value!=null)return r.value}catch(r){if(r.code!="LEVEL_NOT_FOUND")throw r}return null}async put(t,e){await this.setClientValue(t,new mo(e))}async del(t){await this.setClientValue(t,new mo(null,!0))}async setClientValue(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open(),await r.put(t.sortKey,e),this._rollbackBatch&&this._rollbackBatch.del(t.sortKey,{sublevel:r})}async delete(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open(),await e.clear()}async batch(t){for(let e of t)e.type==="put"?await this.put(e.key,e.value):e.type==="del"&&await this.delete(e.key)}async open(){await this.db.open()}async close(){this._db&&await this._db.close()}async begin(){await this.initRollbackBatch()}async rollback(){this._rollbackBatch&&(this._rollbackBatch.del(this.ongoingTransactionMark),await this._rollbackBatch.write(),await this._rollbackBatch.close()),this._rollbackBatch=null}async initRollbackBatch(){return this._rollbackBatch==null&&(await this.checkPreviousTransactionFinished(),await this.db.put(this.ongoingTransactionMark,"ongoing"),this._rollbackBatch=this.db.batch()),this._rollbackBatch}async checkPreviousTransactionFinished(){let t;try{t=await this.db.get(this.ongoingTransactionMark)}catch(e){if(e.code!="LEVEL_NOT_FOUND")throw e}if(t=="ongoing")throw new Error("Database seems to be in inconsistent state. The previous transaction has not finished.")}async commit(){this._rollbackBatch&&(await this._rollbackBatch.clear(),await this.db.del(this.ongoingTransactionMark),await this._rollbackBatch.close()),this._rollbackBatch=null}async dump(){return await this.db.iterator().all()}async getLastSortKey(){let t="";await this.db.open();let e=await this.db.keys().all();for(let r of e){let i=r.split(this.subLevelSeparator)[1];i.localeCompare(t)>0&&(t=i)}return t==""?null:t}async keys(t,e){return Array.from((await this.kvMap(t,e)).keys())}validateKey(t){if(t.includes(this.ongoingTransactionMark))throw new Error(`Validation error: Key ${t} for internal use only`);if(t.includes(this.subLevelSeparator))throw new Error(`Validation error: key ${t} contains db separator ${this.subLevelSeparator}`)}extractOriginalKey(t){return t.split(this.subLevelSeparator)[1]}extractSortKey(t){return t.split(this.subLevelSeparator)[2]}async kvMap(t,e){let r=new Map,i=(await this.db.keys(this.levelRangeOptions(e)).all()).filter(o=>o!=this.ongoingTransactionMark).filter(o=>!t||this.extractSortKey(o).localeCompare(t)<=0).map(o=>this.extractOriginalKey(o));for(let o of i){let a=await this.getLessOrEqual(o,t);a&&r.set(o,a.cachedValue)}if(e?.limit){let o=new Map;for(let a of Array.from(r.entries()).slice(0,e.limit))o.set(a[0],a[1]);return o}return r}levelRangeOptions(t){let e={reverse:t?.reverse};return t?.gte&&(e.gte=this.subLevelSeparator+t.gte),t?.lt&&(e.lt=this.subLevelSeparator+t.lt),e}storage(){return this.db}async getNumEntries(){return(await this.db.keys().all()).length}async prune(t=5){(!t||t<=0)&&(t=1);let e=await this.allKeys();for(let r=0;r<e.length;r++){let i=this.db.sublevel(e[r],this.subLevelOptions);await i.open();let o=await i.keys({reverse:!0,limit:t}).all();!o||o.length<t||(await i.clear({lt:o[o.length-1]}),await i.close())}return null}async allKeys(){return(await this.db.keys().all()).filter(t=>t!=this.ongoingTransactionMark).map(t=>this.extractOriginalKey(t))}};m();var es=class{storage={};clearAll(){Object.keys(this.storage).forEach(t=>{delete this.storage[t]})}contains(t){return Object.prototype.hasOwnProperty.call(this.storage,t)}get(t){return this.storage[t]}put(t,e){this.storage[t]=e}remove(t){delete this.storage[t]}};m();m();var lw=Ot(rr());m();m();var qd=Function.prototype.toString,rs=Object.create,jd=Object.prototype.toString,Hd=function(){function n(){this._keys=[],this._values=[]}return n.prototype.has=function(t){return!!~this._keys.indexOf(t)},n.prototype.get=function(t){return this._values[this._keys.indexOf(t)]},n.prototype.set=function(t,e){this._keys.push(t),this._values.push(e)},n}();function Qd(){return new Hd}function zd(){return new WeakMap}var Jd=typeof WeakMap<"u"?zd:Qd;function is(n){if(!n)return rs(null);var t=n.constructor;if(t===Object)return n===Object.prototype?{}:rs(n);if(~qd.call(t).indexOf("[native code]"))try{return new t}catch{}return rs(n)}function Yd(n){var t="";return n.global&&(t+="g"),n.ignoreCase&&(t+="i"),n.multiline&&(t+="m"),n.unicode&&(t+="u"),n.sticky&&(t+="y"),t}function Xd(n){return n.flags}var Zd=/test/g.flags==="g"?Xd:Yd;function ll(n){var t=jd.call(n);return t.substring(8,t.length-1)}function tg(n){return n[Symbol.toStringTag]||ll(n)}var eg=typeof Symbol<"u"?tg:ll,rg=Object.defineProperty,ng=Object.getOwnPropertyDescriptor,fl=Object.getOwnPropertyNames,os=Object.getOwnPropertySymbols,hl=Object.prototype,dl=hl.hasOwnProperty,ig=hl.propertyIsEnumerable,gl=typeof os=="function";function og(n){return fl(n).concat(os(n))}var ag=gl?og:fl;function wo(n,t,e){for(var r=ag(n),i=0,o=r.length,a=void 0,s=void 0;i<o;++i)if(a=r[i],!(a==="callee"||a==="caller")){if(s=ng(n,a),!s){t[a]=e.copier(n[a],e);continue}!s.get&&!s.set&&(s.value=e.copier(s.value,e));try{rg(t,a,s)}catch{t[a]=s.value}}return t}function sg(n,t){var e=new t.Constructor;t.cache.set(n,e);for(var r=0,i=n.length;r<i;++r)e[r]=t.copier(n[r],t);return e}function cg(n,t){var e=new t.Constructor;return t.cache.set(n,e),wo(n,e,t)}function pl(n,t){return n.slice(0)}function ug(n,t){return n.slice(0,n.size,n.type)}function lg(n,t){return new t.Constructor(pl(n.buffer))}function fg(n,t){return new t.Constructor(n.getTime())}function ml(n,t){var e=new t.Constructor;return t.cache.set(n,e),n.forEach(function(r,i){e.set(i,t.copier(r,t))}),e}function hg(n,t){return wo(n,ml(n,t),t)}function dg(n,t){var e=is(t.prototype);t.cache.set(n,e);for(var r in n)dl.call(n,r)&&(e[r]=t.copier(n[r],t));return e}function gg(n,t){var e=is(t.prototype);t.cache.set(n,e);for(var r in n)dl.call(n,r)&&(e[r]=t.copier(n[r],t));for(var i=os(n),o=0,a=i.length,s=void 0;o<a;++o)s=i[o],ig.call(n,s)&&(e[s]=t.copier(n[s],t));return e}var pg=gl?gg:dg;function mg(n,t){var e=is(t.prototype);return t.cache.set(n,e),wo(n,e,t)}function ns(n,t){return new t.Constructor(n.valueOf())}function yg(n,t){var e=new t.Constructor(n.source,Zd(n));return e.lastIndex=n.lastIndex,e}function yo(n,t){return n}function yl(n,t){var e=new t.Constructor;return t.cache.set(n,e),n.forEach(function(r){e.add(t.copier(r,t))}),e}function wg(n,t){return wo(n,yl(n,t),t)}var vg=Array.isArray,as=Object.assign,_g=Object.getPrototypeOf||function(n){return n.__proto__},wl={array:sg,arrayBuffer:pl,blob:ug,dataView:lg,date:fg,error:yo,map:ml,object:pg,regExp:yg,set:yl},bg=as({},wl,{array:cg,map:hg,object:mg,set:wg});function Sg(n){return{Arguments:n.object,Array:n.array,ArrayBuffer:n.arrayBuffer,Blob:n.blob,Boolean:ns,DataView:n.dataView,Date:n.date,Error:n.error,Float32Array:n.arrayBuffer,Float64Array:n.arrayBuffer,Int8Array:n.arrayBuffer,Int16Array:n.arrayBuffer,Int32Array:n.arrayBuffer,Map:n.map,Number:ns,Object:n.object,Promise:yo,RegExp:n.regExp,Set:n.set,String:ns,WeakMap:yo,WeakSet:yo,Uint8Array:n.arrayBuffer,Uint8ClampedArray:n.arrayBuffer,Uint16Array:n.arrayBuffer,Uint32Array:n.arrayBuffer,Uint64Array:n.arrayBuffer}}function vl(n){var t=as({},wl,n),e=Sg(t),r=e.Array,i=e.Object;function o(a,s){if(s.prototype=s.Constructor=void 0,!a||typeof a!="object")return a;if(s.cache.has(a))return s.cache.get(a);if(s.prototype=_g(a),s.Constructor=s.prototype&&s.prototype.constructor,!s.Constructor||s.Constructor===Object)return i(a,s);if(vg(a))return r(a,s);var c=e[eg(a)];return c?c(a,s):typeof a.then=="function"?a:i(a,s)}return function(s){return o(s,{Constructor:void 0,cache:Jd(),copier:o,prototype:void 0})}}function Eg(n){return vl(as({},bg,n))}var rw=Eg({}),_l=vl({});var Dn=n=>new Promise(t=>setTimeout(t,n)),Mn=n=>{let t=Number.parseInt(n);if(Number.isNaN(t)&&!Number.isSafeInteger(t))throw Error(`Failed to cast ${n} to integer`);return t},nr=n=>_l(n),Tg=(n,t)=>t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t,xg=(n,t)=>typeof t=="object"&&t!==null&&t.dataType==="Map"?new Map(t.value):t,Cg=(n,t)=>n-t,Ig=(n,t)=>+n-+t,kg=(n,t)=>t-n,Ag=(n,t)=>+t-+n;function ss(n){let t=null,e=new Promise((r,i)=>{t=setTimeout(()=>{clearTimeout(t),i("timeout")},n*1e3)});return{timeoutId:t,timeoutPromise:e}}function xe(n){return n.endsWith("/")?n.slice(0,-1):n}function le(n){return`[d:${n}]`.padEnd(n*2,"-").concat("> ")}function Lg(n){let t=[];return Uint8Array.from(n).forEach(function(r){let i=r.toString(16);i.length%2&&(i="0"+i),t.push(i)}),BigInt("0x"+t.join(""))}var $n=new Function("try {return this===window;}catch(e){ return false;}");async function Ce(n){let t;try{t=await n}catch(r){throw new Error(`Error while communicating with gateway: ${JSON.stringify(r)}`)}if(!t?.ok){let r=await t.text();throw new Error(`${t.status}: ${r}`)}return await t.json()}var bl=(r=>(r.ARWEAVE="arweave",r.WARP_SEQUENCER="redstone-sequencer",r.BOTH="both",r))(bl||{}),Kn=class{constructor(t=null,e="both"){this.confirmationStatus=t;this.source=e;Object.assign(this,t),this.source=e}_warp;logger=rt.INST.create("WarpGatewayInteractionsLoader");async load(t,e,r,i){this.logger.debug("Loading interactions: for ",{contractId:t,fromSortKey:e,toSortKey:r});let o=[],a=0,s=0,c=0,l=i?i.sourceType:this.source,p=ft.measure(),y=xe(this._warp.gwUrl());do{let I=ft.measure(),f=`${y}/gateway/v2/interactions-sort-key`,v=await Ce(fetch(`${f}?${new URLSearchParams({contractId:t,...this._warp.whoAmI?{client:this._warp.whoAmI}:"",...e?{from:e}:"",...r?{to:r}:"",page:(++a).toString(),fromSdk:"true",...this.confirmationStatus&&this.confirmationStatus.confirmed?{confirmationStatus:"confirmed"}:"",...this.confirmationStatus&&this.confirmationStatus.notCorrupted?{confirmationStatus:"not_corrupted"}:"",...l=="both"?"":{source:l}})}`));this.logger.debug(`Loading interactions: page ${a} loaded in ${I.elapsed()}`),o.push(...v.interactions),s=v.paging.limit,c=v.paging.items,this.logger.debug(`Loaded interactions length: ${o.length}, from: ${e}, to: ${r}`)}while(c==s);return this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:o.length,time:p.elapsed()}),o}type(){return"warp"}clearCache(){}set warp(t){this._warp=t}};var Et=class{constructor(t,e,r){this.state=t;this.validity=e;this.errorMessages=r}},Vn=class{ignoreExceptions=!0;waitForConfirmation=!1;updateCacheForEachInteraction=!1;internalWrites=!1;maxCallDepth=7;maxInteractionEvaluationTimeSeconds=60;stackTrace={saveState:!1};sequencerUrl="https://d1o5nlqr4okus2.cloudfront.net/";gasLimit=Number.MAX_SAFE_INTEGER;sourceType="both";unsafeClient="throw";allowBigInt=!1;walletBalanceUrl="http://nyc-1.dev.arweave.net:1984/";mineArLocalBlocks=!0;throwOnInternalWriteError=!0;cacheEveryNInteractions=-1;useKVStorage=!1;remoteStateSyncEnabled=!1;remoteStateSyncSource="https://dre-1.warp.cc/contract";useConstructor=!1};m();m();var jn=["application/javascript","application/wasm"],cs=class{dtor},Gn=class{src;srcBinary;srcWasmLang;constructor(t){this.src=t.src,this.srcBinary=t.srcBinary,this.srcWasmLang=t.srcWasmLang}},qn=class{txId;srcTxId;initState;minFee;owner;contractType;metadata;manifest;contractTx;srcTx;testnet;constructor(t){this.txId=t.txId,this.srcTxId=t.srcTxId,this.initState=t.initState,this.manifest=t.manifest,this.minFee=t.minFee,this.owner=t.owner,this.contractType=t.contractType,this.metadata=t.metadata,this.contractTx=t.contractTx,this.srcTx=t.srcTx,this.testnet=t.testnet}};m();var pt={APP_NAME:"App-Name",APP_VERSION:"App-Version",CONTRACT_TX_ID:"Contract",INPUT:"Input",CONTENT_TYPE:"Content-Type",CONTRACT_SRC_TX_ID:"Contract-Src",SDK:"SDK",MIN_FEE:"Min-Fee"},nt={SEQUENCER:"Sequencer",SEQUENCER_OWNER:"Sequencer-Owner",SEQUENCER_MILLIS:"Sequencer-Mills",SEQUENCER_SORT_KEY:"Sequencer-Sort-Key",SEQUENCER_PREV_SORT_KEY:"Sequencer-Prev-Sort-Key",SEQUENCER_LAST_SORT_KEY:"Sequencer-Last-Sort-Key",SEQUENCER_TX_ID:"Sequencer-Tx-Id",SEQUENCER_BLOCK_HEIGHT:"Sequencer-Block-Height",SEQUENCER_BLOCK_ID:"Sequencer-Block-Id",SEQUENCER_BLOCK_TIMESTAMP:"Sequencer-Block-Timestamp",INIT_STATE:"Init-State",INIT_STATE_TX:"Init-State-TX",INTERACT_WRITE:"Interact-Write",WASM_LANG:"Wasm-Lang",WASM_LANG_VERSION:"Wasm-Lang-Version",WASM_META:"Wasm-Meta",REQUEST_VRF:"Request-Vrf",SIGNATURE_TYPE:"Signature-Type",WARP_TESTNET:"Warp-Testnet",MANIFEST:"Contract-Manifest",NONCE:"Nonce"};m();var nf=Ot(Ao()),Ms=Ot(rr());m();var Wt=Ot(fe()),Lo=class{get(t,e){if(!Object.getOwnPropertyNames(this).includes(t))throw new Error(`Field "${t}" is not a property of the Arweave Transaction class.`);return this[t]instanceof Uint8Array?e&&e.decode&&e.string?Wt.bufferToString(this[t]):e&&e.decode&&!e.string?this[t]:Wt.bufferTob64Url(this[t]):e&&e.decode==!0?e&&e.string?Wt.b64UrlToString(this[t]):Wt.b64UrlToBuffer(this[t]):this[t]}},Ir=class extends Lo{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(t={}){super(),Object.assign(this,t),typeof this.data=="string"&&(this.data=Wt.b64UrlToBuffer(this.data)),t.tags&&(this.tags=t.tags.map(e=>new oi(e.name,e.value)))}addTag(t,e){this.tags.push(new oi(Wt.stringToB64Url(t),Wt.stringToB64Url(e)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:Wt.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(t){this.owner=t}setSignature({id:t,owner:e,reward:r,tags:i,signature:o}){this.id=t,this.owner=e,r&&(this.reward=r),i&&(this.tags=i),this.signature=o}async prepareChunks(t){throw new Error("Should not be called, use arweave-js version.")}getChunk(t,e){if(!this.chunks)throw new Error("Chunks have not been prepared");let r=this.chunks.proofs[t],i=this.chunks.chunks[t];return{data_root:this.data_root,data_size:this.data_size,data_path:Wt.bufferTob64Url(r.proof),offset:r.offset.toString(),chunk:Wt.bufferTob64Url(e.slice(i.minByteRange,i.maxByteRange))}}async getSignatureData(){throw new Error("Should not be called, use arweave-js version.")}},oi=class extends Lo{name;value;constructor(t,e,r=!1){super(),this.name=t,this.value=e}};var Ut=class{constructor(t){this.warp=t;let{arweave:e}=t;this.baseUrl=`${e.api.config.protocol}://${e.api.config.host}:${e.api.config.port}`,this.logger.debug("baseurl",this.baseUrl)}logger=rt.INST.create("ArweaveWrapper");baseUrl;async warpGwInfo(){return await this.doFetchInfo(`${xe(this.warp.gwUrl())}/gateway/arweave/info`)}async warpGwBlock(){return this.logger.debug("Calling warp gw block info"),await this.doFetchInfo(`${xe(this.warp.gwUrl())}/gateway/arweave/block`)}async info(){return await this.doFetchInfo(`${this.baseUrl}/info`)}async gql(t,e){try{let r=JSON.stringify({query:t,variables:e});return{data:await Ce(fetch(`${this.baseUrl}/graphql`,{method:"POST",body:r,headers:{"Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Accept:"application/json"}})),status:200}}catch(r){throw this.logger.error("Error while loading gql",r),r}}async tx(t){let e=await fetch(`${this.baseUrl}/tx/${t}`).then(r=>r.ok?r.json():Promise.reject(r)).catch(r=>{throw r.body?.message&&this.logger.error(r.body.message),new Error(`Unable to retrieve tx ${t}. ${r.status}. ${r.body?.message}`)});return new Ir({...e})}async txData(t){let e=await fetch(`${this.baseUrl}/${t}`);if(e.ok){let r=await e.arrayBuffer();return Ms.Buffer.from(r)}else{this.logger.warn(`Unable to load data from arweave.net/${t} endpoint, falling back to arweave.js`);let r=await this.warp.arweave.transactions.getData(t,{decode:!0});return Ms.Buffer.from(r)}}async txDataString(t){let e=await this.txData(t);return nf.default.utils.bufferToString(e)}async doFetchInfo(t){return await Ce(fetch(t))}};m();var At=class{logger=rt.INST.create("TagsParser");getInputTag(t,e){if(At.hasMultipleInteractions(t)){this.logger.debug("Interaction transaction is using multiple input tx tag format.");let r=t.tags.findIndex(o=>o.name===pt.CONTRACT_TX_ID&&o.value===e);if(t.tags.length-1===r){this.logger.warn("Wrong tags format: 'Contract' is the last tag");return}let i=t.tags[r+1];if(i.name!==pt.INPUT){this.logger.warn(`No 'Input' tag found after 'Contract' tag. Instead ${i.name} was found`);return}return i}else return t.tags.find(r=>r.name===pt.INPUT)}isInteractWrite(t,e){return t.tags.some(r=>r.name===nt.INTERACT_WRITE&&r.value===e)}getInteractWritesContracts(t){return t.tags.filter(e=>e.name===nt.INTERACT_WRITE).map(e=>e.value)}getContractTag(t){return t.tags.find(e=>e.name===pt.CONTRACT_TX_ID)?.value}getContractsWithInputs(t){let e=new Map;return t.tags.filter(i=>i.name===pt.CONTRACT_TX_ID).forEach(i=>{e.set(i.value,this.getInputTag(t,i.value))}),e}isEvmSigned(t){return t.tags.some(e=>e.name===nt.SIGNATURE_TYPE&&e.value==="ethereum")}static hasMultipleInteractions(t){return t.tags.filter(e=>e.name===pt.CONTRACT_TX_ID).length>1}decodeTags(t){let e=t.get("tags"),r=[];for(let i of e)try{let o=i.get("name",{decode:!0,string:!0}),a=i.get("value",{decode:!0,string:!0});r.push({name:o,value:a})}catch{}return r}getTag(t,e){let r=t.get("tags");for(let i of r)try{if(i.get("name",{decode:!0,string:!0})===e)return i.get("value",{decode:!0,string:!0})}catch{}return!1}hasVrfTag(t){return t.tags.some(e=>e.name==nt.REQUEST_VRF&&e.value==="true")}};m();m();function lf(n){return n.arrayBuffer?n.arrayBuffer():new Promise((t,e)=>{let r=new FileReader;r.addEventListener("loadend",()=>{t(r.result)}),r.addEventListener("error",e),r.readAsArrayBuffer(n)})}async function lp(n){let t=await lf(n);return new Uint8Array(t)}function ff(n){return typeof Blob<"u"&&n instanceof Blob}function ui(n){return typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer}var fp=typeof B.default<"u"&&B.default.versions&&typeof B.default.versions.node<"u"&&typeof B.default.versions.electron>"u";function hp(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength}var Ro=class{constructor(t){this.typedArray=t instanceof ArrayBuffer||ui(t)?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}async getLength(){return this.typedArray.byteLength}async read(t,e){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+t,e)}},Bo=class{constructor(t){this.blob=t}async getLength(){return this.blob.size}async read(t,e){let r=this.blob.slice(t,t+e),i=await lf(r);return new Uint8Array(i)}async sliceAsBlob(t,e,r=""){return this.blob.slice(t,t+e,r)}};function dp(n,t){var e=Uint8Array;if(n[0]==3&&n[1]==0)return t||new e(0);var r=pp,i=hf,o=gp,a=df,s=t==null;s&&(t=new e(n.length>>>2<<3));for(var c=0,l=0,p=0,y=0,I=0,f=0,v=0,L=0,U=0,$,V;c==0;){if(c=r(n,U,1),l=r(n,U+1,2),U+=3,l==0){U&7&&(U+=8-(U&7));var G=(U>>>3)+4,H=n[G-4]|n[G-3]<<8;s&&(t=$s(t,L+H)),t.set(new e(n.buffer,n.byteOffset+G,H),L),U=G+H<<3,L+=H;continue}if(s&&(t=$s(t,L+(1<<17))),l==1&&($=et.flmap,V=et.fdmap,f=(1<<9)-1,v=(1<<5)-1),l==2){p=i(n,U,5)+257,y=i(n,U+5,5)+1,I=i(n,U+10,4)+4,U+=14;for(var R=0;R<38;R+=2)et.itree[R]=0,et.itree[R+1]=0;for(var M=1,R=0;R<I;R++){var tt=i(n,U+R*3,3);et.itree[(et.ordr[R]<<1)+1]=tt,tt>M&&(M=tt)}U+=3*I,ai(et.itree,M),si(et.itree,M,et.imap),$=et.lmap,V=et.dmap,U=o(et.imap,(1<<M)-1,p+y,n,U,et.ttree);var z=of(et.ttree,0,p,et.ltree);f=(1<<z)-1;var x=of(et.ttree,p,y,et.dtree);v=(1<<x)-1,ai(et.ltree,z),si(et.ltree,z,$),ai(et.dtree,x),si(et.dtree,x,V)}for(;;){var it=$[a(n,U)&f];U+=it&15;var Q=it>>>4;if(!(Q>>>8))t[L++]=Q;else{if(Q==256)break;var Y=L+Q-254;if(Q>264){var ut=et.ldef[Q-257];Y=L+(ut>>>3)+i(n,U,ut&7),U+=ut&7}var dt=V[a(n,U)&v];U+=dt&15;var bt=dt>>>4,mt=et.ddef[bt],q=(mt>>>4)+r(n,U,mt&15);for(U+=mt&15,s&&(t=$s(t,L+(1<<17)));L<Y;)t[L]=t[L++-q],t[L]=t[L++-q],t[L]=t[L++-q],t[L]=t[L++-q];L=Y}}}return t.length==L?t:t.slice(0,L)}function $s(n,t){var e=n.length;if(t<=e)return n;var r=new Uint8Array(Math.max(e<<1,t));return r.set(n,0),r}function gp(n,t,e,r,i,o){for(var a=hf,s=df,c=0;c<e;){var l=n[s(r,i)&t];i+=l&15;var p=l>>>4;if(p<=15)o[c]=p,c++;else{var y=0,I=0;p==16?(I=3+a(r,i,2),i+=2,y=o[c-1]):p==17?(I=3+a(r,i,3),i+=3):p==18&&(I=11+a(r,i,7),i+=7);for(var f=c+I;c<f;)o[c]=y,c++}}return i}function of(n,t,e,r){for(var i=0,o=0,a=r.length>>>1;o<e;){var s=n[o+t];r[o<<1]=0,r[(o<<1)+1]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[(o<<1)+1]=0,o++;return i}function ai(n,t){for(var e=n.length,r,i,o,a,s,c=et.bl_count,a=0;a<=t;a++)c[a]=0;for(a=1;a<e;a+=2)c[n[a]]++;var l=et.next_code;for(r=0,c[0]=0,i=1;i<=t;i++)r=r+c[i-1]<<1,l[i]=r;for(o=0;o<e;o+=2)s=n[o+1],s!=0&&(n[o]=l[s],l[s]++)}function si(n,t,e){for(var r=n.length,i=et.rev15,o=0;o<r;o+=2)if(n[o+1]!=0)for(var a=o>>1,s=n[o+1],c=a<<4|s,l=t-s,p=n[o]<<l,y=p+(1<<l);p!=y;){var I=i[p]>>>15-t;e[I]=c,p++}}function af(n,t){for(var e=et.rev15,r=15-t,i=0;i<n.length;i+=2){var o=n[i]<<t-n[i+1];n[i]=e[o]>>>r}}function hf(n,t,e){return(n[t>>>3]|n[(t>>>3)+1]<<8)>>>(t&7)&(1<<e)-1}function pp(n,t,e){return(n[t>>>3]|n[(t>>>3)+1]<<8|n[(t>>>3)+2]<<16)>>>(t&7)&(1<<e)-1}function df(n,t){return(n[t>>>3]|n[(t>>>3)+1]<<8|n[(t>>>3)+2]<<16)>>>(t&7)}var et=function(){var n=Uint16Array,t=Uint32Array;return{next_code:new n(16),bl_count:new n(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new n(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new n(512),fltree:[],fdmap:new n(32),fdtree:[],lmap:new n(32768),ltree:[],ttree:[],dmap:new n(32768),dtree:[],imap:new n(512),itree:[],rev15:new n(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new n(1<<16),prev:new n(1<<15)}}();(function(){for(var n=32768,t=0;t<n;t++){var e=t;e=(e&2863311530)>>>1|(e&1431655765)<<1,e=(e&3435973836)>>>2|(e&858993459)<<2,e=(e&4042322160)>>>4|(e&252645135)<<4,e=(e&4278255360)>>>8|(e&16711935)<<8,et.rev15[t]=(e>>>16|e<<16)>>>17}function r(i,o,a){for(;o--!=0;)i.push(0,a)}for(var t=0;t<32;t++)et.ldef[t]=et.of0[t]<<3|et.exb[t],et.ddef[t]=et.df0[t]<<4|et.dxb[t];r(et.fltree,144,8),r(et.fltree,255-143,9),r(et.fltree,279-255,7),r(et.fltree,287-279,8),ai(et.fltree,9),si(et.fltree,9,et.flmap),af(et.fltree,9),r(et.fdtree,32,5),ai(et.fdtree,5),si(et.fdtree,5,et.fdmap),af(et.fdtree,5),r(et.itree,19,0),r(et.ltree,286,0),r(et.dtree,30,0),r(et.ttree,320,0)})();var sf={table:function(){for(var n=new Uint32Array(256),t=0;t<256;t++){for(var e=t,r=0;r<8;r++)e&1?e=3988292384^e>>>1:e=e>>>1;n[t]=e}return n}(),update:function(n,t,e,r){for(var i=0;i<r;i++)n=sf.table[(n^t[e+i])&255]^n>>>8;return n},crc:function(n,t,e){return sf.update(4294967295,n,t,e)^4294967295}};function mp(n,t){return dp(n,t)}var li={numWorkers:1,workerURL:"",useWorkers:!1},yp=0,cf=0,Gs=!0,wp=[],Oo=[],en=[],qs=new Map;function vp(n){gf(n.target);let{id:t,error:e,data:r}=n.data,i=qs.get(t);qs.delete(t),e?i.reject(e):i.resolve(r)}function Ks(n){return new Promise((t,e)=>{let r=new Worker(n);r.onmessage=i=>{i.data==="start"?(r.onerror=void 0,r.onmessage=void 0,t(r)):e(new Error(`unexpected message: ${i.data}`))},r.onerror=e})}function _p(n,t){return n.require(t)}var uf=function(){if(fp){let{Worker:n}=_p(module,"worker_threads");return{async createWorker(t){return new n(t)},addEventListener(t,e){t.on("message",r=>{e({target:t,data:r})})},async terminate(t){await t.terminate()}}}else return{async createWorker(n){try{return await Ks(n)}catch{console.warn("could not load worker:",n)}let t;try{let e=await fetch(n,{mode:"cors"});if(!e.ok)throw new Error(`could not load: ${n}`);t=await e.text(),n=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));let r=await Ks(n);return li.workerURL=n,r}catch{console.warn("could not load worker via fetch:",n)}if(t!==void 0)try{n=`data:application/javascript;base64,${btoa(t)}`;let e=await Ks(n);return li.workerURL=n,e}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(n,t){n.addEventListener("message",t)},async terminate(n){n.terminate()}}}();function gf(n){Oo.push(n),pf()}async function bp(){if(Oo.length===0&&cf<li.numWorkers){++cf;try{let n=await uf.createWorker(li.workerURL);wp.push(n),Oo.push(n),uf.addEventListener(n,vp)}catch{Gs=!1}}return Oo.pop()}function Sp(n,t,e,r){let i=new Uint8Array(t);mp(n,i),r(e?new Blob([i],{type:e}):i.buffer)}async function pf(){if(en.length!==0){if(li.useWorkers&&Gs){let n=await bp();if(Gs){if(n){if(en.length===0){gf(n);return}let{id:t,src:e,uncompressedSize:r,type:i,resolve:o,reject:a}=en.shift();qs.set(t,{id:t,resolve:o,reject:a});let s=[];n.postMessage({type:"inflate",data:{id:t,type:i,src:e,uncompressedSize:r}},s)}return}}for(;en.length;){let{src:n,uncompressedSize:t,type:e,resolve:r}=en.shift(),i=n;ff(n)&&(i=await lp(n)),Sp(i,t,e,r)}}}function mf(n,t,e){return new Promise((r,i)=>{en.push({src:n,uncompressedSize:t,type:e,resolve:r,reject:i,id:yp++}),pf()})}function Ep(n,t){let e=n&31,r=(n>>5&15)-1,i=(n>>9&127)+1980,o=0,a=(t&31)*2,s=t>>5&63,c=t>>11&31;return new Date(i,r,e,c,s,a,o)}var js=class{constructor(t,e){this._reader=t,this._rawEntry=e,this.name=e.name,this.nameBytes=e.nameBytes,this.size=e.uncompressedSize,this.compressedSize=e.compressedSize,this.comment=e.comment,this.commentBytes=e.commentBytes,this.compressionMethod=e.compressionMethod,this.lastModDate=Ep(e.lastModFileDate,e.lastModFileTime),this.isDirectory=e.uncompressedSize===0&&e.name.endsWith("/"),this.encrypted=!!(e.generalPurposeBitFlag&1),this.externalFileAttributes=e.externalFileAttributes,this.versionMadeBy=e.versionMadeBy}async blob(t="application/octet-stream"){return await Pp(this._reader,this._rawEntry,t)}async arrayBuffer(){return await Bp(this._reader,this._rawEntry)}async text(){let t=await this.arrayBuffer();return ci(new Uint8Array(t))}async json(){let t=await this.text();return JSON.parse(t)}},Vs=22,Tp=65535,xp=101010256,Cp=101075792;async function rn(n,t,e){return await n.read(t,e)}async function Hs(n,t,e,r){return n.sliceAsBlob?await n.sliceAsBlob(t,e,r):await n.read(t,e)}var Ip={unsigned(){return 0}};function Lt(n,t){return n[t]+n[t+1]*256}function Ft(n,t){return n[t]+n[t+1]*256+n[t+2]*65536+n[t+3]*16777216}function kr(n,t){return Ft(n,t)+Ft(n,t+4)*4294967296}var kp=new TextDecoder;function ci(n,t){return ui(n.buffer)&&(n=new Uint8Array(n)),kp.decode(n)}async function Ap(n,t){let e=Math.min(Vs+Tp,t),r=t-e,i=await rn(n,r,e);for(let o=e-Vs;o>=0;--o){if(Ft(i,o)!==xp)continue;let a=new Uint8Array(i.buffer,i.byteOffset+o,i.byteLength-o),s=Lt(a,4);if(s!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);let c=Lt(a,10),l=Ft(a,12),p=Ft(a,16),y=Lt(a,20),I=a.length-Vs;if(y!==I)throw new Error(`invalid comment length. expected: ${I}, actual: ${y}`);let f=new Uint8Array(a.buffer,a.byteOffset+22,y),v=ci(f);return c===65535||p===4294967295?await Op(n,r+o,v,f):await yf(n,p,l,c,v,f)}throw new Error("could not find end of central directory. maybe not zip file")}var Lp=117853008;async function Op(n,t,e,r){let i=t-20,o=await rn(n,i,20);if(Ft(o,0)!==Lp)throw new Error("invalid zip64 end of central directory locator signature");let a=kr(o,8),s=await rn(n,a,56);if(Ft(s,0)!==Cp)throw new Error("invalid zip64 end of central directory record signature");let c=kr(s,32),l=kr(s,40),p=kr(s,48);return yf(n,p,l,c,e,r)}var Rp=33639248;async function yf(n,t,e,r,i,o){let a=0,s=await rn(n,t,e),c=[];for(let p=0;p<r;++p){let y=s.subarray(a,a+46),I=Ft(y,0);if(I!==Rp)throw new Error(`invalid central directory file header signature: 0x${I.toString(16)}`);let f={versionMadeBy:Lt(y,4),versionNeededToExtract:Lt(y,6),generalPurposeBitFlag:Lt(y,8),compressionMethod:Lt(y,10),lastModFileTime:Lt(y,12),lastModFileDate:Lt(y,14),crc32:Ft(y,16),compressedSize:Ft(y,20),uncompressedSize:Ft(y,24),fileNameLength:Lt(y,28),extraFieldLength:Lt(y,30),fileCommentLength:Lt(y,32),internalFileAttributes:Lt(y,36),externalFileAttributes:Ft(y,38),relativeOffsetOfLocalHeader:Ft(y,42)};if(f.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");a+=46;let v=s.subarray(a,a+f.fileNameLength+f.extraFieldLength+f.fileCommentLength);f.nameBytes=v.slice(0,f.fileNameLength),f.name=ci(f.nameBytes);let L=f.fileNameLength+f.extraFieldLength,U=v.slice(f.fileNameLength,L);f.extraFields=[];let $=0;for(;$<U.length-3;){let G=Lt(U,$+0),H=Lt(U,$+2),R=$+4,M=R+H;if(M>U.length)throw new Error("extra field length exceeds extra field buffer size");f.extraFields.push({id:G,data:U.slice(R,M)}),$=M}if(f.commentBytes=v.slice(L,L+f.fileCommentLength),f.comment=ci(f.commentBytes),a+=v.length,f.uncompressedSize===4294967295||f.compressedSize===4294967295||f.relativeOffsetOfLocalHeader===4294967295){let G=f.extraFields.find(M=>M.id===1);if(!G)throw new Error("expected zip64 extended information extra field");let H=G.data,R=0;if(f.uncompressedSize===4294967295){if(R+8>H.length)throw new Error("zip64 extended information extra field does not include uncompressed size");f.uncompressedSize=kr(H,R),R+=8}if(f.compressedSize===4294967295){if(R+8>H.length)throw new Error("zip64 extended information extra field does not include compressed size");f.compressedSize=kr(H,R),R+=8}if(f.relativeOffsetOfLocalHeader===4294967295){if(R+8>H.length)throw new Error("zip64 extended information extra field does not include relative header offset");f.relativeOffsetOfLocalHeader=kr(H,R),R+=8}}let V=f.extraFields.find(G=>G.id===28789&&G.data.length>=6&&G.data[0]===1&&Ft(G.data,1),Ip.unsigned(f.nameBytes));if(V&&(f.fileName=ci(V.data.slice(5))),f.compressionMethod===0){let G=f.uncompressedSize;if(f.generalPurposeBitFlag&1&&(G+=12),f.compressedSize!==G)throw new Error(`compressed size mismatch for stored file: ${f.compressedSize} != ${G}`)}c.push(f)}return{zip:{comment:i,commentBytes:o},entries:c.map(p=>new js(n,p))}}async function wf(n,t){if(t.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");let e=await rn(n,t.relativeOffsetOfLocalHeader,30),r=await n.getLength(),i=Ft(e,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);let o=Lt(e,26),a=Lt(e,28),s=t.relativeOffsetOfLocalHeader+e.length+o+a,c;if(t.compressionMethod===0)c=!1;else if(t.compressionMethod===8)c=!0;else throw new Error(`unsupported compression method: ${t.compressionMethod}`);let l=s,p=l+t.compressedSize;if(t.compressedSize!==0&&p>r)throw new Error(`file data overflows file bounds: ${l} +  ${t.compressedSize}  > ${r}`);return{decompress:c,fileDataStart:l}}async function Bp(n,t){let{decompress:e,fileDataStart:r}=await wf(n,t);if(!e){let a=await rn(n,r,t.compressedSize);return hp(a)?a.buffer:a.slice().buffer}let i=await Hs(n,r,t.compressedSize);return await mf(i,t.uncompressedSize)}async function Pp(n,t,e){let{decompress:r,fileDataStart:i}=await wf(n,t);if(!r){let s=await Hs(n,i,t.compressedSize,e);return ff(s)?s:new Blob([ui(s.buffer)?new Uint8Array(s):s],{type:e})}let o=await Hs(n,i,t.compressedSize);return await mf(o,t.uncompressedSize,e)}async function Np(n){let t;if(typeof Blob<"u"&&n instanceof Blob)t=new Bo(n);else if(n instanceof ArrayBuffer||n&&n.buffer&&n.buffer instanceof ArrayBuffer)t=new Ro(n);else if(ui(n)||ui(n.buffer))t=new Ro(n);else if(typeof n=="string"){let r=await fetch(n);if(!r.ok)throw new Error(`failed http request ${n}, status: ${r.status}: ${r.statusText}`);let i=await r.blob();t=new Bo(i)}else if(typeof n.getLength=="function"&&typeof n.read=="function")t=n;else throw new Error("unsupported source type");let e=await t.getLength();if(e>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${e}. Only file sizes up 4503599627370496 bytes are supported`);return await Ap(t,e)}async function vf(n){let{zip:t,entries:e}=await Np(n);return{zip:t,entries:Object.fromEntries(e.map(r=>[r.name,r]))}}var _f=Ot(rr());var Me=class{constructor(t){this.src=t;this.splitted=this.splitBuffer(t),this.logger.debug(`Buffer splitted into ${this.splitted.length} parts`)}logger=rt.INST.create("WasmSrc");splitted;wasmBinary(){return this.splitted[0]}async sourceCode(){let{entries:t}=await vf(this.splitted[1]),e=new Map;for(let[r,i]of Object.entries(t)){if(i.isDirectory)continue;let o=await i.text();e.set(r,o)}return e}additionalCode(){return this.splitted.length==2?null:this.splitted[2].toString()}splitBuffer(t){let e="",r=parseInt(t.toString("utf8",0,1));this.logger.debug(`Number of elements: ${r}`);let i=t.length,o=0,a=0;for(let l=2;l<i;l++){let p=t.toString("utf8",l,l+1);if(p=="|"&&o++,o==r){a=l+1;break}e+=p}this.logger.debug("Parsed:",{header:e,dataStart:a});let s=e.split("|").map(l=>parseInt(l));this.logger.debug("Lengths",s);let c=[];for(let l of s){let p=_f.Buffer.alloc(l),y=a+l;t.copy(p,0,a,y),a=y,c.push(p)}return c}};var Ar=class{constructor(t,e){this.arweave=t;this.env=e;this.tagsParser=new At}logger=rt.INST.create("ContractDefinitionLoader");arweaveWrapper;tagsParser;async load(t,e){let r=ft.measure(),i=await this.doLoad(t,e);return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),i}async doLoad(t,e){let r=ft.measure(),i=await this.arweaveWrapper.tx(t),o=await this.arweave.wallets.ownerToAddress(i.owner);this.logger.debug("Contract tx and owner",r.elapsed()),r.reset();let a=e||this.tagsParser.getTag(i,pt.CONTRACT_SRC_TX_ID),s=this.tagsParser.getTag(i,nt.WARP_TESTNET)||null;if(s&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!s&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.");let c=this.tagsParser.getTag(i,pt.MIN_FEE),l=null,p=this.tagsParser.getTag(i,nt.MANIFEST);p&&(l=JSON.parse(p)),this.logger.debug("Tags decoding",r.elapsed()),r.reset();let y=await this.evalInitialState(i);this.logger.debug("init state",y);let I=JSON.parse(y);this.logger.debug("Parsing src and init state",r.elapsed());let{src:f,srcBinary:v,srcWasmLang:L,contractType:U,metadata:$,srcTx:V}=await this.loadContractSource(a);return{txId:t,srcTxId:a,src:f,srcBinary:v,srcWasmLang:L,initState:I,minFee:c,owner:o,contractType:U,metadata:$,manifest:l,contractTx:i.toJSON(),srcTx:V,testnet:s}}async loadContractSource(t){let e=ft.measure(),r=await this.arweaveWrapper.tx(t),i=this.tagsParser.getTag(r,pt.CONTENT_TYPE);if(!jn.includes(i))throw new Error(`Contract source content type ${i} not supported`);let o=i=="application/javascript"?"js":"wasm",a=o=="js"?await this.arweaveWrapper.txDataString(t):await this.arweaveWrapper.txData(t),s,c,l;if(o=="wasm"){if(c=new Me(a),s=this.tagsParser.getTag(r,nt.WASM_LANG),!s)throw new Error(`Wasm lang not set for wasm contract src ${t}`);l=JSON.parse(this.tagsParser.getTag(r,nt.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:o=="js"?a:null,srcBinary:o=="wasm"?c.wasmBinary():null,srcWasmLang:s,contractType:o,metadata:l,srcTx:r.toJSON()}}async evalInitialState(t){if(this.tagsParser.getTag(t,nt.INIT_STATE))return this.tagsParser.getTag(t,nt.INIT_STATE);if(this.tagsParser.getTag(t,nt.INIT_STATE_TX)){let e=this.tagsParser.getTag(t,nt.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}else return this.arweaveWrapper.txDataString(t.id)}type(){return"arweave"}setCache(t){throw new Error("No cache implemented for this loader")}setSrcCache(t){throw new Error("No cache implemented for this loader")}getCache(){throw new Error("No cache implemented for this loader")}getSrcCache(){throw new Error("No cache implemented for this loader")}set warp(t){this.arweaveWrapper=new Ut(t)}};m();var Po=Ot(rr());var fi=class{constructor(t,e,r,i){this.definitionCache=e;this.srcCache=r;this.env=i;this.contractDefinitionLoader=new Ar(t,i),this.tagsParser=new At}rLogger=rt.INST.create("WarpGatewayContractDefinitionLoader");contractDefinitionLoader;arweaveWrapper;tagsParser;_warp;async load(t,e){let r=await this.getFromCache(t,e);if(r)return this.rLogger.debug("WarpGatewayContractDefinitionLoader: Hit from cache!"),r.contractType=="wasm"&&r.srcBinary.data&&(r.srcBinary=Po.Buffer.from(r.srcBinary.data)),this.verifyEnv(r),r;let i=ft.measure(),o=await this.doLoad(t,e);return this.rLogger.info(`Contract definition loaded in: ${i.elapsed()}`),this.verifyEnv(o),await this.putToCache(t,o,e),o}async doLoad(t,e){try{let r=xe(this._warp.gwUrl()),i=await Ce(fetch(`${r}/gateway/contract?txId=${t}${e?`&srcTxId=${e}`:""}`));if(i.srcBinary!=null&&!(i.srcBinary instanceof Po.Buffer)&&(i.srcBinary=Po.Buffer.from(i.srcBinary.data)),i.srcBinary){let o=new Me(i.srcBinary);i.srcBinary=o.wasmBinary();let a;i.srcTx?a=new Ir({...i.srcTx}):a=await this.arweaveWrapper.tx(i.srcTxId);let s=JSON.parse(this.tagsParser.getTag(a,nt.WASM_META));i.metadata=s}return i.contractType=i.src?"js":"wasm",i}catch(r){return this.rLogger.warn("Falling back to default contracts loader",r),await this.contractDefinitionLoader.doLoad(t,e)}}async loadContractSource(t){return await this.contractDefinitionLoader.loadContractSource(t)}type(){return"warp"}setCache(t){this.definitionCache=t}setSrcCache(t){this.srcCache=t}getCache(){return this.definitionCache}getSrcCache(){return this.srcCache}verifyEnv(t){if(t.testnet&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!t.testnet&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.")}async getFromCache(t,e){let r=await this.definitionCache.get(new Rt(t,"cd"));if(!r)return null;let i=await this.srcCache.get(new Rt(e||r.cachedValue.srcTxId,"src"));return i?{...r.cachedValue,...i.cachedValue}:null}async putToCache(t,e,r){let i=new Gn(e),o=new qn(e);await this.definitionCache.put({key:t,sortKey:"cd"},o),await this.srcCache.put({key:r||o.srcTxId,sortKey:"src"},i)}set warp(t){this._warp=t,this.arweaveWrapper=new Ut(t),this.contractDefinitionLoader.warp=t}};m();m();m();function Qs(n){let t="";for(let e of n)t+=("0"+e.toString(16)).slice(-2);return t}var Wp="".padEnd(13,"0"),zs="".padEnd(13,"9"),No="".padEnd(13,"0"),bf="".padEnd(64,"0"),Js="".padEnd(64,"z"),nn=`${"".padStart(12,"0")},${Wp},${bf}`,Up=`${"".padStart(12,"9")},${zs},${Js}`,$e=class{constructor(t){this.arweave=t}logger=rt.INST.create("LexicographicalInteractionsSorter");async sort(t){let e=[...t],r=e.map(i=>this.addSortKey(i));return await Promise.all(r),e.sort((i,o)=>i.node.sortKey.localeCompare(o.node.sortKey))}async createSortKey(t,e,r,i=!1){let o=this.arweave.utils.b64UrlToBuffer(t),a=this.arweave.utils.b64UrlToBuffer(e),s=this.arweave.utils.concatBuffers([o,a]),c=Qs(await this.arweave.crypto.hash(s));return`${`${r}`.padStart(12,"0")},${i?zs:No},${c}`}extractBlockHeight(t){return t?parseInt(t.split(",")[0]):null}async addSortKey(t){let{node:e}=t,r=t.node.sortKey;r?(t.node.sortKey=r,this.logger.debug("Using sortKey from sequencer",t.node.sortKey)):t.node.sortKey=await this.createSortKey(e.block.id,e.id,e.block.height)}generateLastSortKey(t){return`${`${t}`.padStart(12,"0")},${zs},${Js}`}};m();var Sf=`query Transactions($tags: [TagFilter!]!, $blockFilter: BlockFilter!, $first: Int!, $after: String) {
    transactions(tags: $tags, block: $blockFilter, first: $first, sort: HEIGHT_ASC, after: $after) {
      pageInfo {
        hasNextPage
      }
      edges {
        node {
          id
          owner { address }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston }
          quantity { winston }
          parent { id }
          bundledIn { id }
        }
        cursor
      }
    }
  }`,Fp=`query Transaction($id: ID!) {
  transaction(id: $id) {
          id
          owner { address, key }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston, ar }
          quantity { winston, ar }
          bundledIn { id }
    			parent{ id }
          signature
        }
}`,Ef=30*1e3,Dp=100,Ie=class{constructor(t){this.warp=t;this.arweaveWrapper=new Ut(t)}arweaveWrapper;logger=rt.INST.create(Ie.name);async transaction(t){return(await this.fetch(Fp,{id:t})).transaction}async transactions(t){let e=(await this.fetch(Sf,t)).transactions,r=[...e.edges];for(;e.pageInfo.hasNextPage;){let i=e.edges[Dp-1].cursor,o={...t,after:i};e=(await this.fetch(Sf,o)).transactions,r.push(...e.edges)}return r}async fetch(t,e){let r=ft.measure(),i=await this.arweaveWrapper.gql(t,e);for(this.logger.debug("GQL page load:",r.elapsed());i.status===403;)this.logger.warn(`GQL rate limiting, waiting ${Ef}ms before next try.`),await Dn(Ef),i=await this.arweaveWrapper.gql(t,e);if(i.status!==200)throw new Error(`Unable to retrieve transactions. Arweave gateway responded with status ${i.status}.`);if(i.data.errors)throw this.logger.error(i.data.errors),new Error("Error while fetching arweave transactions");return i.data.data}};var Tf=100;function Ys(n){return!n.node.parent?.id&&!n.node.bundledIn?.id}var hi=class{constructor(t,e){this.arweave=t;this.environment=e;this.sorter=new $e(t)}logger=rt.INST.create("ArweaveGatewayInteractionsLoader");sorter;arweaveTransactionQuery;_warp;tagsParser=new At;async load(t,e,r,i){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let o=this.sorter.extractBlockHeight(e),a=this.sorter.extractBlockHeight(r),s={tags:[{name:pt.APP_NAME,values:["SmartWeaveAction"]},{name:pt.CONTRACT_TX_ID,values:[t]}],blockFilter:{min:o,max:a},first:Tf},c=ft.measure(),l=(await this.arweaveTransactionQuery.transactions(s)).filter(Ys);if(c.stop(),i.internalWrites){let f={tags:[{name:nt.INTERACT_WRITE,values:[t]}],blockFilter:{min:o,max:a},first:Tf},v=(await this.arweaveTransactionQuery.transactions(f)).filter(Ys);this.logger.debug("Inner writes interactions length:",v.length),l=l.concat(v)}l=l.filter(f=>f.node.block&&f.node.block.id&&f.node.block.height);let p=await this.sorter.sort(l);e&&r?p=p.filter(f=>f.node.sortKey.localeCompare(e)>0&&f.node.sortKey.localeCompare(r)<=0):e&&!r?p=p.filter(f=>f.node.sortKey.localeCompare(e)>0):!e&&r&&(p=p.filter(f=>f.node.sortKey.localeCompare(r)<=0)),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:p.length,time:c.elapsed()});let y=this.environment==="local"||this.environment==="testnet",I=this._warp.maybeLoadPlugin("vrf");return p.map(f=>{let v=f.node;return y&&this.tagsParser.hasVrfTag(v)&&(I?v.vrf=I.process().generateMockVrf(v.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),v})}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveTransactionQuery=new Ie(t),this._warp=t}};m();var on=class{constructor(t){this.delegate=t}logger=rt.INST.create("CacheableInteractionsLoader");interactionsCache=new Map;async load(t,e,r,i){if(this.logger.debug("Loading interactions for",{contractTxId:t,fromSortKey:e,toSortKey:r}),this.interactionsCache.has(t)){let o=this.interactionsCache.get(t);if(o?.length){let a=o[o.length-1].sortKey;if(a.localeCompare(r)<0){let s=await this.delegate.load(t,a,r,i),c=o.concat(s);return this.interactionsCache.set(t,c),c}}return o}else{let o=await this.delegate.load(t,e,r,i);return o.length&&this.interactionsCache.set(t,o),o}}type(){return this.delegate.type()}clearCache(){this.interactionsCache.clear()}set warp(t){this.delegate.warp=t}};m();var di=class{constructor(t,e=[]){this.arweave=t;this.executionContextModifiers=e}logger=rt.INST.create("DefaultStateEvaluator");tagsParser=new At;async eval(t){return this.doReadState(t.sortedInteractions,new Et(t.contractDefinition.initState,{},{}),t)}async doReadState(t,e,r){let{ignoreExceptions:i,stackTrace:o,internalWrites:a}=r.evaluationOptions,{contract:s,contractDefinition:c,sortedInteractions:l,warp:p}=r,y=e.state,I=null,f=e.validity,v=e.errorMessages;r?.handler.initState(y);let L=r.contract.callDepth();this.logger.debug(`${le(L)}Evaluating state for ${c.txId} [${t.length} non-cached of ${l.length} all]`);let U=null,$=null,V=t.length,G=p.maybeLoadPlugin("evm-signature-verification"),H=p.maybeLoadPlugin("evaluation-progress"),R=p.maybeLoadPlugin("vrf"),M=!1;for(let z=0;z<V&&!M;z++){s.interactionState().setInitial(s.txId(),new Et(y,f,v));let x=t[z],it=ft.measure();if(I=x.sortKey,x.vrf){if(!R)this.logger.warn('Cannot verify vrf for interaction - no "warp-contracts-plugin-vrf" attached!');else if(!R.process().verify(x.vrf,x.sortKey))throw new Error("Vrf verification failed.")}if(G&&this.tagsParser.isEvmSigned(x))try{if(!await G.process(x)){this.logger.warn(`Interaction ${x.id} was not verified, skipping.`);continue}}catch(Y){this.logger.error(Y);continue}if(this.logger.debug(`${le(L)}[${c.txId}][${x.id}][${x.block.height}]: ${t.indexOf(x)+1}/${t.length} [of all:${l.length}]`),this.tagsParser.isInteractWrite(x,c.txId)&&a){let Y=this.tagsParser.getContractTag(x);this.logger.debug(`${le(L)}Internal Write - Loading writing contract`,Y);let ut=s.getCallStack().addInteractionData({interaction:null,interactionTx:x}),dt=p.contract(Y,r.contract,{callingInteraction:x,callType:"read"});this.logger.debug(`${le(L)}Reading state of the calling contract at`,x.sortKey);let bt=null;try{await dt.readState(x.sortKey),bt=s.interactionState().get(s.txId())}catch(mt){if(mt.name=="ContractError"&&mt.subtype=="unsafeClientSkip"){if(this.logger.warn("Skipping unsafe contract in internal write"),v[x.id]=mt,Xs(x)){let q=new Et(y,f,v);$={tx:x,state:q}}}else throw mt}if(bt!==null){y=bt.state,r?.handler.initState(y),f[x.id]=bt.validity[x.id],bt.errorMessages?.[x.id]&&(v[x.id]=bt.errorMessages[x.id]);let mt=new Et(y,f,v);Xs(x)&&($={tx:x,state:mt})}else f[x.id]=!1;ut.update({cacheHit:!1,outputState:o.saveState?y:void 0,executionTime:it.elapsed(!0),valid:f[x.id],errorMessage:U,gasUsed:0})}else{let Y=this.tagsParser.getInputTag(x,r.contractDefinition.txId);if(!Y){this.logger.error(`${le(L)}Skipping tx - Input tag not found for ${x.id}`);continue}let ut=this.parseInput(Y);if(!ut){this.logger.error(`${le(L)}Skipping tx - invalid Input tag - ${x.id}`);continue}let dt={input:ut,caller:x.owner.address,interactionType:"write"},bt={interaction:dt,interactionTx:x},mt=s.getCallStack().addInteractionData(bt),q=await r.handler.handle(r,new Et(y,f,v),bt);if(U=q.errorMessage,q.type!=="ok"&&(v[x.id]=U),this.logResult(q,x,r),this.logger.debug(`${le(L)}Interaction evaluation`,it.elapsed()),mt.update({cacheHit:!1,outputState:o.saveState?y:void 0,executionTime:it.elapsed(!0),valid:f[x.id],errorMessage:U,gasUsed:q.gasUsed}),q.type==="exception"&&i!==!0)throw new Error(`Exception while processing ${JSON.stringify(dt)}:
${q.errorMessage}`);f[x.id]=q.type==="ok",y=q.state;let he=new Et(y,f,v);Xs(x)&&($={tx:x,state:he})}H&&H.process({contractTxId:c.txId,allInteractions:V,currentInteraction:z,lastInteractionProcessingTime:it.elapsed()});try{for(let{modify:Y}of this.executionContextModifiers)r=await Y(y,r)}catch(Y){if(Y.name=="ContractError"&&Y.subtype=="unsafeClientSkip")f[x.id]=!1,v[x.id]=Y.message,M=!0;else throw Y}s.isRoot()?$&&(s.interactionState().update(s.txId(),$.state),f[x.id]?await s.interactionState().commit(x):await s.interactionState().rollback(x)):s.interactionState().update(s.txId(),new Et(y,f,v))}let tt=new Et(y,f,v);return $!==null&&await this.onStateEvaluated($.tx,r,$.state),new Ct(I,tt)}logResult(t,e,r){t.type==="exception"&&this.logger.error(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] threw exception:`,`${t.errorMessage}`),t.type==="error"&&this.logger.warn(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] returned error:`,t.errorMessage)}parseInput(t){try{return JSON.parse(t.value)}catch(e){return this.logger.error(e),null}}};function Xs(n){return n.confirmationStatus===void 0?!0:n.confirmationStatus==="confirmed"}m();var gi=class extends di{constructor(e,r,i=[]){super(e,i);this.cache=r}cLogger=rt.INST.create("CacheableStateEvaluator");async eval(e){let{cachedState:r,contract:i}=e,o=e.sortedInteractions;if(r&&r.sortKey==e.requestedSortKey&&!o?.length)return this.cLogger.info(`Exact cache hit for sortKey ${e?.contractDefinition?.txId}:${r.sortKey}`),e.handler?.initState(r.cachedValue.state),r;let a=e.contractDefinition.txId;if(!a)throw new Error("Contract tx id not set in the execution context");let s=r==null,c=s?e.contractDefinition.initState:r.cachedValue.state,l=s?{}:r.cachedValue.validity,p=s?{}:r.cachedValue.errorMessages;if(s&&(c=await e.handler.maybeCallStateConstructor(e.contractDefinition.initState,e),await i.interactionState().commitKV()),o.length==0)if(this.cLogger.info(`No missing interactions ${a}`),s){e.handler?.initState(c),this.cLogger.debug("Inserting initial state into cache");let y=new Et(c,{},{});return await this.cache.put(new Rt(a,nn),y),new Ct(nn,y)}else return e.handler?.initState(r.cachedValue.state),r;return await this.doReadState(o,new Et(c,l,p||{}),e)}async onStateEvaluated(e,r,i){let o=r.contractDefinition.txId;this.cLogger.debug(`${le(r.contract.callDepth())}onStateEvaluated: cache update for contract ${o} [${e.sortKey}]`),await this.putInCache(o,e,i)}async onStateUpdate(e,r,i,o=!1){(r.evaluationOptions.updateCacheForEachInteraction||o)&&(this.cLogger.debug(`onStateUpdate: cache update for contract ${r.contractDefinition.txId} [${e.sortKey}]`,{contract:r.contractDefinition.txId,state:i.state,sortKey:e.sortKey}),await this.putInCache(r.contractDefinition.txId,e,i))}async latestAvailableState(e,r){if(this.cLogger.debug("Searching for",{contractTxId:e,sortKey:r}),r){let i=await this.cache.getLessOrEqual(e,r);return i&&this.cLogger.debug(`Latest available state at ${e}: ${i.sortKey}`),i}else return await this.cache.getLast(e)}async onInternalWriteStateUpdate(e,r,i){this.cLogger.debug("Internal write state update:",{sortKey:e.sortKey,dry:e.dry,contractTxId:r,state:i.state}),await this.putInCache(r,e,i)}async onContractCall(e,r,i){if(r.sortedInteractions?.length==0)return;let o=r.sortedInteractions.indexOf(e);o<1||await this.putInCache(r.contractDefinition.txId,r.sortedInteractions[o-1],i)}async putInCache(e,r,i){if(r.dry||r.confirmationStatus!==void 0&&r.confirmationStatus!=="confirmed")return;let o=new Et(i.state,i.validity,i.errorMessages||{});this.cLogger.debug("Putting into cache",{contractTxId:e,transaction:r.id,sortKey:r.sortKey,dry:r.dry}),await this.cache.put(new Rt(e,r.sortKey),o)}async syncState(e,r,i,o){let a=new Et(i,o,{});return await this.cache.put(new Rt(e,r),a),new Ct(r,a)}async dumpCache(){return await this.cache.dump()}async internalWriteState(e,r){return await this.cache.get(new Rt(e,r))}async hasContractCached(e){return await this.cache.getLast(e)!=null}async lastCachedSortKey(){return await this.cache.getLastSortKey()}setCache(e){this.cache=e}getCache(){return this.cache}};m();m();var Zs=(n,t,e,r,i)=>{let o=rt.INST.create("WASM:Rust"),a={metering:{usegas:n.useGas},console:{log:function(u){o.debug(`${n.contract.id}: ${u}`)}},Block:{height:function(){return n.block.height},indep_hash:function(){return n.block.indep_hash},timestamp:function(){return n.block.timestamp}},Transaction:{id:function(){return n.transaction.id},owner:function(){return n.transaction.owner},target:function(){return n.transaction.target}},Contract:{id:function(){return n.contract.id},owner:function(){return n.contract.owner}},KV:{get:async function(u){return await n.kv.get(u)},put:async function(u,d){await n.kv.put(u,d)}},SmartWeave:{caller:function(){return n.caller},readContractState:async function(u){return await n.contracts.readContractState(u)},viewContractState:async function(u,d){return await n.contracts.viewContractState(u,d)},write:async function(u,d){return await n.contracts.write(u,d,!1)}},Vrf:{value:function(){return n.vrf.value},randomInt:function(u){return n.vrf.randomInt(u)}}},s=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();let c=null;function l(){return(c===null||c.byteLength===0)&&(c=new Uint8Array(e.exports.memory.buffer)),c}function p(u,d){return s.decode(l().subarray(u,u+d))}let y=new Array(128).fill(void 0);y.push(void 0,null,!0,!1);let I=y.length;function f(u){I===y.length&&y.push(y.length+1);let d=I;if(I=y[d],typeof I!="number")throw new Error("corrupt heap");return y[d]=u,d}function v(u){return y[u]}function L(u){if(typeof u!="boolean")throw new Error("expected a boolean argument")}function U(u){return u==null}function $(u){if(typeof u!="number")throw new Error("expected a number argument")}let V=null;function G(){return(V===null||V.byteLength===0)&&(V=new Float64Array(e.exports.memory.buffer)),V}let H=null;function R(){return(H===null||H.byteLength===0)&&(H=new Int32Array(e.exports.memory.buffer)),H}let M=0,tt=new TextEncoder("utf-8"),z=typeof tt.encodeInto=="function"?function(u,d){return tt.encodeInto(u,d)}:function(u,d){let _=tt.encode(u);return d.set(_),{read:u.length,written:_.length}};function x(u,d,_){if(typeof u!="string")throw new Error("expected a string argument");if(_===void 0){let at=tt.encode(u),se=d(at.length);return l().subarray(se,se+at.length).set(at),M=at.length,se}let F=u.length,j=d(F),X=l(),Z=0;for(;Z<F;Z++){let at=u.charCodeAt(Z);if(at>127)break;X[j+Z]=at}if(Z!==F){Z!==0&&(u=u.slice(Z)),j=_(j,F,F=Z+u.length*3);let at=l().subarray(j+Z,j+F),se=z(u,at);if(se.read!==u.length)throw new Error("failed to pass whole string");Z+=se.written}return M=Z,j}function it(u){u<132||(y[u]=I,I=u)}function Q(u){let d=v(u);return it(u),d}function Y(u){let d=typeof u;if(d=="number"||d=="boolean"||u==null)return`${u}`;if(d=="string")return`"${u}"`;if(d=="symbol"){let j=u.description;return j==null?"Symbol":`Symbol(${j})`}if(d=="function"){let j=u.name;return typeof j=="string"&&j.length>0?`Function(${j})`:"Function"}if(Array.isArray(u)){let j=u.length,X="[";j>0&&(X+=Y(u[0]));for(let Z=1;Z<j;Z++)X+=", "+Y(u[Z]);return X+="]",X}let _=/\[object ([^\]]+)\]/.exec(toString.call(u)),F;if(_.length>1)F=_[1];else return toString.call(u);if(F=="Object")try{return"Object("+JSON.stringify(u)+")"}catch{return"Object"}return u instanceof Error?`${u.name}: ${u.message}
${u.stack}`:F}function ut(u){if(typeof u!="bigint")throw new Error("expected a bigint argument")}let dt=null;function bt(){return(dt===null||dt.byteLength===0)&&(dt=new BigInt64Array(e.exports.memory.buffer)),dt}function mt(u,d,_,F){let j={a:u,b:d,cnt:1,dtor:_},X=(...Z)=>{j.cnt++;let at=j.a;j.a=0;try{return F(at,j.b,...Z)}finally{--j.cnt===0?e.exports.__wbindgen_export_2.get(j.dtor)(at,j.b):j.a=at}};return X.original=j,X}function q(u,d){try{return u.apply(this,d)}catch(_){let F=function(){try{return _ instanceof Error?`${_.message}

Stack:
${_.stack}`:_.toString()}catch{return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",F),_}}function he(u,d,_){$(u),$(d),e.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__(u,d,f(_))}function de(u){let d=e.exports.warpContractWrite(f(u));return Q(d)}function hn(u){var d=e.exports.handle(f(u));return Q(d)}let Vt=128;function cr(u){if(Vt==1)throw new Error("out of js stack");return y[--Vt]=u,Vt}function K(u){try{let F=e.exports.__wbindgen_add_to_stack_pointer(-16);e.exports.initState(F,cr(u));var d=R()[F/4+0],_=R()[F/4+1];let j;return d!==0&&(j=p(d,_).slice(),e.exports.__wbindgen_free(d,_*1)),j}finally{e.exports.__wbindgen_add_to_stack_pointer(16),y[Vt++]=void 0}}function dn(u){try{e.exports.initState(cr(u))}finally{y[Vt++]=void 0}}function Ai(){let u=e.exports.currentState();return Q(u)}function gn(){return e.exports.version()}function Dt(){return e.exports.lang()}function ae(u){let d=e.exports.warpContractView(f(u));return Q(d)}function h(u,d){try{return u.apply(this,d)}catch(_){e.exports.__wbindgen_exn_store(f(_))}}function g(u,d,_,F){$(u),$(d),e.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__(u,d,f(_),f(F))}function w(u){return()=>{throw new Error(`${u} is not defined`)}}let A={__wbindgen_json_parse:function(u,d){let _=JSON.parse(p(u,d));return f(_)},__wbindgen_json_serialize:function(u,d){let _=v(d),F=JSON.stringify(_===void 0?null:_),j=x(F,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),X=M;R()[u/4+1]=X,R()[u/4+0]=j},__wbindgen_error_new:function(u,d){let _=new Error(p(u,d));return f(_)},__wbindgen_is_undefined:function(u){let d=v(u)===void 0;return L(d),d},__wbindgen_in:function(u,d){let _=v(u)in v(d);return L(_),_},__wbindgen_number_get:function(u,d){let _=v(d),F=typeof _=="number"?_:void 0;U(F)||$(F),G()[u/8+1]=U(F)?0:F,R()[u/4+0]=!U(F)},__wbindgen_boolean_get:function(u){let d=v(u),_=typeof d=="boolean"?d?1:0:2;return $(_),_},__wbindgen_is_null:function(u){let d=v(u)===null;return L(d),d},__wbindgen_string_new:function(u,d){let _=p(u,d);return f(_)},__wbindgen_string_get:function(u,d){let _=v(d),F=typeof _=="string"?_:void 0;var j=U(F)?0:x(F,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),X=M;R()[u/4+1]=X,R()[u/4+0]=j},__wbindgen_is_bigint:function(u){let d=typeof v(u)=="bigint";return L(d),d},__wbindgen_is_object:function(u){let d=v(u),_=typeof d=="object"&&d!==null;return L(_),_},__wbindgen_object_clone_ref:function(u){let d=v(u);return f(d)},__wbindgen_jsval_eq:function(u,d){let _=v(u)===v(d);return L(_),_},__wbindgen_bigint_from_i64:function(u){return f(u)},__wbindgen_bigint_from_u64:function(u){let d=BigInt.asUintN(64,u);return f(d)},__wbg_readContractState:function(){return h(function(u,d){let _=a.SmartWeave.readContractState(p(u,d));return f(_)},arguments)},__wbg_viewContractState:function(){return h(function(u,d,_){let F=a.SmartWeave.viewContractState(p(u,d),Q(_));return f(F)},arguments)},__wbg_write:function(){return h(function(u,d,_){let F=a.SmartWeave.write(p(u,d),Q(_));return f(F)},arguments)},__wbg_refreshState:function(u,d){},__wbg_kvGet:function(){return h(function(u,d){let _=a.KV.get(p(u,d));return f(_)},arguments)},__wbg_kvPut:function(){return h(function(u,d,_){let F=a.KV.put(p(u,d),Q(_));return f(F)},arguments)},__wbindgen_object_drop_ref:function(u){Q(u)},__wbg_error:function(){return q(function(u,d){try{a.console.log(p(u,d))}finally{e.exports.__wbindgen_free(u,d)}},arguments)},__wbg_new_abda76e883ba8a5f:function(){return q(function(){let u=new Error;return f(u)},arguments)},__wbg_stack:function(){return q(function(u,d){let _=Error.stackTraceLimit;Error.stackTraceLimit=25;let F=v(d).stack,j=x(F,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),X=M;R()[u/4+1]=X,R()[u/4+0]=j,Error.stackTraceLimit=_},arguments)},__wbg_indephash:function(){return q(function(u){let d=a.Block.indep_hash(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_height:function(){return q(function(){let u=a.Block.height();return $(u),u},arguments)},__wbg_timestamp:function(){return q(function(){let u=a.Block.timestamp();return $(u),u},arguments)},__wbg_contractId:function(){return q(function(u){let d=a.Contract.id(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_contractOwner:function(){return q(function(u){let d=a.Contract.owner(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_id:function(){return q(function(u){let d=a.Transaction.id(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_owner:function(){return q(function(u){let d=a.Transaction.owner(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_target:function(){return q(function(u){let d=a.Transaction.target(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_caller:function(){return q(function(u){let d=a.SmartWeave.caller(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_value_b245bf3240b21a48:function(){return q(function(u){let d=a.Vrf.value(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_value_7d69ddc3f1ad7876:function(){return q(function(u){let d=a.Vrf.value(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_vrfValue:function(){return q(function(u){let d=a.Vrf.value(),_=x(d,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;R()[u/4+1]=F,R()[u/4+0]=_},arguments)},__wbg_randomInt:function(){return q(function(u){let d=a.Vrf.randomInt(u);return $(d),d},arguments)},__wbg_log:function(){return q(function(u,d){a.console.log(p(u,d))},arguments)},__wbindgen_cb_drop:function(u){let d=Q(u).original;if(d.cnt--==1)return d.a=0,!0;let _=!1;return L(_),_},__wbg_debug:function(){return q(function(u){console.log(v(u))},arguments)},__wbg_String:function(){return q(function(u,d){let _=String(v(d)),F=x(_,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),j=M;R()[u/4+1]=j,R()[u/4+0]=F},arguments)},__wbg_getwithrefkey:function(){return q(function(u,d){let _=v(u)[v(d)];return f(_)},arguments)},__wbg_set_841ac57cff3d672b:function(){return q(function(u,d,_){v(u)[Q(d)]=Q(_)},arguments)},__wbindgen_number_new:function(u){return f(u)},__wbindgen_jsval_loose_eq:function(u,d){let _=v(u)==v(d);return L(_),_},__wbg_get_27fe3dac1c4d0224:function(){return q(function(u,d){let _=v(u)[d>>>0];return f(_)},arguments)},__wbg_set_17224bc548dd1d7b:function(){return q(function(u,d,_){v(u)[d>>>0]=Q(_)},arguments)},__wbg_isArray:function(){return q(function(u){let d=Array.isArray(v(u));return L(d),d},arguments)},__wbg_length_e498fbc24f9c1d4f:function(){return q(function(u){let d=v(u).length;return $(d),d},arguments)},__wbg_new_b525de17f44a8943:function(){return q(function(){let u=new Array;return f(u)},arguments)},__wbg_instanceof_ArrayBuffer:function(){return q(function(u){let d;try{d=v(u)instanceof ArrayBuffer}catch{d=!1}let _=d;return L(_),_},arguments)},__wbg_call_95d1ea488d03e4e8:function(){return h(function(u,d){let _=v(u).call(v(d));return f(_)},arguments)},__wbg_call_9495de66fdbe016b:function(){return h(function(u,d,_){let F=v(u).call(v(d),v(_));return f(F)},arguments)},__wbg_call_94697a95cb7e239c:function(){return h(function(u,d,_){let F=v(u).call(v(d),v(_));return f(F)},arguments)},__wbg_new_f841cc6f2098f4b5:function(){return q(function(){return f(new Map)},arguments)},__wbg_set_388c4c6422704173:function(){return q(function(u,d,_){let F=v(u).set(v(d),v(_));return f(F)},arguments)},__wbg_next_88560ec06a094dea:function(){return h(function(u){let d=v(u).next();return f(d)},arguments)},__wbg_next_b7d530c04fd8b217:function(){return q(function(u){let d=v(u).next;return f(d)},arguments)},__wbg_done:function(){return q(function(u){let d=v(u).done;return L(d),d},arguments)},__wbg_value_6ac8da5cc5b3efda:function(){return q(function(u){let d=v(u).value;return f(d)},arguments)},__wbg_isSafeInteger:function(){return q(function(u){let d=Number.isSafeInteger(v(u));return L(d),d},arguments)},__wbg_entries:function(){return q(function(u){let d=Object.entries(v(u));return f(d)},arguments)},__wbg_new_f9876326328f45ed:function(){return q(function(){let u=new Object;return f(u)},arguments)},__wbg_iterator:function(){return q(function(){return f(Symbol.iterator)},arguments)},__wbg_new_9d3a9ce4282a18a8:function(){return q(function(u,d){try{var _={a:u,b:d},F=(X,Z)=>{let at=_.a;_.a=0;try{return g(at,_.b,X,Z)}finally{_.a=at}};let j=new Promise(F);return f(j)}finally{_.a=_.b=0}},arguments)},__wbg_new_4beacc9c71572250:function(){return q(function(u,d){try{var _={a:u,b:d},F=(X,Z)=>{let at=_.a;_.a=0;try{return g(at,_.b,X,Z)}finally{_.a=at}};let j=new Promise(F);return f(j)}finally{_.a=_.b=0}},arguments)},__wbg_resolve:function(){return q(function(u){let d=Promise.resolve(v(u));return f(d)},arguments)},__wbg_then_ec5db6d509eb475f:function(){return q(function(u,d){let _=v(u).then(v(d));return f(_)},arguments)},__wbg_then_a6860c82b90816ca:function(){return q(function(u,d){let _=v(u).then(v(d));return f(_)},arguments)},__wbg_then_f753623316e2873a:function(){return q(function(u,d,_){let F=v(u).then(v(d),v(_));return f(F)},arguments)},__wbg_then_58a04e42527f52c6:function(){return q(function(u,d,_){let F=v(u).then(v(d),v(_));return f(F)},arguments)},__wbg_instanceof_Uint8Array:function(){return q(function(u){let d;try{d=v(u)instanceof Uint8Array}catch{d=!1}let _=d;return L(_),_},arguments)},__wbg_new_537b7341ce90bb31:function(){return q(function(u){let d=new Uint8Array(v(u));return f(d)},arguments)},__wbg_length_27a2afe8ab42b09f:function(){return q(function(u){let d=v(u).length;return $(d),d},arguments)},__wbg_set_17499e8aa4003ebd:function(){return q(function(u,d,_){v(u).set(v(d),_>>>0)},arguments)},__wbindgen_is_function:function(u){let d=typeof v(u)=="function";return L(d),d},__wbindgen_is_string:function(u){let d=typeof v(u)=="string";return L(d),d},__wbg_buffer:function(){return q(function(u){let d=v(u).buffer;return f(d)},arguments)},__wbg_get_baf4855f9a986186:function(){return h(function(u,d){let _=Reflect.get(v(u),v(d));return f(_)},arguments)},__wbindgen_debug_string:function(u,d){let _=Y(v(d)),F=x(_,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),j=M;R()[u/4+1]=j,R()[u/4+0]=F},__wbindgen_bigint_get_as_i64:function(u,d){let _=v(d),F=typeof _=="bigint"?_:void 0;U(F)||ut(F),bt()[u/8+1]=U(F)?BigInt(0):F,R()[u/4+0]=!U(F)},__wbindgen_throw:function(u,d){throw new Error(p(u,d))},__wbindgen_memory:function(){let u=e.exports.memory;return f(u)},__wbindgen_closure_wrapper:function(){return q(function(u,d,_){let F=mt(u,d,r,he);return f(F)},arguments)}},S={_assertBoolean:L,_assertNum:$,addBorrowedObject:cr,addHeapObject:f,getInt32Memory0:R,getObject:v,getStringFromWasm0:p,handleError:h,heap:()=>y,logError:q,notDefined:w,passStringToWasm0:x,takeObject:Q,wasm:()=>e.exports,WASM_VECTOR_LEN:()=>M,__wbg_adapter_4:g,__wbg_adapter_3:he};function T(u){return function(){return q(function(d){let _=u(Q(d));return f(_)},arguments)}}function O(u,d){let _={};for(let[F,j]of Object.entries(u.extensions)){let X=j.rustImports?.(d)??{};for(let[Z,at]of Object.entries(X))Z.startsWith("__wbg_")?_[Z]=at:_["__wbg_"+Z]=T(at)}return _}let b={...A,...O(n,S)},E=Object.keys(b),C=t.reduce((u,d)=>{let _=E.find(F=>d.startsWith(F));if(_===void 0)throw new Error(`Cannot find import mapping for ${d}. Please file a bug.`);if(E.filter(F=>d.startsWith(F)).length!=1)throw new Error(`Multiple import mappings for ${d}. Please file a bug.`);if(u.usedKeys.has(_))throw new Error(`Multiple methods maps to ${_}. Please file a bug.`);return u.res[d]=b[_],u.usedKeys.add(_),u},{res:{},usedKeys:new Set}).res;i==="__WARP_CONTRACTS_VERSION_LEGACY"?(C.initStateLegacy=dn,C.handle=hn):(C.initState=K,C.warpContractWrite=de,C.warpContractView=ae),C.currentState=Ai,C.version=gn,C.lang=Dt;let k={};k.__wbindgen_placeholder__=C;class D{__destroy_into_raw(){let d=this.ptr;return this.ptr=0,d}free(){let d=this.__destroy_into_raw();e.exports.__wbg_statewrapper_free(d)}}return C.StateWrapper=D,k.metering=a.metering,{imports:k,exports:C}};m();var pi=class{gasUsed;gasLimit;transaction;block;vrf;evaluationOptions;arweave;contract;unsafeClient;contracts;extensions;_activeTx;caller;kv;constructor(t,e,r,i,o){this.gasUsed=0,this.gasLimit=Number.MAX_SAFE_INTEGER,this.unsafeClient=t,this.arweave={ar:t.ar,utils:t.utils,wallets:t.wallets,crypto:t.crypto},this.evaluationOptions=r,this.contract=e,this.transaction=new an(this),this.block=new sn(this),this.contracts={readContractState:(a,s,c)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},viewContractState:(a,s)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},write:(a,s,c)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},refreshState:()=>{throw new Error("Not implemented - should be set by HandlerApi implementor")}},this.vrf=new cn(this),this.useGas=this.useGas.bind(this),this.getBalance=this.getBalance.bind(this),this.extensions={},this.kv=new Wo(o,i,this.transaction,this.contract.id)}useGas(t){if(t<0)throw new Error("[RE:GNE] Gas number exception - gas < 0.");if(this.gasUsed+=t,this.gasUsed>this.gasLimit)throw new Error(`[RE:OOG] Out of gas! Used: ${this.gasUsed}, limit: ${this.gasLimit}`)}async getBalance(t,e){if(!this._activeTx)throw new Error("Cannot read balance - active tx is not set.");if(!this.block.height)throw new Error("Cannot read balance - block height not set.");let r=e||this.block.height;return await fetch(`${this.evaluationOptions.walletBalanceUrl}block/height/${r}/wallet/${t}/balance`).then(i=>i.ok?i.text():Promise.reject(i)).catch(i=>{throw new Error(`Unable to read wallet balance. ${i.status}. ${i.body?.message}`)})}},an=class{constructor(t){this.smartWeaveGlobal=t}get id(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.id}get owner(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.owner.address}get target(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.recipient}get tags(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.tags}get sortKey(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.sortKey}get dryRun(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.dry===!0}get quantity(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.quantity.winston}get reward(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.fee.winston}get origin(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.source==="redstone-sequencer"?"L2":"L1"}},sn=class{constructor(t){this.smartWeaveGlobal=t}get height(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.height}get indep_hash(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.id}get timestamp(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current tx");return this.smartWeaveGlobal._activeTx.block.timestamp}},cn=class{constructor(t){this.smartWeaveGlobal=t}get data(){return this.smartWeaveGlobal._activeTx.vrf}get value(){return this.smartWeaveGlobal._activeTx.vrf.bigint}randomInt(t){if(!Number.isInteger(t))throw new Error("Integer max value required for random integer generation");let e=BigInt(this.smartWeaveGlobal._activeTx.vrf.bigint)%BigInt(t)+BigInt(1);if(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)throw new Error("Random int cannot be cast to number");return Number(e)}},Wo=class{constructor(t,e,r,i){this._storage=t;this._interactionState=e;this._transaction=r;this._contractTxId=i}async put(t,e){this.checkStorageAvailable(),await this._storage.put(new Rt(t,this._transaction.sortKey),e)}async get(t){this.checkStorageAvailable();let e=this._transaction.sortKey,r=await this._interactionState.getKV(this._contractTxId,new Rt(t,this._transaction.sortKey));return r??((await this._storage.getLessOrEqual(t,this._transaction.sortKey))?.cachedValue||null)}async del(t){this.checkStorageAvailable();let e=this._transaction.sortKey,r=await this._interactionState.delKV(this._contractTxId,new Rt(t,this._transaction.sortKey));if(r!=null)return r;await this._storage.del(new Rt(t,this._transaction.sortKey))}async keys(t){let e=this._transaction.sortKey;return await this._storage.keys(e,t)}async kvMap(t){let e=this._transaction.sortKey;return this._storage.kvMap(e,t)}async begin(){if(this._storage)return this._storage.begin()}async commit(){this._storage&&(this._transaction.dryRun?await this._storage.rollback():await this._storage.commit())}async rollback(){this._storage&&await this._storage.rollback()}open(){if(this._storage)return this._storage.open()}close(){if(this._storage)return this._storage.close()}checkStorageAvailable(){if(!this._storage)throw new Error("KV Storage not available")}};m();m();var Lr=class{constructor(t,e){this.swGlobal=t;this.contractDefinition=e;this.assignReadContractState=this.assignReadContractState.bind(this),this.assignViewContractState=this.assignViewContractState.bind(this),this.assignWrite=this.assignWrite.bind(this),this.assignRefreshState=this.assignRefreshState.bind(this)}logger=rt.INST.create("ContractHandler");async dispose(){}assignWrite(t){this.swGlobal.contracts.write=async(e,r,i)=>{if(!t.evaluationOptions.internalWrites)throw new Error("Internal writes feature switched off. Change EvaluationOptions.internalWrites flag to 'true'");let o=i??t.evaluationOptions.throwOnInternalWriteError,a={from:this.contractDefinition.txId,to:e,input:r};this.logger.debug("swGlobal.write call:",a);let s=t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"write"}),c=await s.applyInput(r,this.swGlobal._activeTx);this.logger.debug("Cache result?:",!this.swGlobal._activeTx.dry);let l=c.type!=="ok"&&o&&(!this.swGlobal._activeTx.dry||this.swGlobal._activeTx.dry&&this.swGlobal._activeTx.strict),p=l?`Internal write auto error for call [${JSON.stringify(a)}]: ${c.errorMessage}`:c.errorMessage,y=p?{...c.originalErrorMessages,[this.swGlobal._activeTx.id]:p}:c.originalErrorMessages;if(s.interactionState().update(s.txId(),{state:c.state,validity:{...c.originalValidity,[this.swGlobal._activeTx.id]:c.type=="ok"},errorMessages:y}),l)throw new ie(c.type==="error"&&c.error?c.error:p);return c}}assignViewContractState(t){this.swGlobal.contracts.viewContractState=async(e,r)=>(this.logger.debug("swGlobal.viewContractState call:",{from:this.contractDefinition.txId,to:e,input:r}),await t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"view"}).viewStateForTx(r,this.swGlobal._activeTx))}assignReadContractState(t,e){this.swGlobal.contracts.readContractState=async(r,i)=>{this.logger.debug("swGlobal.readContractState call:",{from:this.contractDefinition.txId,to:r,sortKey:e.sortKey,transaction:this.swGlobal.transaction.id});let{contract:o,warp:a}=t,c=await a.contract(r,o,{callingInteraction:e,callType:"read"}).readState(e.sortKey);if(c?.cachedValue?.errorMessages){let p=Reflect.ownKeys(c?.cachedValue?.errorMessages);if(p.length){let y=p[p.length-1],I=c?.cachedValue?.errorMessages[y];if(I.startsWith("[SkipUnsafeError]"))throw new ie(I)}}return i?{state:nr(c.cachedValue.state),validity:c.cachedValue.validity,errorMessages:c.cachedValue.errorMessages}:nr(c.cachedValue.state)}}assignRefreshState(t){this.swGlobal.contracts.refreshState=async()=>t.contract.interactionState().get(this.swGlobal.contract.id)?.state}};var tc="__init",mi=(n,t)=>{let e=new Error(t);throw e.name=n,e};var yi=class extends Lr{constructor(e,r,i){super(e,r);this.contractFunction=i}async handle(e,r,i){let{interaction:o,interactionTx:a}=i;return this.setupSwGlobal(i),this.enableInternalWrites(e,a),this.assertNotConstructorCall(o),await this.runContractFunction(e,o,r.state)}initState(e){}async maybeCallStateConstructor(e,r){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor){let i={input:{function:tc,args:e},caller:this.contractDefinition.owner,interactionType:"write"},o={owner:{address:r.caller,key:null},sortKey:nn},a={interaction:i,interactionTx:o};this.setupSwGlobal(a);let s=this.configureSwGlobalForConstructor(),c=await this.runContractFunction(r,i,{});if(s(),c.type!=="ok")throw new Error(`Exception while calling constructor: ${JSON.stringify(i)}:
${c.errorMessage}`);return c.state}else return e}assertNotConstructorCall(e){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor&&e.input.function===tc)throw new Error(`You have enabled {useConstructor: true} option, so you can't call function ${tc}`)}configureSwGlobalForConstructor(){let e=a=>({get:(s,c)=>mi("ConstructorError",`SmartWeave.${a}.${String(c)} is not accessible in constructor context`)});this.swGlobal.contracts.readContractState=()=>mi("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.viewContractState=()=>mi("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.refreshState=()=>mi("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.write=()=>mi("ConstructorError","Internal writes feature is not available in constructor");let r=new sn(this.swGlobal);this.swGlobal.block=new Proxy(this.swGlobal.block,e("block"));let i=new cn(this.swGlobal);this.swGlobal.vrf=new Proxy(this.swGlobal.vrf,e("vrf"));let o=new an(this.swGlobal);return this.swGlobal.transaction=new Proxy(this.swGlobal.vrf,e("transaction")),()=>{this.swGlobal.block=r,this.swGlobal.vrf=i,this.swGlobal.transaction=o}}async runContractFunction(e,r,i){let o=nr(i),{timeoutId:a,timeoutPromise:s}=ss(e.evaluationOptions.maxInteractionEvaluationTimeSeconds);try{await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let c=await Promise.race([s,this.contractFunction(o,r)]);if(c&&(c.state!==void 0||c.result!==void 0))return await this.swGlobal.kv.commit(),{type:"ok",result:c.result,state:c.state||o};throw new Error(`Unexpected result from contract: ${JSON.stringify(c)}`)}catch(c){switch(await this.swGlobal.kv.rollback(),c.name){case"ContractError":return{type:"error",errorMessage:c.message,state:i,result:null};case"ConstructorError":throw Error(`ConstructorError: ${c.message}`);default:return{type:"exception",errorMessage:`${c&&c.stack||c&&c.message||c}`,state:i,result:null}}}finally{a&&clearTimeout(a),await this.swGlobal.kv.close()}}setupSwGlobal({interaction:e,interactionTx:r}){this.swGlobal._activeTx=r,this.swGlobal.caller=e.caller}enableInternalWrites(e,r){this.assignReadContractState(e,r),this.assignViewContractState(e),this.assignWrite(e),this.assignRefreshState(e)}};m();var wi=class extends Lr{constructor(e,r,i){super(e,r);this.wasmExports=i}async handle(e,r,i){try{let{interaction:o,interactionTx:a}=i;this.swGlobal._activeTx=a,this.swGlobal.caller=o.caller,this.swGlobal.gasLimit=e.evaluationOptions.gasLimit,this.swGlobal.gasUsed=0,this.assignReadContractState(e,a),this.assignViewContractState(e),this.assignWrite(e),await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let s=await this.doHandle(o);return i.interaction.interactionType==="view"?await this.swGlobal.kv.rollback():await this.swGlobal.kv.commit(),{type:"ok",result:s,state:this.doGetCurrentState(),gasUsed:this.swGlobal.gasUsed}}catch(o){await this.swGlobal.kv.rollback();let a={errorMessage:o.message,state:r.state,result:null};return o instanceof ie?{...a,error:o.error,type:"error"}:{...a,type:"exception"}}finally{await this.swGlobal.kv.close()}}initState(e){switch(this.contractDefinition.srcWasmLang){case"rust":{if("initStateLegacy"in this.wasmExports){this.wasmExports.initStateLegacy(e);return}let r=this.wasmExports.initState(e);if(r)throw new Error(r);return}default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}async doHandleLegacy(e){let r=await this.wasmExports.handle(e.input);if(!r)return;if(Object.prototype.hasOwnProperty.call(r,"Ok"))return r.Ok;let i,o="";throw typeof r.Err=="string"||r.Err instanceof String?i=r.Err:"kind"in r.Err?(i=r.Err.kind,o="data"in r.Err?" "+r.Err.data:""):(i=Object.keys(r.Err)[0],o=" "+r.Err[i]),i=="RuntimeError"?new Error(`[RE:RE]${o}`):new ie(`[CE:${i}${o}]`)}async doHandle(e){switch(this.contractDefinition.srcWasmLang){case"rust":{if("handle"in this.wasmExports)return await this.doHandleLegacy(e);let r=e.interactionType==="write"?await this.wasmExports.warpContractWrite(e.input):await this.wasmExports.warpContractView(e.input);if(!r)return;if(r.type==="ok")return r.result;throw this.logger.error("Error from rust",r),r.type==="error"?new ie(r.error):new Error(r.errorMessage)}default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}async maybeCallStateConstructor(e,r){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor)throw Error("Constructor is not implemented for wasm");return e}doGetCurrentState(){switch(this.contractDefinition.srcWasmLang){case"rust":return this.wasmExports.currentState();default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}};m();function Uo(n,t){let e=n.trim().split(`
`),r=e[0],i=e[e.length-1];return(/\(\s*\(\)\s*=>\s*{/g.test(r)||/\s*\(\s*function\s*\(\)\s*{/g.test(r))&&/}\s*\)\s*\(\)\s*;/g.test(i)&&(e.shift(),e.pop(),n=e.join(`
`)),n=n.replace(/export\s+async\s+function\s+handle/gmu,"async function handle").replace(/export\s+function\s+handle/gmu,"function handle"),t?`
    ${n}
    module.exports = handle;`:`
    const window=void 0,document=void 0,Function=void 0,eval=void 0,globalThis=void 0;
    const [SmartWeave, BigNumber, logger${$n()?", Buffer, atob, btoa":""}] = arguments;
    class ContractError extends Error { constructor(message) { super(message); this.name = 'ContractError' } };
    function ContractAssert(cond, message) { if (!cond) throw new ContractError(message) };
    ${n};
    return handle;
  `}function Mp(n,t){try{let e=Uo(n,!1);return new Function(e)(),!0}catch(e){return t?.error(e),!1}}var Cf=Ot(rr()),xf=us(),ie=class extends Error{constructor(e,r){super(e.toString());this.error=e;this.subtype=r;this.name="ContractError"}},vi=class{constructor(t){this.arweave=t}logger=rt.INST.create("HandlerExecutorFactory");async create(t,e,r,i){if(r.hasPlugin("contract-blacklist")){let c=r.loadPlugin("contract-blacklist"),l=!1;try{l=await c.process(t.txId)}catch(p){this.logger.error(p)}if(l==!0)throw new ie(`[SkipUnsafeError] Skipping evaluation of the blacklisted contract ${t.txId}.`,"blacklistedSkip")}let o=null;e.useKVStorage&&(o=r.kvStorageFactory(t.txId));let a=new pi(this.arweave,{id:t.txId,owner:t.owner},e,i,o);if(r.matchPlugins("^smartweave-extension-").forEach(c=>{r.loadPlugin(c).process(a.extensions)}),t.contractType=="wasm"){this.logger.info("Creating handler for wasm contract",t.txId);let c=ft.measure(),l,p=null,y=$p(t.srcBinary);switch(t.srcWasmLang){case"rust":{let I={exports:null,modifiedExports:{wasm_bindgen__convert__closures__invoke2_mut__:null,_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__:null}},f=await Kp(y,t.srcBinary),v=WebAssembly.Module.exports(f).filter(G=>G.kind==="global"&&G.name.startsWith("__WARP_CONTRACTS_VERSION_")).map(G=>G.name).shift()||"__WARP_CONTRACTS_VERSION_LEGACY",L=WebAssembly.Module.imports(f).filter(G=>G.module==="__wbindgen_placeholder__").map(G=>G.name),{imports:U,exports:$}=Zs(a,L,I,t.metadata.dtor,v);p=$,l=await WebAssembly.instantiate(f,U),I.exports=l.exports,Object.keys(l.exports).forEach(G=>{G.startsWith("wasm_bindgen__convert__closures__invoke2_mut__")&&(I.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__=l.exports[G]),G.startsWith("_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__")&&(I.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__=l.exports[G])});break}default:throw new Error(`Support for ${t.srcWasmLang} not implemented yet.`)}return this.logger.info(`WASM ${t.srcWasmLang} handler created in ${c.elapsed()}`),new wi(a,t,p||l.exports)}else{let c=Uo(t.src,r.hasPlugin("vm2"));if(c.includes("unsafeClient"))switch(e.unsafeClient){case"allow":{this.logger.warn(`Reading unsafe contract ${t.txId}, evaluation is non-deterministic!`);break}case"throw":throw new Error(`[SkipUnsafeError] Using unsafeClient is not allowed by default. Use EvaluationOptions.unsafeClient flag to evaluate ${t.txId}.`);case"skip":throw new ie(`[SkipUnsafeError] Skipping evaluation of the unsafe contract ${t.txId}.`,"unsafeClientSkip");default:throw new Error(`Unknown unsafeClient setting ${e.unsafeClient}`)}if(!e.allowBigInt&&c.includes("BigInt"))throw new Error("Using BigInt is not allowed by default. Use EvaluationOptions.allowBigInt flag.");if(r.hasPlugin("vm2"))return r.loadPlugin("vm2").process({normalizedSource:c,swGlobal:a,logger:this.logger,contractDefinition:t});if(r.hasPlugin("ivm-handler-api"))return r.loadPlugin("ivm-handler-api").process({contractSource:t.src,evaluationOptions:e,arweave:this.arweave,swGlobal:a,contractDefinition:t});{let l=new Function(c),p=$n()?l(a,xf,rt.INST.create(a.contract.id),Cf.Buffer,atob,btoa):l(a,xf,rt.INST.create(a.contract.id));return new yi(a,t,p)}}}};function $p(n){let t={status:200,statusText:"OK",headers:{"Content-Type":"application/wasm"}};return new Response(n,t)}async function Kp(n,t){return WebAssembly.compileStreaming?await WebAssembly.compileStreaming(n):await WebAssembly.compile(t)}m();var If=Ot(rr()),Or=class{constructor(t,e,r=null){this.contractTxId=t;this.depth=e;this.innerCallType=r;this.id=If.Crypto.randomUUID()}interactions={};id;addInteractionData(t){let{interaction:e,interactionTx:r}=t,i=un.create(new Fo(r.id,r.sortKey,r.block.height,r.block.timestamp,e?.caller,e?.input.function,e?.input,r.dry,{}));return this.interactions[r.id]=i,i}getInteraction(t){return this.interactions[t]}print(){return JSON.stringify(this,null,2)}},un=class{constructor(t){this.interactionInput=t}interactionOutput;static create(t){return new un(t)}update(t){this.interactionOutput=t}},Fo=class{constructor(t,e,r,i,o,a,s,c,l={}){this.txId=t;this.sortKey=e;this.blockHeight=r;this.blockTimestamp=i;this.caller=o;this.functionName=a;this.functionArguments=s;this.dryWrite=c;this.foreignContractCalls=l}},ec=class{constructor(t,e,r,i,o="",a){this.cacheHit=t;this.outputState=e;this.executionTime=r;this.valid=i;this.errorMessage=o;this.gasUsed=a}};m();var qo=Ot(Ao());m();m();var rc=(t=>(t.CONTRACT_NOT_FOUND="CONTRACT_NOT_FOUND",t))(rc||{}),_i=class extends Error{type;otherInfo;constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.otherInfo=e}getType(){return this.type}};function Vp(n){if(!n)return!1;let t=kf(n);return n.evolve!==void 0||t.has("evolve")}var Ke=class{logger=rt.INST.create("Evolve");constructor(){this.modify=this.modify.bind(this)}async modify(t,e){let{definitionLoader:r,executorFactory:i}=e.warp,o=e.contractDefinition.txId,a=Ke.evolvedSrcTxId(t),s=e.contractDefinition.srcTxId;if(a&&s!==a)try{this.logger.info("Evolving to: ",a);let c=await r.load(o,a),l=await i.create(c,e.evaluationOptions,e.warp,e.contract.interactionState());return e.contractDefinition=c,e.handler=l,e.handler.initState(t),this.logger.debug("evolved to:",{evolve:a,newSrcTxId:e.contractDefinition.srcTxId,currentSrcTxId:s,contract:e.contractDefinition.txId}),e}catch(c){throw c.name==="ContractError"&&c.subtype==="unsafeClientSkip"?c:new _i("CONTRACT_NOT_FOUND",{message:`Error while evolving ${o} from ${s} to ${a}: ${c}`,requestedTxId:o})}return e}static evolvedSrcTxId(t){if(!Vp(t))return;let e=kf(t),r=t.evolve||e.get("evolve"),i=t.canEvolve||e.get("canEvolve");if(i==null&&(i=!0),r&&/[a-z0-9_-]{43}/i.test(r)&&i)return r}};function kf(n){let t=new Map;return n.settings&&(Gp(n.settings)?t=new Map(n.settings):qp(n.settings)&&(t=new Map(Object.entries(n.settings)))),t}function Gp(n){return n==null?!1:typeof n[Symbol.iterator]=="function"}function qp(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}m();m();m();var uc=Ot(Bf(),1),M0=uc.default.configure;var Pf=uc.default;m();async function Mo(n,t,e,r,i,o="",a="0",s=!1,c,l){let p={data:Math.random().toString().slice(-4)};o&&o.length&&(p.target=o.toString(),a&&+a>0&&(p.quantity=a.toString())),s&&(p.reward="0",p.last_tx="p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"),l&&l.length&&(p.reward=l);let y=await n.createTransaction(p);if(!r)throw new Error(`Input should be a truthy value: ${JSON.stringify(r)}`);if(i&&i.length)for(let I of i)y.addTag(I.name.toString(),I.value.toString());return y.addTag(pt.APP_NAME,"SmartWeaveAction"),y.addTag(pt.APP_VERSION,"0.3.0"),y.addTag(pt.SDK,"Warp"),y.addTag(pt.CONTRACT_TX_ID,e),y.addTag(pt.INPUT,JSON.stringify(r)),c&&y.addTag(nt.WARP_TESTNET,"1.0.0"),t&&await t(y),y}function lc(n,t,e){let i=new At().decodeTags(n);return{id:n.id,owner:{address:t,key:""},recipient:n.target,tags:i,fee:{winston:n.reward,ar:""},quantity:{winston:n.quantity,ar:""},block:{id:e.indep_hash,height:e.height,timestamp:e.timestamp,previous:null},dry:!0,anchor:null,signature:null,data:null,parent:null,bundledIn:null}}m();var sr={target:"",winstonQty:"0"},Xp=["node1","node2"];m();var bi=class{eval(t){let e=[];return Object.keys(t.interactions).forEach(r=>{let i=t.interactions[r];this.evalForeignCalls(t.contractTxId,i,e)}),e}evalForeignCalls(t,e,r){Object.keys(e.interactionInput.foreignContractCalls).forEach(i=>{let o=e.interactionInput.foreignContractCalls[i];o.innerCallType=="write"&&Object.keys(o.interactions).forEach(a=>{let s=o.interactions[a];s.interactionInput.dryWrite&&!r.includes(o.contractTxId)&&t!==o.contractTxId&&r.push(o.contractTxId),this.evalForeignCalls(t,s,r)})})}};m();var Si=class{signer;type;warp;signatureProviderType;wallet;cachedAddress;constructor(t,e){this.warp=t,this.isCustomSignature(e)?(this.assertEnvForCustomSigner(e.type),this.signer=e.signer,this.type=e.type,this.signatureProviderType="CustomSignature"):this.isValidBundlerSignature(e)?(this.signatureProviderType="BundlerSigner",this.type=Zp(e.signatureType)):(this.assignArweaveSigner(e),this.signatureProviderType="ArWallet",this.type="arweave"),this.wallet=e}async getAddress(){if(this.cachedAddress)return this.cachedAddress;switch(this.signatureProviderType){case"CustomSignature":return this.wallet.getAddress?this.cachedAddress=await this.wallet.getAddress():this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"ArWallet":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"BundlerSigner":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;default:throw Error("Unknown Signature::signatureProvider : "+this.signatureProviderType)}}async deduceSignerBySigning(){let{arweave:t}=this.warp,e=await t.createTransaction({data:Math.random().toString().slice(-4),reward:"72600854",last_tx:"p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"});if(await this.signer(e),this.type==="ethereum")return e.owner;if(this.type==="arweave")return t.wallets.ownerToAddress(e.owner);throw Error("Unknown Signature::type")}checkNonArweaveSigningAvailability(t){if(this.type!=="arweave"&&!t)throw new Error(`Unable to use signing function of type: ${this.type} when bundling is disabled.`)}assignArweaveSigner(t){this.signer=async e=>{await this.warp.arweave.transactions.sign(e,t)}}assertEnvForCustomSigner(t){if(t!=="arweave"&&(!["mainnet","testnet"].includes(this.warp.environment)||this.warp.interactionsLoader.type()!=="warp"))throw new Error(`Unable to use signing function of type: ${t} when not in mainnet environment or bundling is disabled.`)}isCustomSignature(t){return t.signer!==void 0}isValidBundlerSignature(t){let e=t,r=!!e.signatureType&&!!e.ownerLength&&!!e.signatureLength;if(r&&!e.publicKey)throw new Error("It seems that you are using BundlerSigner, but publicKey is not set! Maybe try calling await bundlerSigner.setPublicKey() before using it.");return r}};function Zp(n){if(n===3)return"ethereum";if(n===1)return"arweave";throw Error(`Not supported arbundle SignatureType : ${n}`)}m();var Ei=class{rootOptions;saferEvaluationOptions={internalWrites:t=>{if(t.internalWrites===void 0||this.rootOptions.internalWrites==t.internalWrites)return this.rootOptions.internalWrites;if(this.rootOptions.internalWrites&&!t.internalWrites||!this.rootOptions.internalWrites&&t.internalWrites)return t.internalWrites;throw new Error('Could not determine "internalWrites" value ')},throwOnInternalWriteError:t=>t.throwOnInternalWriteError===void 0?this.rootOptions.throwOnInternalWriteError:t.throwOnInternalWriteError,unsafeClient:t=>{if(t.unsafeClient===void 0||this.rootOptions.unsafeClient==t.unsafeClient)return this.rootOptions.unsafeClient;if(this.rootOptions.unsafeClient==="throw"||this.rootOptions.unsafeClient==="skip")return this.rootOptions.unsafeClient;if(this.rootOptions.unsafeClient==="allow")return t.unsafeClient==="throw"?"skip":t.unsafeClient;throw new Error('Could not determine "unsafeClient" value')},ignoreExceptions:t=>{if(t.ignoreExceptions===void 0||this.rootOptions.ignoreExceptions==t.ignoreExceptions)return this.rootOptions.ignoreExceptions;if(this.rootOptions.ignoreExceptions&&!t.ignoreExceptions)return this.rootOptions.ignoreExceptions;if(!this.rootOptions.ignoreExceptions&&t.ignoreExceptions)return this.rootOptions.ignoreExceptions;throw new Error('Could not determine "ignoreExceptions" value')},waitForConfirmation:()=>this.rootOptions.waitForConfirmation,updateCacheForEachInteraction:()=>this.rootOptions.updateCacheForEachInteraction,maxCallDepth:()=>this.rootOptions.maxCallDepth,maxInteractionEvaluationTimeSeconds:()=>this.rootOptions.maxInteractionEvaluationTimeSeconds,stackTrace:()=>this.rootOptions.stackTrace,sourceType:()=>this.rootOptions.sourceType,sequencerUrl:()=>this.rootOptions.sequencerUrl,gasLimit:()=>this.rootOptions.gasLimit,allowBigInt:()=>this.rootOptions.allowBigInt,walletBalanceUrl:()=>this.rootOptions.walletBalanceUrl,mineArLocalBlocks:()=>this.rootOptions.mineArLocalBlocks,cacheEveryNInteractions:()=>this.rootOptions.cacheEveryNInteractions,remoteStateSyncEnabled:()=>this.rootOptions.remoteStateSyncEnabled,remoteStateSyncSource:()=>this.rootOptions.remoteStateSyncSource,useKVStorage:t=>t.useKVStorage,useConstructor:t=>t.useConstructor};notConflictingEvaluationOptions=["useKVStorage","sourceType","useConstructor"];constructor(t,e){if(e){let r=[];for(let i in e){let o=i,a=e[i],s=t[i];if(!this.notConflictingEvaluationOptions.includes(o))if(o==="internalWrites"){if(s===!1&&a===!0)throw new Error("Cannot proceed with contract evaluation. User is blocking internal writes, while contract requires them.")}else if(o==="unsafeClient"){if(s==="throw"&&a!=="throw"||s==="skip"&&a==="allow")throw new Error(`Cannot proceed with contract evaluation. User requires to ${s} on any unsafeClient usage, while contract uses ${a} option.`)}else t[i]!==e[i]&&r.push(`Option {${i}} differs. EvaluationOptions: [${t[i]}], manifest: [${e[i]}]. Use contract.setEvaluationOptions({${i}: ${e[i]}}) to evaluate contract state.`)}if(r.length)throw new Error(r.join(`
`))}this.rootOptions=Object.freeze(Object.assign({},t,e||{}))}forForeignContract(t){let e=nr(this.rootOptions);if(t)for(let r in t)e[r]=this.saferEvaluationOptions[r](t);return Object.freeze(e)}};m();var Ti=class{constructor(t){this.warp=t;this.warp=t}name="WarpFetchWrapper";logger=rt.INST.create(this.name);fetch(t,e){let r;if(this.warp.hasPlugin("fetch-options")){let i=this.warp.loadPlugin("fetch-options");try{let o=i.process({input:t,init:e||{}});r={...e,...o}}catch(o){throw o.message&&this.logger.error(o.message),new Error(`Unable to process fetch options: ${o.message}`)}}else r=e;return fetch(t,r)}};m();var ob=new Error("timeout while waiting for mutex to become available"),ab=new Error("mutex already locked"),tm=new Error("request for lock canceled"),em=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function s(p){try{l(r.next(p))}catch(y){a(y)}}function c(p){try{l(r.throw(p))}catch(y){a(y)}}function l(p){p.done?o(p.value):i(p.value).then(s,c)}l((r=r.apply(n,t||[])).next())})},fc=class{constructor(t,e=tm){this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}acquire(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((e,r)=>{this._weightedQueues[t-1]||(this._weightedQueues[t-1]=[]),this._weightedQueues[t-1].push({resolve:e,reject:r}),this._dispatch()})}runExclusive(t,e=1){return em(this,void 0,void 0,function*(){let[r,i]=yield this.acquire(e);try{return yield t(r)}finally{i()}})}waitForUnlock(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise(e=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),this._weightedWaiters[t-1].push(e),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatch()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatch()}cancel(){this._weightedQueues.forEach(t=>t.forEach(e=>e.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var t;for(let e=this._value;e>0;e--){let r=(t=this._weightedQueues[e-1])===null||t===void 0?void 0:t.shift();if(!r)continue;let i=this._value,o=e;this._value-=e,e=this._value+1,r.resolve([i,this._newReleaser(o)])}this._drainUnlockWaiters()}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){for(let t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach(e=>e()),this._weightedWaiters[t-1]=[])}},rm=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function s(p){try{l(r.next(p))}catch(y){a(y)}}function c(p){try{l(r.throw(p))}catch(y){a(y)}}function l(p){p.done?o(p.value):i(p.value).then(s,c)}l((r=r.apply(n,t||[])).next())})},$o=class{constructor(t){this._semaphore=new fc(1,t)}acquire(){return rm(this,void 0,void 0,function*(){let[,t]=yield this._semaphore.acquire();return t})}runExclusive(t){return this._semaphore.runExclusive(()=>t())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};m();var xi=class{constructor(t){this._warp=t}_json=new Map;_initialJson=new Map;_kv=new Map;has(t){return this._json.has(t)}get(t){return this._json.get(t)||null}async getKV(t,e){return this._kv.has(t)&&(await this._kv.get(t).get(e))?.cachedValue||null}async delKV(t,e){this._kv.has(t)&&await this._kv.get(t).del(e)}getKvKeys(t,e,r){return this._warp.kvStorageFactory(t).keys(e,r)}getKvRange(t,e,r){return this._warp.kvStorageFactory(t).kvMap(e,r)}async commit(t){if(t.dry)return await this.rollbackKVs(),this.reset();try{await this.doStoreJson(this._json,t),await this.commitKVs()}finally{this.reset()}}async commitKV(){await this.commitKVs(),this._kv.clear()}async rollback(t){try{await this.doStoreJson(this._initialJson,t),await this.rollbackKVs()}finally{this.reset()}}setInitial(t,e){this._initialJson.set(t,e),this._json.set(t,e)}update(t,e){this._json.set(t,e)}async updateKV(t,e,r){await(await this.getOrInitKvStorage(t)).put(e,r)}async getOrInitKvStorage(t){if(this._kv.has(t))return this._kv.get(t);let e=this._warp.kvStorageFactory(t);return this._kv.set(t,e),await e.open(),e}reset(){this._json.clear(),this._initialJson.clear(),this._kv.clear()}async doStoreJson(t,e){if(t.size>1)for(let[r,i]of t)await this._warp.stateEvaluator.putInCache(r,e,i)}async rollbackKVs(){for(let t of this._kv.values())try{await t.rollback()}finally{await t.close()}}async commitKVs(){for(let t of this._kv.values())try{await t.commit()}finally{await t.close()}}};var Nf=Ot(rr()),Wf=Ot(Ao()),Pr=class{constructor(t,e,r=null,i=null){this._contractTxId=t;this.warp=e;this._parentContract=r;this._innerCallData=i;if(this.waitForConfirmation=this.waitForConfirmation.bind(this),this._arweaveWrapper=new Ut(e),this._sorter=new $e(e.arweave),r!=null){this._evaluationOptions=this.getRoot().evaluationOptions(),this._callDepth=r.callDepth()+1;let o=r.getCallStack().getInteraction(i.callingInteraction.id);if(this._callDepth>this._evaluationOptions.maxCallDepth)throw new Error(`Max call depth of ${this._evaluationOptions.maxCallDepth} has been exceeded for interaction ${JSON.stringify(o.interactionInput)}`);if(this.logger.debug("Calling interaction",{id:i.callingInteraction.id,sortKey:i.callingInteraction.sortKey,type:i.callType}),o.interactionInput?.foreignContractCalls[t]?.innerCallType==="write"&&i.callType==="read")throw new Error("Calling a readContractState after performing an inner write is wrong - instead use a state from the result of an internal write.");let a=new Or(t,this._callDepth,i?.callType);o.interactionInput.foreignContractCalls[t]=a,this._callStack=a,this._rootSortKey=r.rootSortKey,r._children.push(this)}else this._callDepth=0,this._callStack=new Or(t,0),this._rootSortKey=null,this._evaluationOptions=new Vn,this._children=[],this._interactionState=new xi(e);this.getCallStack=this.getCallStack.bind(this),this._warpFetchWrapper=new Ti(this.warp)}logger=rt.INST.create("HandlerBasedContract");ecLogger=rt.INST.create("ExecutionContext");_innerWritesEvaluator=new bi;_callDepth;_arweaveWrapper;_mutex=new $o;_callStack;_evaluationOptions;_eoEvaluator;_benchmarkStats=null;_sorter;_rootSortKey;_signature;_warpFetchWrapper;_children=[];_interactionState;_dreStates=new Map;async readState(t,e,r){if(this.logger.info("Read state for",{contractTxId:this._contractTxId,sortKeyOrBlockHeight:t}),!this.isRoot()&&t==null)throw new Error("SortKey MUST be always set for non-root contract calls");let{stateEvaluator:i}=this.warp,o=typeof t=="number"?this._sorter.generateLastSortKey(t):t;if(o&&!this.isRoot()&&this.interactionState().has(this.txId())){let s=this.interactionState().get(this.txId());return new Ct(o,s)}let a=await this._mutex.acquire();try{let s=ft.measure();this.maybeResetRootContract();let c=await this.createExecutionContext(this._contractTxId,o,!1,r);this.logger.info("Execution Context",{srcTxId:c.contractDefinition?.srcTxId,missingInteractions:c.sortedInteractions?.length,cachedSortKey:c.cachedState?.sortKey}),s.stop();let l=ft.measure(),p=await i.eval(c);l.stop();let y=s.elapsed(!0)+l.elapsed(!0);return this._benchmarkStats={gatewayCommunication:s.elapsed(!0),stateEvaluation:l.elapsed(!0),total:y},this.logger.info("Benchmark",{"Gateway communication  ":s.elapsed(),"Contract evaluation    ":l.elapsed(),"Total:                 ":`${y.toFixed(0)}ms`}),o&&!this.isRoot()&&this.interactionState().update(this.txId(),p.cachedValue),p}finally{a()}}async readStateFor(t,e){return this.readState(t,void 0,e)}async viewState(t,e=[],r=sr){return this.logger.info("View state for",this._contractTxId),await this.callContract(t,"view",void 0,void 0,e,r)}async viewStateForTx(t,e){return this.logger.info(`View state for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"view")}async dryWrite(t,e,r,i,o){return this.logger.info("Dry-write for",this._contractTxId),await this.callContract(t,"write",e,void 0,r,i,void 0,o)}async applyInput(t,e){return this.logger.info(`Apply-input from transaction ${e.id} for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"write")}async writeInteraction(t,e){if(this.logger.info("Write interaction",{input:t,options:e}),!this._signature)throw new Error("Wallet not connected. Use 'connect' method first.");let{arweave:r,interactionsLoader:i,environment:o}=this.warp;await this.warp.definitionLoader.load(this._contractTxId);let a=e?.tags||[],s=e?.transfer||sr,c=e?.strict===!0,l=e?.vrf===!0,p=e?.disableBundling===!0,y=e?.reward,I=i.type()=="warp"&&!p;if(this._signature.checkNonArweaveSigningAvailability(I),I&&s.target!=sr.target&&s.winstonQty!=sr.winstonQty)throw new Error("Ar Transfers are not allowed for bundled interactions");if(l&&!I&&o==="mainnet")throw new Error("Vrf generation is only available for bundle interaction");if(I)return await this.bundleInteraction(t,{tags:a,strict:c,vrf:l});{let f=await this.createInteraction(t,a,s,c,!1,l&&o!=="mainnet",y),v=await r.transactions.post(f);if(v.status!==200)return this.logger.error("Error while posting transaction",v),null;if(this._evaluationOptions.waitForConfirmation){this.logger.info("Waiting for confirmation of",f.id);let L=ft.measure();await this.waitForConfirmation(f.id),this.logger.info("Transaction confirmed after",L.elapsed())}return this.warp.environment=="local"&&this._evaluationOptions.mineArLocalBlocks&&await this.warp.testing.mineBlock(),{originalTxId:f.id}}}async bundleInteraction(t,e){this.logger.info("Bundle interaction input",t);let r=await this.createInteraction(t,e.tags,sr,e.strict,!0,e.vrf),i=this._warpFetchWrapper.fetch(`${xe(this._evaluationOptions.sequencerUrl)}/gateway/sequencer/register`,{method:"POST",body:JSON.stringify(r),headers:{"Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Accept:"application/json"}});return{bundlrResponse:await Ce(i),originalTxId:r.id}}async createInteraction(t,e,r,i,o=!1,a=!1,s){this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,i,a),a&&e.push({name:nt.REQUEST_VRF,value:"true"});let c=await Mo(this.warp.arweave,this._signature.signer,this._contractTxId,t,e,r.target,r.winstonQty,o,this.warp.environment==="testnet",s);if(!this._evaluationOptions.internalWrites&&i){let{arweave:l}=this.warp,p=this._signature.type=="arweave"?await l.wallets.ownerToAddress(c.owner):c.owner,y=await this.callContract(t,"write",p,void 0,e,r,i,a);if(y.type!=="ok")throw Error("Cannot create interaction: "+JSON.stringify(y.error||y.errorMessage))}return c}txId(){return this._contractTxId}getCallStack(){return this._callStack}connect(t){return this._signature=new Si(this.warp,t),this}setEvaluationOptions(t){if(!this.isRoot())throw new Error("Evaluation options can be set only for the root contract");return this._evaluationOptions={...this._evaluationOptions,...t},this}async waitForConfirmation(t){let{arweave:e}=this.warp,r=await e.transactions.getStatus(t);if(r.confirmed===null)this.logger.info(`Transaction ${t} not yet confirmed. Waiting another 20 seconds before next check.`),await Dn(2e4),await this.waitForConfirmation(t);else return this.logger.info(`Transaction ${t} confirmed`,r),r}async createExecutionContext(t,e,r=!1,i){let{definitionLoader:o,interactionsLoader:a,stateEvaluator:s}=this.warp,c=ft.measure(),l=await s.latestAvailableState(t,e);this.logger.debug("cache lookup",c.elapsed()),c.reset();let p=Ke.evolvedSrcTxId(l?.cachedValue?.state),y,I,f,v,L=i||[];if(this.logger.debug("Cached state",l,e),l&&l.sortKey==e)this.logger.debug("State fully cached, not loading interactions."),(r||p||i?.length)&&(I=await o.load(t,p),i?.length&&(L=(await this._sorter.sort(i.map(U=>({node:U,cursor:null})))).map(U=>U.node)));else{if(i?.length)throw new Error(`Cannot apply requested interactions at ${e}`);if(I=await o.load(t,p),f=this.resolveEvaluationOptions(I.manifest?.evaluationOptions),f.remoteStateSyncEnabled&&!f.useKVStorage){v=await this.getRemoteContractState(t),l=await this.maybeSyncStateWithRemoteSource(v,e,l);let U=Ke.evolvedSrcTxId(l?.cachedValue?.state);U&&U!==I.srcTxId&&(I=await o.load(t,U))}!v&&L.length==0&&(L=await a.load(t,l?.sortKey,this.getToSortKey(e),f)),l?.sortKey&&(L=L.filter(U=>U.sortKey.localeCompare(l?.sortKey)>0)),e&&(L=L.filter(U=>U.sortKey.localeCompare(e)<=0)),this.logger.debug("contract and interactions load",c.elapsed()),this.isRoot()&&L.length&&(this._rootSortKey=L[L.length-1].sortKey)}return I&&(f||(f=this.resolveEvaluationOptions(I.manifest?.evaluationOptions)),this.ecLogger.debug(`Evaluation options ${t}:`,f),y=await this.warp.executorFactory.create(I,f,this.warp,this.interactionState())),{warp:this.warp,contract:this,contractDefinition:I,sortedInteractions:L,evaluationOptions:f||this.evaluationOptions(),handler:y,cachedState:l,requestedSortKey:e}}resolveEvaluationOptions(t){return this.isRoot()?(this._eoEvaluator=new Ei(this.evaluationOptions(),t),this._eoEvaluator.rootOptions):this.getRootEoEvaluator().forForeignContract(t)}async getRemoteContractState(t){if(this.hasDreState(t))return this.getDreState(t);{let e=await this.fetchRemoteContractState(t);return e!=null?this.setDREState(t,e):null}}async fetchRemoteContractState(t){return this._warpFetchWrapper.fetch(`${this._evaluationOptions.remoteStateSyncSource}?id=${t}&events=false`).then(e=>e.ok?e.json():Promise.reject(e)).catch(e=>{throw new Error(`Unable to read contract state from DRE. ${e.status}. ${e.body?.message}`)})}getToSortKey(t){return this._parentContract?.rootSortKey?t?this._parentContract.rootSortKey.localeCompare(t)>0?this._parentContract.rootSortKey:t:this._parentContract.rootSortKey:t}async createExecutionContextFromTx(t,e){let r=e.owner.address,i=e.sortKey;return{...await this.createExecutionContext(t,i,!0),caller:r}}maybeResetRootContract(){this.isRoot()&&(this.logger.debug("Clearing call stack for the root contract"),this._callStack=new Or(this.txId(),0),this._rootSortKey=null,this.warp.interactionsLoader.clearCache(),this._children=[],this._interactionState=new xi(this.warp),this._dreStates=new Map)}async callContract(t,e,r,i,o=[],a=sr,s=!1,c=!1,l=!0){this.logger.info("Call contract input",t),this.maybeResetRootContract(),this._signature||this.logger.warn("Wallet not set.");let{arweave:p,stateEvaluator:y}=this.warp,I=await this.createExecutionContext(this._contractTxId,i,!0),f=this.warp.environment=="mainnet"?await this._arweaveWrapper.warpGwBlock():await p.blocks.getCurrent(),v;r?v=r:this._signature?v=await this._signature.getAddress():v="",this.logger.info("effectiveCaller",v),I={...I,caller:v};let L=await y.eval(I);this.logger.info("Current state",L.cachedValue.state);let U={input:t,caller:I.caller,interactionType:e};this.logger.debug("interaction",U);let $=await Mo(p,l?this._signature?.signer:void 0,this._contractTxId,t,o,a.target,a.winstonQty,!0,this.warp.environment==="testnet"),V=lc($,I.caller,f);if(this.logger.debug("Creating sortKey for",{blockId:V.block.id,id:V.id,height:V.block.height}),V.sortKey=await this._sorter.createSortKey(V.block.id,V.id,V.block.height,!0),V.strict=s,c){Wf.default.utils;let H=this.warp.maybeLoadPlugin("vrf");H?V.vrf=H.process().generateMockVrf(V.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')}let G=await this.evalInteraction({interaction:U,interactionTx:V},I,L.cachedValue);return G.type!=="ok"&&this.logger.fatal("Error while interacting with contract",{type:G.type,error:G.errorMessage}),G}async doApplyInputOnTx(t,e,r){this.maybeResetRootContract();let i,o=await this.createExecutionContextFromTx(this._contractTxId,e);!this.isRoot()&&this.interactionState().has(this.txId())?i=new Ct(e.sortKey,this.interactionState().get(this.txId())):(i=await this.warp.stateEvaluator.eval(o),this.interactionState().update(this.txId(),i.cachedValue)),this.logger.debug("callContractForTx - evalStateResult",{result:i.cachedValue.state,txId:this._contractTxId});let s={interaction:{input:t,caller:this._parentContract.txId(),interactionType:r},interactionTx:e},c=await this.evalInteraction(s,o,i.cachedValue);return c.originalValidity=i.cachedValue.validity,c.originalErrorMessages=i.cachedValue.errorMessages,c}async evalInteraction(t,e,r){let i=this.getCallStack().addInteractionData(t),o=ft.measure();await e.handler.initState(r.state);let a=await e.handler.handle(e,r,t);return i.update({cacheHit:!1,outputState:this._evaluationOptions.stackTrace.saveState?a.state:void 0,executionTime:o.elapsed(!0),valid:a.type==="ok",errorMessage:a.errorMessage,gasUsed:a.gasUsed}),a}parent(){return this._parentContract}callDepth(){return this._callDepth}evaluationOptions(){return this._evaluationOptions}lastReadStateStats(){return this._benchmarkStats}async stateHash(t){let e=Pf(t),r=await Nf.Crypto.subtle.digest("SHA-256",W.Buffer.from(e,"utf-8"));return W.Buffer.from(r).toString("hex")}async syncState(t,e){let{stateEvaluator:r}=this.warp,i=await this._warpFetchWrapper.fetch(`${t}?${new URLSearchParams({id:this._contractTxId,...e})}`).then(o=>o.ok?o.json():Promise.reject(o)).catch(o=>{throw o.body?.message&&this.logger.error(o.body.message),new Error(`Unable to retrieve state. ${o.status}: ${o.body?.message}`)});return await r.syncState(this._contractTxId,i.sortKey,i.state,i.validity),this}async evolve(t,e){return await this.writeInteraction({function:"evolve",value:t},e)}get rootSortKey(){return this._rootSortKey}getRootEoEvaluator(){return this.getRoot()._eoEvaluator}isRoot(){return this._parentContract==null}async getStorageValues(t){let e=await this.warp.stateEvaluator.getCache().getLast(this.txId());if(e==null)return new Ct(null,new Map);let r=this.warp.kvStorageFactory(this.txId()),i=new Map;try{await r.open();for(let o of t){let a=await r.getLessOrEqual(o,e.sortKey);i.set(o,a==null?null:a.cachedValue)}return new Ct(e.sortKey,i)}finally{await r.close()}}interactionState(){return this.getRoot()._interactionState}getRoot(){let t=this;for(;!t.isRoot();)t=t.parent();return t}async maybeSyncStateWithRemoteSource(t,e,r){let{stateEvaluator:i}=this.warp;return this.isStateHigherThanAndUpTo(t,r?.sortKey,e)?await i.syncState(this._contractTxId,t.sortKey,t.cachedValue.state,t.cachedValue.validity):r}isStateHigherThanAndUpTo(t,e,r){return t&&(!r||r>=t.sortKey)&&(!e||t.sortKey>e)}setDREState(t,e){let r=new Ct(e.sortKey,new Et(e.state,{},e.errorMessages));return this.getRoot()._dreStates.set(t,r),r}getDreState(t){return this.getRoot()._dreStates.get(t)}hasDreState(t){return this.getRoot()._dreStates.has(t)}async discoverInternalWrites(t,e,r,i,o){let a=await this.callContract(t,"write",void 0,void 0,e,r,i,o,!1);if(i&&a.type!=="ok")throw Error("Cannot create interaction: "+JSON.stringify(a.error||a.errorMessage));let s=this.getCallStack(),c=this._innerWritesEvaluator.eval(s);this.logger.debug("Input",t),this.logger.debug("Callstack",s.print()),c.forEach(l=>{e.push({name:nt.INTERACT_WRITE,value:l})}),this.logger.debug("Tags with inner calls",e)}};m();var Ci=class extends Pr{async currentBalance(t){let e=await this.viewState({function:"balance",target:t});if(e.type!=="ok")throw Error(e.errorMessage);return e.result}async currentState(){return(await super.readState()).cachedValue.state}async transfer(t,e){return await this.writeInteraction({function:"transfer",...t},e)}};m();var Ko=class{constructor(t){this.arweave=t}async mineBlock(){this.validateEnv(),await this.arweave.api.get("mine")}async addFunds(t){let e=await this.arweave.wallets.getAddress(t);await this.arweave.api.get(`/mint/${e}/1000000000000000`)}async isArlocal(){return(await fetch(`${this.arweave.api.config.protocol}://${this.arweave.api.config.host}:${this.arweave.api.config.port}/info`).then(e=>e.ok?e.json():Promise.reject()).catch(e=>{throw new Error(`Unable to get network info: ${e.message}`)})).network.includes("arlocal")}async validateEnv(){if(!await this.isArlocal())throw new Error("Testing features are not available in a non testing environment")}};m();m();var Vo=class{constructor(t,e){this.baseImplementation=t;this.sourceCode=e}async create(t,e,r,i){return Object.prototype.hasOwnProperty.call(this.sourceCode,t.txId)&&(t={...t,src:this.sourceCode[t.txId]}),await this.baseImplementation.create(t,e,r,i)}};var Ii=class{constructor(t,e,r="custom"){this._arweave=t;this._stateCache=e;this._environment=r}_definitionLoader;_interactionsLoader;_executorFactory;_stateEvaluator;setDefinitionLoader(t){return this._definitionLoader=t,this}setInteractionsLoader(t){return this._interactionsLoader=t,this}setExecutorFactory(t){return this._executorFactory=t,this}setStateEvaluator(t){return this._stateEvaluator=t,this}overwriteSource(t){if(this._executorFactory==null)throw new Error("Set base ExecutorFactory first");return this._executorFactory=new Vo(this._executorFactory,t),this.build()}useWarpGateway(t,e){this._interactionsLoader=new on(new Kn(t.confirmationStatus,t.source));let r=new Te({...e,dbLocation:`${e.dbLocation}/contracts`}),i=new Te({...e,dbLocation:`${e.dbLocation}/source`});return this._definitionLoader=new fi(this._arweave,r,i,this._environment),this}useArweaveGateway(){return this._definitionLoader=new Ar(this._arweave,this._environment),this._interactionsLoader=new on(new hi(this._arweave,this._environment)),this}build(){let t=new Nr(this._arweave,this._definitionLoader,this._interactionsLoader,this._executorFactory,this._stateEvaluator,this._environment);return this._definitionLoader.warp=t,this._interactionsLoader.warp=t,t}};m();var hc=["^smartweave-extension-"],dc=["evm-signature-verification","subscription","ivm-handler-api","evaluation-progress","fetch-options","deploy","contract-blacklist","vm2","vrf"];var Nr=class{constructor(t,e,r,i,o,a="custom"){this.arweave=t;this.definitionLoader=e;this.interactionsLoader=r;this.executorFactory=i;this.stateEvaluator=o;this.environment=a;this.testing=new Ko(t),this.kvStorageFactory=s=>new Te({inMemory:!1,dbLocation:`${Go}/kv/ldb/${s}`})}_createContract;_gwUrl=gc;get createContract(){if(!this._createContract)if(this.plugins.has("deploy")){let t=this.loadPlugin("deploy");this._createContract=t.process(this)}else throw new Error("In order to use CreateContract methods please attach DeployPlugin.");return this._createContract}testing;kvStorageFactory;whoAmI;plugins=new Map;static builder(t,e,r){return new Ii(t,e,r)}contract(t,e,r){return new Pr(t,this,e,r)}async deploy(t,e){return await this.createContract.deploy(t,e)}async deployFromSourceTx(t,e){return await this.createContract.deployFromSourceTx(t,e)}async deployBundled(t){return await this.createContract.deployBundled(t)}async register(t,e){return await this.createContract.register(t,e)}async createSource(t,e,r=!1){return await this.createContract.createSource(t,e,r)}async saveSource(t,e){return await this.createContract.saveSource(t,e)}pst(t){return new Ci(t,this)}useStateCache(t){return this.stateEvaluator.setCache(t),this}useContractCache(t,e){return this.definitionLoader.setSrcCache(e),this.definitionLoader.setCache(t),this}use(t){let e=t.type();if(!this.isPluginType(e))throw new Error(`Unknown plugin type ${e}.`);return this.plugins.set(e,t),this}hasPlugin(t){return this.plugins.has(t)}matchPlugins(t){return[...this.plugins.keys()].filter(r=>r.match(t))}loadPlugin(t){if(!this.hasPlugin(t))throw new Error(`Plugin ${t} not registered.`);return this.plugins.get(t)}maybeLoadPlugin(t){return this.hasPlugin(t)?this.plugins.get(t):null}async close(){return Promise.all([this.definitionLoader.getSrcCache().close(),this.definitionLoader.getCache().close(),this.stateEvaluator.getCache().close()]).then()}async generateWallet(){let t=await this.arweave.wallets.generate();return await this.testing.isArlocal()&&await this.testing.addFunds(t),{jwk:t,address:await this.arweave.wallets.jwkToAddress(t)}}isPluginType(t){return dc.includes(t)||hc.some(e=>t.match(e))}useKVStorageFactory(t){return this.kvStorageFactory=t,this}useGwUrl(t){return this._gwUrl=t,this}gwUrl(){return this._gwUrl}};var jo={confirmationStatus:{notCorrupted:!0},source:"both"},gc="https://gw.warp.cc",Go="./cache/warp",ln={inMemory:!1,dbLocation:Go},pc=class{static forLocal(t=1984,e=qo.default.init({host:"localhost",port:t,protocol:"http"}),r={...ln,inMemory:!0}){return this.customArweaveGw(e,r,"local")}static forTestnet(t=ln,e=!1,r=qo.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"testnet"):this.customWarpGw(r,jo,t,"testnet")}static forMainnet(t=ln,e=!1,r=qo.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"mainnet"):this.customWarpGw(r,jo,t,"mainnet")}static custom(t,e,r){let i=new Te({...e,dbLocation:`${e.dbLocation}/state`}),o=new vi(t),a=new gi(t,i,[new Ke]);return Nr.builder(t,i,r).setExecutorFactory(o).setStateEvaluator(a)}static customArweaveGw(t,e=ln,r){return this.custom(t,e,r).useArweaveGateway().build()}static customWarpGw(t,e=jo,r=ln,i){return this.custom(t,r,i).useWarpGateway(e,r).build()}};m();var mc=class{id;signatureType;rawSignature;signature;signatureLength;rawOwner;owner;ownerLength;rawTarget;target;rawAnchor;anchor;rawTags;tags;rawData;data;static async verify(...t){throw new Error("You must implement `verify`")}};m();function nm(n){let t=/(const|var) ret = makeMutClosure\(arg0, arg1, (\d+?), __wbg_adapter/;return n.match(t)[2]}m();function oe(n,t,e=void 0){let r=n.find(({name:i})=>i===t);return r?r.value:e}var ki=class{constructor(t){this.env=t}arweaveWrapper;arweaveTransactions;logger=rt.INST.create(ki.name);async load(t,e){let r=ft.measure(),i=await this.arweaveTransactions.transaction(t);this.logger.debug("Contract tx fetch time",r.elapsed());let o=i.owner.address,a=e||oe(i.tags,pt.CONTRACT_SRC_TX_ID),s=oe(i.tags,nt.WARP_TESTNET)||null;if(s&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!s&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.");let c=oe(i.tags,pt.MIN_FEE),l=oe(i.tags,nt.MANIFEST)?JSON.parse(oe(i.tags,nt.MANIFEST)):null;this.logger.debug("Tags decoding",r.elapsed());let p=await this.evalInitialState(i);this.logger.debug("init state",p);let y=JSON.parse(p);this.logger.debug("Parsing src and init state",r.elapsed());let{src:I,srcBinary:f,srcWasmLang:v,contractType:L,metadata:U,srcTx:$}=await this.loadContractSource(a),V={txId:t,srcTxId:a,src:I,srcBinary:f,srcWasmLang:v,initState:y,minFee:c,owner:o,contractType:L,metadata:U,manifest:l,contractTx:await this.convertToWarpCompatibleContractTx(i),srcTx:await this.convertToWarpCompatibleContractTx($),testnet:s};return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),V}async convertToWarpCompatibleContractTx(t){return{tags:t.tags.map(({name:r,value:i})=>({name:W.Buffer.from(r).toString("base64url"),value:W.Buffer.from(i).toString("base64url")})),owner:t.owner.key,target:t.recipient,signature:t.signature,data:(await this.arweaveWrapper.txData(t.id)).toString("base64url")}}async loadContractSource(t){let e=ft.measure(),r=await this.arweaveTransactions.transaction(t),i=oe(r.tags,pt.CONTENT_TYPE);if(!jn.includes(i))throw new Error(`Contract source content type ${i} not supported`);let o=i==="application/javascript"?"js":"wasm",a=o==="js"?await this.arweaveWrapper.txDataString(t):await this.arweaveWrapper.txData(t),s,c,l;if(o=="wasm"){if(c=new Me(a),s=oe(r.tags,nt.WASM_LANG),!s)throw new Error(`Wasm lang not set for wasm contract src ${t}`);l=JSON.parse(oe(r.tags,nt.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:o=="js"?a:null,srcBinary:o=="wasm"?c.wasmBinary():null,srcWasmLang:s,contractType:o,metadata:l,srcTx:r}}async evalInitialState(t){if(oe(t.tags,nt.INIT_STATE))return oe(t.tags,nt.INIT_STATE);if(oe(t.tags,nt.INIT_STATE_TX)){let e=oe(t.tags,nt.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}else return this.arweaveWrapper.txDataString(t.id)}setCache(){throw new Error("Method not implemented.")}setSrcCache(){throw new Error("Method not implemented.")}getCache(){throw new Error("Method not implemented.")}getSrcCache(){throw new Error("Method not implemented.")}type(){return"arweave"}set warp(t){this.arweaveWrapper=new Ut(t),this.arweaveTransactions=new Ie(t)}};m();var Uf=100,im=100,Ff=1057409,fn=class{constructor(t,e){this.arweave=t;this.environment=e;this.sorter=new $e(t)}logger=rt.INST.create(fn.name);arweaveFetcher;arweaveWrapper;_warp;sorter;tagsParser=new At;async load(t,e,r,i){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let o=this.sorter.extractBlockHeight(e)||0,a=this.sorter.extractBlockHeight(r)||await this.currentBlockHeight(),s={tags:[{name:pt.APP_NAME,values:["SmartWeaveAction"]},{name:pt.CONTRACT_TX_ID,values:[t]},{name:nt.SEQUENCER,values:["RedStone"]}],blockFilter:{min:o,max:a+im},first:Uf},c=ft.measure(),l=await this.arweaveFetcher.transactions(s);i.internalWrites&&(l=await this.appendInternalWriteInteractions(t,o,a,l)),c.stop(),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:l.length,time:c.elapsed()}),l.forEach(f=>{f.node.sortKey=f.node.sortKey??f.node?.tags?.find(v=>v.name===nt.SEQUENCER_SORT_KEY)?.value});let p=await this.sorter.sort(l),y=this.environment==="local"||this.environment==="testnet",I=this._warp.maybeLoadPlugin("vrf");return p.filter(f=>this.isNewerThenSortKeyBlockHeight(f)).filter(f=>this.isSortKeyInBounds(e,r,f)).map(f=>this.attachSequencerDataToInteraction(f)).map(f=>this.maybeAddMockVrf(y,f,I)).map((f,v,L)=>this.verifySortKeyIntegrity(f,v,L)).map(({node:f})=>f)}verifySortKeyIntegrity(t,e,r){if(e!==0){let i=r[e-1],o=r[e];if(this.logger.debug(`prev: ${i.node.id} | current: ${o.node.id}`),o.node.block.height<=Ff||o.node.lastSortKey?.split(",")[1]===No)return t;i.node.source==="redstone-sequencer"&&i.node.sortKey!==o.node.lastSortKey&&this.logger.warn(`Interaction loading error: interaction ${o.node.id} lastSortKey is not pointing on prev interaction ${i.node.id}`)}return t}isSortKeyInBounds(t,e,r){return t&&e?r.node.sortKey.localeCompare(t)>0&&r.node.sortKey.localeCompare(e)<=0:t&&!e?r.node.sortKey.localeCompare(t)>0:!t&&e?r.node.sortKey.localeCompare(e)<=0:!0}attachSequencerDataToInteraction(t){let e=y=>t.node.tags.find(I=>I.name===y)?.value,r=e(nt.SEQUENCER_TX_ID),i=e(nt.SEQUENCER_OWNER),o=e(nt.SEQUENCER_BLOCK_ID),a=e(nt.SEQUENCER_BLOCK_HEIGHT),s=e(nt.SEQUENCER_PREV_SORT_KEY)||e(nt.SEQUENCER_LAST_SORT_KEY),c=e(nt.SEQUENCER_SORT_KEY),l=e(nt.SEQUENCER_BLOCK_TIMESTAMP),p=Mn(a);if(!i||!o||!a||!s&&p>Ff||!r||!c)throw Error(`Interaction ${t.node.id} is not sequenced by sequencer aborting. Only Sequenced transactions are supported by loader ${fn.name}`);return{...t,node:{...t.node,owner:{address:i,key:null},block:{...t.node.block,height:Mn(a),id:o,timestamp:l?Mn(l):t.node.block.timestamp},sortKey:c,lastSortKey:s,id:r,source:"redstone-sequencer"}}}async appendInternalWriteInteractions(t,e,r,i){let o={tags:[{name:nt.INTERACT_WRITE,values:[t]}],blockFilter:{min:e,max:r},first:Uf},a=await this.arweaveFetcher.transactions(o);return this.logger.debug("Inner writes interactions length:",a.length),i=i.concat(a),i}maybeAddMockVrf(t,e,r){return t&&this.tagsParser.hasVrfTag(e.node)&&(r?e.node.vrf=r.process().generateMockVrf(e.node.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),e}isNewerThenSortKeyBlockHeight(t){if(t.node.sortKey){let e=t.node.sortKey.split(",")[0],r=Number.parseInt(e);return Number(t.node.block.height)-r>=0}return!0}async currentBlockHeight(){return(await this.arweaveWrapper.info()).height}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveWrapper=new Ut(t),this.arweaveFetcher=new Ie(t),this._warp=t}};return Hf(om);})();
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

run-parallel-limit/index.js:
  (*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/
